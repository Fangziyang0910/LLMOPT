{
  "problem_id": "equitable_partitioning_003",
  "metadata": {
    "problem_type": "Equitable Partitioning Problem",
    "difficulty": "hard"
  },
  "problem_description": "Within the advanced strategic operational framework of a distinguished multinational consulting enterprise engaged in a sophisticated multi-stakeholder client partnership paradigm, a comprehensive human capital optimization initiative necessitates the methodical orchestration of 40 consultants into 8 synergistic project teams for a complex strategic transformation engagement. Each consultant undergoes a rigorous multi-dimensional competency assessment protocol utilizing a quintessential performance assessment methodology (1-5 scale) across four critical competency domains: Technical expertise (encompassing advanced problem-solving methodologies and sophisticated analytical reasoning frameworks), Leadership capability (integrating strategic team orchestration principles and executive decision-making protocols), Innovation capacity (incorporating creative ideation mechanisms and adaptive transformation capabilities), and Communication proficiency (encompassing client engagement strategies and executive presentation competencies). The comprehensive competency assessment matrix reveals the following performance distributions: For the first competency assessment dimension (Technical expertise), the assessment ratings are: [4, 1, 3, 3, 4, 4, 5, 2, 3, 1, 3, 3, 1, 3, 4, 4, 3, 4, 4, 0, 4, 4, 3, 2, 5, 3, 2, 2, 5, 4, 4, 4, 4, 5, 3, 4, 5, 4, 5, 4]. For the second competency assessment dimension (Leadership capability), the evaluation scores are: [4, 1, 3, 3, 2, 3, 2, 3, 4, 3, 3, 3, 3, 5, 4, 4, 2, 4, 2, 3, 5, 4, 4, 4, 5, 4, 3, 1, 3, 3, 3, 5, 5, 3, 4, 3, 5, 3, 3, 3]. For the third competency assessment dimension (Innovation capacity), the assessment measurements are: [2, 2, 0, 1, 2, 3, 3, 2, 3, 3, 3, 3, 3, 1, 3, 3, 4, 2, 4, 2, 4, 3, 2, 1, 2, 4, 3, 3, 0, 3, 3, 2, 2, 2, 4, 1, 2, 4, 2, 2]. For the fourth competency assessment dimension (Communication proficiency), the effectiveness evaluations are: [3, 1, 3, 1, 3, 3, 5, 3, 4, 1, 2, 3, 4, 0, 3, 3, 4, 3, 3, 2, 1, 3, 2, 5, 2, 3, 1, 2, 3, 3, 4, 2, 1, 3, 3, 3, 2, 3, 3, 3]. How should the enterprise orchestrate the strategic distribution of consultants to maximize the synergistic effectiveness of the 8 project teams while ensuring that each team's comprehensive competency portfolio achieves optimal equilibrium through minimal total competency imbalance across all assessment dimensions?",
  "solution_format_description": "Print the following fields: - consultant_team_assignment: team assignment for each consultant. - total_competency_imbalance: total competency imbalance across all teams.",
  "structured_data": {
    "num_consultants": 40,
    "num_competencies": 4,
    "num_teams": 8,
    "competency_assessments": [
      [4, 1, 3, 3, 4, 4, 5, 2, 3, 1, 3, 3, 1, 3, 4, 4, 3, 4, 4, 0, 4, 4, 3, 2, 5, 3, 2, 2, 5, 4, 4, 4, 4, 5, 3, 4, 5, 4, 5, 4],
      [4, 1, 3, 3, 2, 3, 2, 3, 4, 3, 3, 3, 3, 5, 4, 4, 2, 4, 2, 3, 5, 4, 4, 4, 5, 4, 3, 1, 3, 3, 3, 5, 5, 3, 4, 3, 5, 3, 3, 3],
      [2, 2, 0, 1, 2, 3, 3, 2, 3, 3, 3, 3, 3, 1, 3, 3, 4, 2, 4, 2, 4, 3, 2, 1, 2, 4, 3, 3, 0, 3, 3, 2, 2, 2, 4, 1, 2, 4, 2, 2],
      [3, 1, 3, 1, 3, 3, 5, 3, 4, 1, 2, 3, 4, 0, 3, 3, 4, 3, 3, 2, 1, 3, 2, 5, 2, 3, 1, 2, 3, 3, 4, 2, 1, 3, 3, 3, 2, 3, 3, 3]
    ]
  },
  "reference_solution": {
    "consultant_team_assignment": [8, 8, 6, 7, 5, 8, 6, 4, 7, 6, 2, 4, 5, 5, 5, 7, 1, 8, 7, 2, 3, 8, 7, 3, 6, 6, 1, 3, 1, 5, 2, 1, 4, 2, 1, 4, 2, 4, 3, 3],
    "total_competency_imbalance": 10.75
  },
  "solver_code": "import cpmpy as cp\nimport json\n\n\ncompetency_assessments = [\n    [4, 1, 3, 3, 4, 4, 5, 2, 3, 1, 3, 3, 1, 3, 4, 4, 3, 4, 4, 0, 4, 4, 3, 2, 5, 3, 2, 2, 5, 4, 4, 4, 4, 5, 3, 4, 5, 4, 5, 4],\n    [4, 1, 3, 3, 2, 3, 2, 3, 4, 3, 3, 3, 3, 5, 4, 4, 2, 4, 2, 3, 5, 4, 4, 4, 5, 4, 3, 1, 3, 3, 3, 5, 5, 3, 4, 3, 5, 3, 3, 3],\n    [2, 2, 0, 1, 2, 3, 3, 2, 3, 3, 3, 3, 3, 1, 3, 3, 4, 2, 4, 2, 4, 3, 2, 1, 2, 4, 3, 3, 0, 3, 3, 2, 2, 2, 4, 1, 2, 4, 2, 2],\n    [3, 1, 3, 1, 3, 3, 5, 3, 4, 1, 2, 3, 4, 0, 3, 3, 4, 3, 3, 2, 1, 3, 2, 5, 2, 3, 1, 2, 3, 3, 4, 2, 1, 3, 3, 3, 2, 3, 3, 3]\n]\nnum_consultants = 40\nnum_teams = 8\n\n\nmodel = cp.Model()\nconsultant_team_assignment = cp.intvar(1, num_teams, shape=num_consultants, name=\"consultant_team_assignment\")\n\n\nfor t in range(1, num_teams + 1):\n    model += cp.sum(consultant_team_assignment == t) >= 1\n\n\ntotal_competency_imbalance = 0\n\nfor comp_idx in range(4):\n\n    team_sums = []\n    comp_data = cp.cpm_array(competency_assessments[comp_idx])\n    \n    for t in range(1, num_teams + 1):\n\n        team_sum = cp.sum(comp_data[i] * (consultant_team_assignment[i] == t) for i in range(num_consultants))\n        team_sums.append(team_sum)\n    \n\n    total_comp = sum(competency_assessments[comp_idx])\n\n    \n\n\n    for team_sum in team_sums:\n        total_competency_imbalance += cp.abs(8 * team_sum - total_comp)\n\n\nmodel.minimize(total_competency_imbalance)\n\n\nif model.solve():\n    assignment_solution = [int(consultant_team_assignment[i].value()) for i in range(num_consultants)]\n    \n\n    final_imbalance = 0.0\n    for comp_idx in range(4):\n        team_counts = [0] * num_teams\n        for i in range(num_consultants):\n            team_id = assignment_solution[i] - 1\n            team_counts[team_id] += competency_assessments[comp_idx][i]\n        \n        mean_count = sum(competency_assessments[comp_idx]) / num_teams\n        final_imbalance += sum(abs(count - mean_count) for count in team_counts)\n    \n    result = {\n        \"consultant_team_assignment\": assignment_solution,\n        \"total_competency_imbalance\": final_imbalance\n    }\n    \n    print(json.dumps(result))",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"consultant_team_assignment\", \"total_competency_imbalance\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        assignment = solution[\"consultant_team_assignment\"]\n        total_competency_imbalance = solution[\"total_competency_imbalance\"]\n        competency_assessments = structured_data[\"competency_assessments\"]\n        num_consultants = structured_data[\"num_consultants\"]\n        num_teams = structured_data[\"num_teams\"]\n        errors = []\n        \n        if len(assignment) != num_consultants:\n            errors.append(f\"Assignment length mismatch: expected {num_consultants}, got {len(assignment)}\")\n        \n        for i, team_id in enumerate(assignment):\n            if not isinstance(team_id, int) or team_id < 1 or team_id > num_teams:\n                errors.append(f\"Invalid team assignment at position {i}: {team_id}, must be 1-{num_teams}\")\n                break\n        \n        used_teams = set(assignment)\n        if len(used_teams) != num_teams:\n            missing_teams = set(range(1, num_teams + 1)) - used_teams\n            errors.append(f\"Not all teams are used, missing teams: {sorted(missing_teams)}\")\n        \n        if errors:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        calculated_imbalance = 0.0\n        for comp_idx in range(len(competency_assessments)):\n            team_counts = [0] * num_teams\n            for i in range(num_consultants):\n                team_id = assignment[i] - 1\n                team_counts[team_id] += competency_assessments[comp_idx][i]\n            \n            mean_count = sum(competency_assessments[comp_idx]) / num_teams\n            comp_imbalance = sum(abs(count - mean_count) for count in team_counts)\n            calculated_imbalance += comp_imbalance\n        \n        if abs(calculated_imbalance - total_competency_imbalance) > 1e-6:\n            errors.append(f\"Competency imbalance inconsistency: calculated {calculated_imbalance}, declared {total_competency_imbalance}\")\n        \n        if len(errors) == 0:\n            optimal_imbalance = reference_solution[\"total_competency_imbalance\"]\n            if optimal_imbalance == 0:\n                optimality_score = 1.0 if calculated_imbalance == 0 else 0.0\n            else:\n                gap = abs(optimal_imbalance - calculated_imbalance) / abs(optimal_imbalance)\n                optimality_score = max(0, 1 - gap)\n        else:\n            optimality_score = 0.0\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}