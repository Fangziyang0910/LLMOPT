{
  "problem_id": "minimum_cut_003",
  "metadata": {
    "problem_type": "Minimum Cut Problem",
    "difficulty": "hard"
  },
  "problem_description": "A national logistics company operates a distribution network with 34 warehouses including a central distribution hub, 32 intermediate warehouses, and a final destination port, all connected by 78 transportation routes with varying cargo capacities measured in tons per hour. Goods can only flow in the specified direction through each route, and each route must either be fully open or fully closed. The logistics manager needs to identify the most critical transportation routes whose disruption would completely stop goods flow from the central distribution hub to the final destination port. The network connections are structured as follows: From the central hub, goods flow to warehouse 1 with a cargo capacity of 8 tons per hour, to warehouse 2 with a cargo capacity of 12 tons per hour, to warehouse 3 with a cargo capacity of 6 tons per hour, to warehouse 4 with a cargo capacity of 10 tons per hour, to warehouse 5 with a cargo capacity of 7 tons per hour, to warehouse 6 with a cargo capacity of 9 tons per hour, to warehouse 7 with a cargo capacity of 11 tons per hour, and to warehouse 8 with a cargo capacity of 5 tons per hour. In the next layer, warehouse 1 connects to warehouse 9 with a cargo capacity of 13 tons per hour, to warehouse 10 with a cargo capacity of 8 tons per hour, and to warehouse 11 with a cargo capacity of 15 tons per hour. Warehouse 2 connects to warehouse 10 with a cargo capacity of 7 tons per hour and to warehouse 12 with a cargo capacity of 10 tons per hour. Warehouse 3 connects to warehouse 11 with a cargo capacity of 6 tons per hour and to warehouse 13 with a cargo capacity of 9 tons per hour. Warehouse 4 connects to warehouse 12 with a cargo capacity of 12 tons per hour and to warehouse 14 with a cargo capacity of 8 tons per hour. Warehouse 5 connects to warehouse 13 with a cargo capacity of 11 tons per hour and to warehouse 15 with a cargo capacity of 14 tons per hour. Warehouse 6 connects to warehouse 14 with a cargo capacity of 7 tons per hour and to warehouse 16 with a cargo capacity of 10 tons per hour. Warehouse 7 connects to warehouse 15 with a cargo capacity of 9 tons per hour and to warehouse 17 with a cargo capacity of 13 tons per hour. Warehouse 8 connects to warehouse 16 with a cargo capacity of 6 tons per hour and to warehouse 18 with a cargo capacity of 12 tons per hour. In the following layer, warehouse 9 connects to warehouse 19 with a cargo capacity of 8 tons per hour and to warehouse 20 with a cargo capacity of 15 tons per hour. Warehouse 10 connects to warehouse 19 with a cargo capacity of 7 tons per hour and to warehouse 21 with a cargo capacity of 11 tons per hour. Warehouse 11 connects to warehouse 20 with a cargo capacity of 9 tons per hour and to warehouse 22 with a cargo capacity of 14 tons per hour. Warehouse 12 connects to warehouse 21 with a cargo capacity of 6 tons per hour and to warehouse 23 with a cargo capacity of 10 tons per hour. Warehouse 13 connects to warehouse 22 with a cargo capacity of 8 tons per hour and to warehouse 24 with a cargo capacity of 13 tons per hour. Warehouse 14 connects to warehouse 23 with a cargo capacity of 12 tons per hour and to warehouse 25 with a cargo capacity of 7 tons per hour. Warehouse 15 connects to warehouse 24 with a cargo capacity of 9 tons per hour and to warehouse 26 with a cargo capacity of 11 tons per hour. Warehouse 16 connects to warehouse 25 with a cargo capacity of 15 tons per hour and to warehouse 27 with a cargo capacity of 6 tons per hour. Warehouse 17 connects to warehouse 26 with a cargo capacity of 8 tons per hour and to warehouse 28 with a cargo capacity of 14 tons per hour. Warehouse 18 connects to warehouse 27 with a cargo capacity of 10 tons per hour and to warehouse 29 with a cargo capacity of 12 tons per hour. Continuing the network, warehouse 19 connects to warehouse 30 with a cargo capacity of 7 tons per hour. Warehouse 20 connects to warehouse 30 with a cargo capacity of 13 tons per hour. Warehouse 21 connects to warehouse 30 with a cargo capacity of 9 tons per hour. Warehouse 22 connects to warehouse 31 with a cargo capacity of 11 tons per hour. Warehouse 23 connects to warehouse 31 with a cargo capacity of 6 tons per hour. Warehouse 24 connects to warehouse 31 with a cargo capacity of 15 tons per hour. Warehouse 25 connects to warehouse 32 with a cargo capacity of 8 tons per hour. Warehouse 26 connects to warehouse 32 with a cargo capacity of 12 tons per hour. Warehouse 27 connects to warehouse 32 with a cargo capacity of 10 tons per hour. Warehouse 28 connects to warehouse 32 with a cargo capacity of 14 tons per hour. Warehouse 29 connects to warehouse 32 with a cargo capacity of 7 tons per hour. Finally, warehouse 30 connects to the destination port with a cargo capacity of 16 tons per hour, warehouse 31 connects to the destination port with a cargo capacity of 13 tons per hour, and warehouse 32 connects to the destination port with a cargo capacity of 11 tons per hour. Additionally, there are cross-connections: warehouse 9 to warehouse 21 with a cargo capacity of 5 tons per hour, warehouse 10 to warehouse 22 with a cargo capacity of 8 tons per hour, warehouse 11 to warehouse 23 with a cargo capacity of 7 tons per hour, warehouse 12 to warehouse 24 with a cargo capacity of 9 tons per hour, warehouse 13 to warehouse 25 with a cargo capacity of 12 tons per hour, warehouse 14 to warehouse 26 with a cargo capacity of 6 tons per hour, warehouse 15 to warehouse 27 with a cargo capacity of 10 tons per hour, warehouse 16 to warehouse 28 with a cargo capacity of 14 tons per hour, warehouse 17 to warehouse 29 with a cargo capacity of 8 tons per hour, warehouse 19 to warehouse 31 with a cargo capacity of 11 tons per hour, warehouse 20 to warehouse 32 with a cargo capacity of 7 tons per hour, warehouse 21 to the destination port with a cargo capacity of 9 tons per hour, warehouse 22 to warehouse 30 with a cargo capacity of 13 tons per hour, warehouse 23 to warehouse 30 with a cargo capacity of 6 tons per hour, warehouse 24 to warehouse 30 with a cargo capacity of 12 tons per hour, warehouse 25 to warehouse 31 with a cargo capacity of 10 tons per hour, warehouse 26 to warehouse 31 with a cargo capacity of 15 tons per hour, warehouse 27 to warehouse 32 with a cargo capacity of 8 tons per hour, warehouse 28 to the destination port with a cargo capacity of 14 tons per hour, and warehouse 29 to the destination port with a cargo capacity of 11 tons per hour. The manager needs to determine which combination of transportation routes with the minimum total capacity, when shut down, would completely prevent any goods from reaching the destination port.",
  "solution_format_description": "Print the following fields: - critical_pipes: transportation routes to cut for minimum cut. - min_cut_capacity: total capacity of cut routes.",
  "structured_data": {
    "num_warehouses": 34,
    "pipelines": [
      [0, 1, 8],
      [0, 2, 12],
      [0, 3, 6],
      [0, 4, 10],
      [0, 5, 7],
      [0, 6, 9],
      [0, 7, 11],
      [0, 8, 5],
      [1, 9, 13],
      [1, 10, 8],
      [1, 11, 15],
      [2, 10, 7],
      [2, 12, 10],
      [3, 11, 6],
      [3, 13, 9],
      [4, 12, 12],
      [4, 14, 8],
      [5, 13, 11],
      [5, 15, 14],
      [6, 14, 7],
      [6, 16, 10],
      [7, 15, 9],
      [7, 17, 13],
      [8, 16, 6],
      [8, 18, 12],
      [9, 19, 8],
      [9, 20, 15],
      [10, 19, 7],
      [10, 21, 11],
      [11, 20, 9],
      [11, 22, 14],
      [12, 21, 6],
      [12, 23, 10],
      [13, 22, 8],
      [13, 24, 13],
      [14, 23, 12],
      [14, 25, 7],
      [15, 24, 9],
      [15, 26, 11],
      [16, 25, 15],
      [16, 27, 6],
      [17, 26, 8],
      [17, 28, 14],
      [18, 27, 10],
      [18, 29, 12],
      [19, 30, 7],
      [20, 30, 13],
      [21, 30, 9],
      [22, 31, 11],
      [23, 31, 6],
      [24, 31, 15],
      [25, 32, 8],
      [26, 32, 12],
      [27, 32, 10],
      [28, 32, 14],
      [29, 32, 7],
      [30, 33, 16],
      [31, 33, 13],
      [32, 33, 11],
      [9, 21, 5],
      [10, 22, 8],
      [11, 23, 7],
      [12, 24, 9],
      [13, 25, 12],
      [14, 26, 6],
      [15, 27, 10],
      [16, 28, 14],
      [17, 29, 8],
      [19, 31, 11],
      [20, 32, 7],
      [21, 33, 9],
      [22, 30, 13],
      [23, 30, 6],
      [24, 30, 12],
      [25, 31, 10],
      [26, 31, 15],
      [27, 32, 8],
      [28, 33, 14],
      [29, 33, 11]
    ]
  },
  "reference_solution": {
    "critical_pipes": [0, 1, 2, 3, 4, 5, 6, 7],
    "min_cut_capacity": 68
  },
  "solver_code": "from cpmpy import *\nimport json\n\nnum_warehouses = 34\npipelines = [\n    [0, 1, 8],\n    [0, 2, 12],\n    [0, 3, 6],\n    [0, 4, 10],\n    [0, 5, 7],\n    [0, 6, 9],\n    [0, 7, 11],\n    [0, 8, 5],\n    [1, 9, 13],\n    [1, 10, 8],\n    [1, 11, 15],\n    [2, 10, 7],\n    [2, 12, 10],\n    [3, 11, 6],\n    [3, 13, 9],\n    [4, 12, 12],\n    [4, 14, 8],\n    [5, 13, 11],\n    [5, 15, 14],\n    [6, 14, 7],\n    [6, 16, 10],\n    [7, 15, 9],\n    [7, 17, 13],\n    [8, 16, 6],\n    [8, 18, 12],\n    [9, 19, 8],\n    [9, 20, 15],\n    [10, 19, 7],\n    [10, 21, 11],\n    [11, 20, 9],\n    [11, 22, 14],\n    [12, 21, 6],\n    [12, 23, 10],\n    [13, 22, 8],\n    [13, 24, 13],\n    [14, 23, 12],\n    [14, 25, 7],\n    [15, 24, 9],\n    [15, 26, 11],\n    [16, 25, 15],\n    [16, 27, 6],\n    [17, 26, 8],\n    [17, 28, 14],\n    [18, 27, 10],\n    [18, 29, 12],\n    [19, 30, 7],\n    [20, 30, 13],\n    [21, 30, 9],\n    [22, 31, 11],\n    [23, 31, 6],\n    [24, 31, 15],\n    [25, 32, 8],\n    [26, 32, 12],\n    [27, 32, 10],\n    [28, 32, 14],\n    [29, 32, 7],\n    [30, 33, 16],\n    [31, 33, 13],\n    [32, 33, 11],\n    [9, 21, 5],\n    [10, 22, 8],\n    [11, 23, 7],\n    [12, 24, 9],\n    [13, 25, 12],\n    [14, 26, 6],\n    [15, 27, 10],\n    [16, 28, 14],\n    [17, 29, 8],\n    [19, 31, 11],\n    [20, 32, 7],\n    [21, 33, 9],\n    [22, 30, 13],\n    [23, 30, 6],\n    [24, 30, 12],\n    [25, 31, 10],\n    [26, 31, 15],\n    [27, 32, 8],\n    [28, 33, 14],\n    [29, 33, 11]\n]\n\nsource = 0\nsink = 33\n\npipeline_in_cut = boolvar(shape=len(pipelines))\nwarehouse_side = boolvar(shape=num_warehouses)\n\nmodel = Model()\nmodel += warehouse_side[source] == 0\nmodel += warehouse_side[sink] == 1\n\nfor i, (u, v, capacity) in enumerate(pipelines):\n    model += pipeline_in_cut[i] == (warehouse_side[u] != warehouse_side[v])\n\ntotal_cut_capacity = sum(pipelines[i][2] * pipeline_in_cut[i] for i in range(len(pipelines)))\nmodel.minimize(total_cut_capacity)\n\nif model.solve():\n    critical_pipelines = [i for i in range(len(pipelines)) if pipeline_in_cut[i].value()]\n    result = {\n        \"critical_pipes\": critical_pipelines,\n        \"min_cut_capacity\": total_cut_capacity.value()\n    }\n    print(json.dumps(result))\nelse:\n    print(\"No solution found\")",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"critical_pipes\", \"min_cut_capacity\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        critical_pipes = solution[\"critical_pipes\"]\n        min_cut_capacity = solution[\"min_cut_capacity\"]\n        pipelines = structured_data[\"pipelines\"]\n        num_warehouses = structured_data[\"num_warehouses\"]\n        \n        errors = []\n        \n        if not isinstance(critical_pipes, list):\n            errors.append(\"critical_pipes must be an array\")\n        \n        if not isinstance(min_cut_capacity, (int, float)):\n            errors.append(\"min_cut_capacity must be a number\")\n        \n        for pipe_idx in critical_pipes:\n            if not isinstance(pipe_idx, int) or pipe_idx < 0 or pipe_idx >= len(pipelines):\n                errors.append(f\"Invalid pipe index: {pipe_idx}\")\n        \n        calculated_capacity = sum(pipelines[i][2] for i in critical_pipes if 0 <= i < len(pipelines))\n        if abs(calculated_capacity - min_cut_capacity) > 1e-6:\n            errors.append(f\"Capacity inconsistency: calculated {calculated_capacity}, declared {min_cut_capacity}\")\n        \n        adjacency = [[] for _ in range(num_warehouses)]\n        for i, (u, v, capacity) in enumerate(pipelines):\n            if i not in critical_pipes:\n                adjacency[u].append(v)\n        \n        from collections import deque\n        visited = [False] * num_warehouses\n        queue = deque([0])\n        visited[0] = True\n        found_path = False\n        \n        while queue and not found_path:\n            node = queue.popleft()\n            if node == num_warehouses - 1:\n                found_path = True\n                break\n            for neighbor in adjacency[node]:\n                if not visited[neighbor]:\n                    visited[neighbor] = True\n                    queue.append(neighbor)\n        \n        if found_path:\n            errors.append(\"Cut does not separate source from sink - path still exists\")\n        \n        if len(errors) > 0:\n            optimality_score = 0.0\n        else:\n            optimal_capacity = reference_solution[\"min_cut_capacity\"]\n            if optimal_capacity == 0:\n                optimality_score = 1.0 if min_cut_capacity == 0 else 0.0\n            else:\n                gap = abs(optimal_capacity - min_cut_capacity) / abs(optimal_capacity)\n                optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}