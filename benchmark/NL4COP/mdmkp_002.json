{
  "problem_id": "mdmkp_002",
  "metadata": {
    "problem_type": "Multi-Demand Multidimensional Knapsack Problem",
    "difficulty": "medium"
  },
  "problem_description": "A non-profit organization is planning its community outreach initiatives for the upcoming quarter. They have identified 20 potential activities they could undertake, each with different resource requirements and expected outcomes. They have a total budget of $2,500, 2,000 available volunteer hours, and 700 equipment units at their disposal. To ensure meaningful community involvement, they want to achieve at least 1,200 engagement points across all selected activities. The organization needs to decide which activities to pursue to maximize their total social impact while staying within their resource constraints and meeting the minimum engagement requirement. Each activity can either be selected or not - there are no partial selections possible. Here are the details for each activity: 1. Activity 1: costs $200, requires 150 volunteer hours, needs 50 equipment units, generates 80 engagement points, and has an impact score of 300. 2. Activity 2: costs $150, requires 100 volunteer hours, needs 40 equipment units, generates 90 engagement points, and has an impact score of 250. 3. Activity 3: costs $250, requires 200 volunteer hours, needs 70 equipment units, generates 70 engagement points, and has an impact score of 350. 4. Activity 4: costs $180, requires 120 volunteer hours, needs 45 equipment units, generates 100 engagement points, and has an impact score of 280. 5. Activity 5: costs $220, requires 180 volunteer hours, needs 60 equipment units, generates 85 engagement points, and has an impact score of 320. 6. Activity 6: costs $190, requires 160 volunteer hours, needs 55 equipment units, generates 95 engagement points, and has an impact score of 290. 7. Activity 7: costs $170, requires 140 volunteer hours, needs 48 equipment units, generates 75 engagement points, and has an impact score of 270. 8. Activity 8: costs $210, requires 190 volunteer hours, needs 65 equipment units, generates 88 engagement points, and has an impact score of 310. 9. Activity 9: costs $160, requires 110 volunteer hours, needs 42 equipment units, generates 92 engagement points, and has an impact score of 260. 10. Activity 10: costs $230, requires 170 volunteer hours, needs 68 equipment units, generates 78 engagement points, and has an impact score of 330. 11. Activity 11: costs $140, requires 90 volunteer hours, needs 35 equipment units, generates 105 engagement points, and has an impact score of 240. 12. Activity 12: costs $260, requires 210 volunteer hours, needs 75 equipment units, generates 65 engagement points, and has an impact score of 360. 13. Activity 13: costs $130, requires 80 volunteer hours, needs 30 equipment units, generates 110 engagement points, and has an impact score of 230. 14. Activity 14: costs $240, requires 180 volunteer hours, needs 72 equipment units, generates 82 engagement points, and has an impact score of 340. 15. Activity 15: costs $120, requires 70 volunteer hours, needs 25 equipment units, generates 120 engagement points, and has an impact score of 220. 16. Activity 16: costs $270, requires 220 volunteer hours, needs 80 equipment units, generates 60 engagement points, and has an impact score of 370. 17. Activity 17: costs $110, requires 60 volunteer hours, needs 20 equipment units, generates 125 engagement points, and has an impact score of 210. 18. Activity 18: costs $280, requires 230 volunteer hours, needs 85 equipment units, generates 55 engagement points, and has an impact score of 380. 19. Activity 19: costs $100, requires 50 volunteer hours, needs 15 equipment units, generates 130 engagement points, and has an impact score of 200. 20. Activity 20: costs $290, requires 240 volunteer hours, needs 90 equipment units, generates 50 engagement points, and has an impact score of 390.",
  "solution_format_description": "Print the following fields: - selected_vectors: selection status for each activity. - total_transformation: total impact score. - total_constraints: list resource usage with budget spent, volunteer hours, equipment used, engagement achieved.",
  "structured_data": {
    "vectors": [
      [200, 150, 50, 80, 300], 
      [150, 100, 40, 90, 250], 
      [250, 200, 70, 70, 350], 
      [180, 120, 45, 100, 280], 
      [220, 180, 60, 85, 320], 
      [190, 160, 55, 95, 290], 
      [170, 140, 48, 75, 270], 
      [210, 190, 65, 88, 310], 
      [160, 110, 42, 92, 260], 
      [230, 170, 68, 78, 330], 
      [140, 90, 35, 105, 240], 
      [260, 210, 75, 65, 360], 
      [130, 80, 30, 110, 230], 
      [240, 180, 72, 82, 340], 
      [120, 70, 25, 120, 220], 
      [270, 220, 80, 60, 370], 
      [110, 60, 20, 125, 210], 
      [280, 230, 85, 55, 380], 
      [100, 50, 15, 130, 200], 
      [290, 240, 90, 50, 390]
    ],
    "constraints": [2500, 2000, 700, 1200]
  },
  "reference_solution": {
    "selected_vectors": [1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0],
    "total_transformation": 3900,
    "total_constraints": [2500, 1850, 667, 1317]
  },
  "solver_code": "from cpmpy import *\nimport json\n\nvectors = [\n    [200, 150, 50, 80, 300],   \n    [150, 100, 40, 90, 250],    \n    [250, 200, 70, 70, 350],    \n    [180, 120, 45, 100, 280],   \n    [220, 180, 60, 85, 320],   \n    [190, 160, 55, 95, 290],   \n    [170, 140, 48, 75, 270],  \n    [210, 190, 65, 88, 310],    \n    [160, 110, 42, 92, 260],   \n    [230, 170, 68, 78, 330],  \n    [140, 90, 35, 105, 240],   \n    [260, 210, 75, 65, 360],   \n    [130, 80, 30, 110, 230],   \n    [240, 180, 72, 82, 340],   \n    [120, 70, 25, 120, 220],   \n    [270, 220, 80, 60, 370],   \n    [110, 60, 20, 125, 210],    \n    [280, 230, 85, 55, 380],    \n    [100, 50, 15, 130, 200],   \n    [290, 240, 90, 50, 390]\n]\nconstraints = [2500, 2000, 700, 1200]\n\nnum_vectors = len(vectors)\nmax_financial = constraints[0]\nmax_professional_hours = constraints[1]\nmax_equipment = constraints[2]\nmin_participation = constraints[3]\n\nx = boolvar(shape=num_vectors)\n\nmodel = Model()\n\nmodel += sum(vectors[i][0] * x[i] for i in range(num_vectors)) <= max_financial\nmodel += sum(vectors[i][1] * x[i] for i in range(num_vectors)) <= max_professional_hours\nmodel += sum(vectors[i][2] * x[i] for i in range(num_vectors)) <= max_equipment\nmodel += sum(vectors[i][3] * x[i] for i in range(num_vectors)) >= min_participation\n\nmodel.maximize(sum(vectors[i][4] * x[i] for i in range(num_vectors)))\n\nif model.solve():\n    selected = [int(x[i].value()) for i in range(num_vectors)]\n    total_transformation = sum(vectors[i][4] * selected[i] for i in range(num_vectors))\n    total_financial_cost = sum(vectors[i][0] * selected[i] for i in range(num_vectors))\n    total_professional_hours = sum(vectors[i][1] * selected[i] for i in range(num_vectors))\n    total_equipment_units = sum(vectors[i][2] * selected[i] for i in range(num_vectors))\n    total_participation_metrics = sum(vectors[i][3] * selected[i] for i in range(num_vectors))\n    \n    result = {\n        \"selected_vectors\": selected,\n        \"total_transformation\": total_transformation,\n        \"total_constraints\": [total_financial_cost, total_professional_hours, total_equipment_units, total_participation_metrics]\n    }\n    print(json.dumps(result))\nelse:\n    print(\"No solution found\")",  
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"selected_vectors\", \"total_transformation\", \"total_constraints\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        selected = solution[\"selected_vectors\"]\n        total_constraints = solution[\"total_constraints\"]\n        total_financial_cost = total_constraints[0]\n        total_professional_hours = total_constraints[1]\n        total_equipment_units = total_constraints[2]\n        total_participation_metrics = total_constraints[3]\n        \n        vectors = structured_data[\"vectors\"]\n        constraints = structured_data[\"constraints\"]\n        num_vectors = len(vectors)\n        errors = []\n        \n        if len(selected) != num_vectors:\n            errors.append(f\"Selection array length mismatch: expected {num_vectors}, got {len(selected)}\")\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        for i in range(num_vectors):\n            if selected[i] not in [0, 1]:\n                errors.append(f\"Invalid selection value at index {i}: {selected[i]} (must be 0 or 1)\")\n        \n        if total_financial_cost > constraints[0]:\n            errors.append(f\"Financial constraint violated: {total_financial_cost} > {constraints[0]}\")\n        \n        if total_professional_hours > constraints[1]:\n            errors.append(f\"Professional hours constraint violated: {total_professional_hours} > {constraints[1]}\")\n        \n        if total_equipment_units > constraints[2]:\n            errors.append(f\"Equipment constraint violated: {total_equipment_units} > {constraints[2]}\")\n        \n        if total_participation_metrics < constraints[3]:\n            errors.append(f\"Participation requirement not met: {total_participation_metrics} < {constraints[3]}\")\n        \n        if len(errors) == 0:\n            optimal_value = reference_solution[\"total_transformation\"]\n            if optimal_value == 0:\n                optimality_score = 1.0 if solution[\"total_transformation\"] == 0 else 0.0\n            else:\n                gap = abs(optimal_value - solution[\"total_transformation\"]) / abs(optimal_value)\n                optimality_score = max(0, 1 - gap)\n        else:\n            optimality_score = 0.0\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}