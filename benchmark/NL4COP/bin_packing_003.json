{
  "problem_id": "bin_packing_003",
  "metadata": {
    "problem_type": "Bin Packing Problem",
    "difficulty": "hard"
  },
  "problem_description": "A logistics company needs to pack a set of parcels into delivery trucks for an upcoming shipment. Each parcel has a specific volume, and all trucks have the same cargo capacity. To minimize fuel costs and the number of trips, the company wants to use as few trucks as possible while ensuring that the total volume of parcels in each truck does not exceed its capacity.\n\nThe company has prepared the following 50 parcels for loading:\n1. Parcel A: 45.2 cubic units\n2. Parcel B: 32.1 cubic units\n3. Parcel C: 28.7 cubic units\n4. Parcel D: 39.8 cubic units\n5. Parcel E: 21.7 cubic units\n6. Parcel F: 48.3 cubic units\n7. Parcel G: 35.6 cubic units\n8. Parcel H: 27.4 cubic units\n9. Parcel I: 41.9 cubic units\n10. Parcel J: 33.3 cubic units\n11. Parcel K: 29.1 cubic units\n12. Parcel L: 46.7 cubic units\n13. Parcel M: 37.8 cubic units\n14. Parcel N: 24.9 cubic units\n15. Parcel O: 31.2 cubic units\n16. Parcel P: 42.6 cubic units\n17. Parcel Q: 26.5 cubic units\n18. Parcel R: 38.4 cubic units\n19. Parcel S: 49.0 cubic units\n20. Parcel T: 22.8 cubic units\n21. Parcel U: 30.1 cubic units\n22. Parcel V: 47.5 cubic units\n23. Parcel W: 34.2 cubic units\n24. Parcel X: 28.9 cubic units\n25. Parcel Y: 36.7 cubic units\n26. Parcel Z: 43.1 cubic units\n27. Parcel AA: 25.5 cubic units\n28. Parcel AB: 39.4 cubic units\n29. Parcel AC: 40.2 cubic units\n30. Parcel AD: 23.6 cubic units\n31. Parcel AE: 31.8 cubic units\n32. Parcel AF: 44.9 cubic units\n33. Parcel AG: 35.3 cubic units\n34. Parcel AH: 27.7 cubic units\n35. Parcel AI: 48.8 cubic units\n36. Parcel AJ: 36.2 cubic units\n37. Parcel AK: 29.5 cubic units\n38. Parcel AL: 41.1 cubic units\n39. Parcel AM: 26.3 cubic units\n40. Parcel AN: 37.6 cubic units\n41. Parcel AO: 45.9 cubic units\n42. Parcel AP: 24.4 cubic units\n43. Parcel AQ: 32.5 cubic units\n44. Parcel AR: 46.1 cubic units\n45. Parcel AS: 28.2 cubic units\n46. Parcel AT: 33.8 cubic units\n47. Parcel AU: 39.7 cubic units\n48. Parcel AV: 27.1 cubic units\n49. Parcel AW: 42.3 cubic units\n50. Parcel AX: 30.0 cubic units\n\nEach truck has a cargo capacity of 100 cubic units. The company needs to determine how to assign these 50 parcels to the trucks such that the total number of trucks used is minimized, and no truck exceeds its capacity. Each parcel must be loaded into exactly one truck.",
  "solution_format_description": "Print the following fields: - num_trucks: total number of trucks used. - truck_loads: parcel indices assigned to each truck.",
  "structured_data": {
    "truck_capacity": 100,
    "num_parcels": 50,
    "parcel_volumes": [45.2, 32.1, 28.7, 39.8, 21.7, 48.3, 35.6, 27.4, 41.9, 33.3, 29.1, 46.7, 37.8, 24.9, 31.2, 42.6, 26.5, 38.4, 49.0, 22.8, 30.1, 47.5, 34.2, 28.9, 36.7, 43.1, 25.5, 39.4, 40.2, 23.6, 31.8, 44.9, 35.3, 27.7, 48.8, 36.2, 29.5, 41.1, 26.3, 37.6, 45.9, 24.4, 32.5, 46.1, 28.2, 33.8, 39.7, 27.1, 42.3, 30.0]
  },
  "reference_solution": {
    "num_trucks": 18,
    "truck_loads": [
      [1, 11, 27],
      [33, 42, 47],
      [37, 39, 49],
      [20, 25, 29],
      [6, 12],
      [21, 34, 38],
      [16, 35],
      [9, 14, 43],
      [7, 28, 30],
      [19, 41],
      [22, 44],
      [8, 18, 23],
      [3, 26, 48],
      [4, 15, 24],
      [31, 40, 50],
      [10, 13, 17],
      [2, 5, 32],
      [36, 45, 46]
    ]
  },
  "solver_code": "from cpmpy import *\nimport json\n\ntruck_capacity = 100\nnum_parcels = 50\nparcel_volumes = [45.2, 32.1, 28.7, 39.8, 21.7, 48.3, 35.6, 27.4, 41.9, 33.3, 29.1, 46.7, 37.8, 24.9, 31.2, 42.6, 26.5, 38.4, 49.0, 22.8, 30.1, 47.5, 34.2, 28.9, 36.7, 43.1, 25.5, 39.4, 40.2, 23.6, 31.8, 44.9, 35.3, 27.7, 48.8, 36.2, 29.5, 41.1, 26.3, 37.6, 45.9, 24.4, 32.5, 46.1, 28.2, 33.8, 39.7, 27.1, 42.3, 30.0]\n\ny = boolvar(shape=num_parcels, name=\"y\")\nx = boolvar(shape=(num_parcels, num_parcels), name=\"x\")\n\nmodel = Model()\n\nfor i in range(num_parcels):\n    model += sum(x[i][j] for j in range(num_parcels)) == 1\n\nscaled_volumes = [int(v * 10) for v in parcel_volumes]\nscaled_capacity = int(truck_capacity * 10)\nfor j in range(num_parcels):\n    model += sum(x[i][j] * scaled_volumes[i] for i in range(num_parcels)) <= scaled_capacity * y[j]\n\nfor j in range(num_parcels - 1):\n    model += y[j] >= y[j+1]\n\nmodel.minimize(sum(y[j] for j in range(num_parcels)))\n\nif model.solve():\n    trucks_used = sum(int(y[j].value()) for j in range(num_parcels))\n\n    truck_loads = []\n    for j in range(num_parcels):\n        if y[j].value():\n            load = [i + 1 for i in range(num_parcels) if x[i][j].value()]\n            truck_loads.append(load)\n            \n    result = {\n        \"num_trucks\": trucks_used,\n        \"truck_loads\": truck_loads[:trucks_used]\n    }\n    print(json.dumps(result))\nelse:\n     print(\"No solution found by the solver.\")",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Invalid JSON format: {e}\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"num_trucks\", \"truck_loads\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        num_trucks = solution[\"num_trucks\"]\n        truck_loads = solution[\"truck_loads\"]\n        truck_capacity = structured_data[\"truck_capacity\"]\n        num_parcels = structured_data[\"num_parcels\"]\n        parcel_volumes = structured_data[\"parcel_volumes\"]\n\n        errors = []\n        \n        if not isinstance(num_trucks, int) or num_trucks < 0:\n             errors.append(f\"num_trucks must be a non-negative integer, got {type(num_trucks)} with value {num_trucks}.\")\n             return {\n                \"is_valid\": False,\n                \"validation_errors\": errors,\n                \"optimality_score\": 0.0\n             }\n             \n        if not isinstance(truck_loads, list):\n             errors.append(f\"truck_loads must be a list, got {type(truck_loads)}.\")\n        else:\n            if len(truck_loads) != num_trucks:\n                errors.append(f\"Length of 'truck_loads' list ({len(truck_loads)}) does not match 'num_trucks' ({num_trucks}).\")\n            \n            parcel_counts = [0] * (num_parcels + 1)\n            for truck_index, load in enumerate(truck_loads, start=1):\n                if not isinstance(load, list):\n                    errors.append(f\"Truck {truck_index} load must be a list of parcel indices, got {type(load)}.\")\n                    continue\n                    \n                load_total = 0\n                for parcel_idx in load:\n                    if not isinstance(parcel_idx, int) or parcel_idx < 1 or parcel_idx > num_parcels:\n                        errors.append(f\"Truck {truck_index} contains an invalid parcel index: {parcel_idx}. Indices must be integers between 1 and {num_parcels}.\")\n                        continue\n                    load_total += parcel_volumes[parcel_idx - 1]\n                    parcel_counts[parcel_idx] += 1\n                if load_total > truck_capacity + 1e-6:\n                    errors.append(f\"Truck {truck_index} exceeds capacity: total volume {load_total} > capacity {truck_capacity}.\")\n\n            for i in range(1, num_parcels + 1):\n                if parcel_counts[i] != 1:\n                    errors.append(f\"Parcel {i} appears {parcel_counts[i]} times (expected exactly once).\")\n\n        is_valid = len(errors) == 0\n        \n        if not is_valid:\n            optimality_score = 0.0\n        else:\n            optimal_trucks = reference_solution[\"num_trucks\"]\n            candidate_num_trucks = num_trucks\n            if optimal_trucks == 0:\n                optimality_score = 1.0 if candidate_num_trucks == 0 else 0.0\n            else:\n                gap = abs(optimal_trucks - candidate_num_trucks) / abs(optimal_trucks)\n                optimality_score = max(0.0, 1.0 - gap)\n\n        \n        return {\n            \"is_valid\": is_valid,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Unexpected error during evaluation: {e}\"], \"optimality_score\": 0.0}"
}