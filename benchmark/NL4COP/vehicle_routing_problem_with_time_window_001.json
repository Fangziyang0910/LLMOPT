{
  "problem_id": "vehicle_routing_problem_with_time_window_001",
  "metadata": {
    "problem_type": "Vehicle Routing Problem with Time Window",
    "difficulty": "simple"
  },
  "problem_description": "A medical supply company needs to coordinate vaccine deliveries to 10 different healthcare facilities using 3 refrigerated trucks. All trucks must start their routes from the company's distribution center located in the city center and must return to the distribution center after completing their deliveries. Each truck can carry up to 50 vaccine packages. All deliveries must be completed within 480 minutes to maintain vaccine efficacy, and each facility has specific time period when they can receive deliveries to match their vaccination schedules. Vehicles travel at an average speed of 30 km/h within the city, and any two locations can be reached directly by traveling in a straight line. The distribution center serves as the coordinate origin (0, 0), with all coordinates measured in kilometers. Facility details: 1. North Clinic at coordinates (10, 15): needs 8 packages, available between 30-90 minutes, requires 15 minutes for unloading; 2. East Pharmacy at coordinates (20, 5): needs 6 packages, available between 60-120 minutes, requires 20 minutes for unloading; 3. West Hospital at coordinates (15, 25): needs 7 packages, available between 45-105 minutes, requires 15 minutes for unloading; 4. South Medical Center at coordinates (30, 10): needs 9 packages, available between 90-150 minutes, requires 25 minutes for unloading; 5. Central Clinic at coordinates (25, 30): needs 5 packages, available between 120-180 minutes, requires 10 minutes for unloading; 6. Downtown Health Center at coordinates (35, 20): needs 10 packages, available between 150-210 minutes, requires 30 minutes for unloading; 7. Suburban Medical Plaza at coordinates (40, 15): needs 4 packages, available between 180-240 minutes, requires 15 minutes for unloading; 8. Riverside Clinic at coordinates (45, 25): needs 6 packages, available between 210-270 minutes, requires 20 minutes for unloading; 9. Uptown Hospital at coordinates (20, 35): needs 8 packages, available between 240-300 minutes, requires 15 minutes for unloading; 10. District Health Center at coordinates (50, 20): needs 7 packages, available between 270-330 minutes, requires 25 minutes for unloading. Each facility must receive exactly one delivery, and no truck can exceed its 50-package capacity. Vehicles must arrive at each facility within its specified time window; if arriving early, the vehicle must wait until the facility's available time. The company needs to determine the optimal routes for each truck to ensure all vaccines are delivered on time while minimizing total travel distance.",  
  "solution_format_description": "Print the following fields: - routes: for each truck, list the complete route sequence. - total_time: maximum completion time among all trucks. - total_distance: sum of all travel distances. - vehicle_loads: total packages carried by each truck.",  
  "structured_data": {
    "truck_count": 3,
    "truck_capacity": 50,
    "truck_speed": 30.0,
    "distribution_center": [0, 0, 480],
    "facilities": [
      [10, 15, 8, 30, 90, 15],
      [20, 5, 6, 60, 120, 20],
      [15, 25, 7, 45, 105, 15],
      [30, 10, 9, 90, 150, 25],
      [25, 30, 5, 120, 180, 10],
      [35, 20, 10, 150, 210, 30],
      [40, 15, 4, 180, 240, 15],
      [45, 25, 6, 210, 270, 20],
      [20, 35, 8, 240, 300, 15],
      [50, 20, 7, 270, 330, 25]
    ]
  },
  "reference_solution": {
    "routes": [
      [0, 1, 3, 5, 9, 0],
      [0, 2, 4, 6, 7, 8, 10, 0],
      [0, 0]
    ],
    "total_time": 403,
    "total_distance": 209.92,
    "vehicle_loads": [28, 42, 0]
  },
  "solver_code": "",
  "evaluation_function": "import json\nimport numpy as np\n\ndef evaluate(candidate_solution, structured_data, reference_solution):\n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"routes\", \"total_distance\", \"total_time\"]\n    missing = [f for f in required_fields if f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    routes = solution[\"routes\"]\n    total_distance = solution[\"total_distance\"]\n    total_time = solution[\"total_time\"]\n    facilities = structured_data[\"facilities\"]\n    truck_count = structured_data[\"truck_count\"]\n    truck_capacity = structured_data[\"truck_capacity\"]\n    dist_center = structured_data[\"distribution_center\"]\n    truck_speed = structured_data[\"truck_speed\"]\n    \n    all_visited = set()\n    for route in routes:\n        if not isinstance(route, list):\n            return {\"is_valid\": False, \"validation_errors\": [\"Each route must be a list\"], \"optimality_score\": 0.0}\n        \n        for facility_id in route:\n            if facility_id == 0:\n                continue\n            if not isinstance(facility_id, int) or facility_id < 1 or facility_id > len(facilities):\n                return {\"is_valid\": False, \"validation_errors\": [\"Invalid facility ID\"], \"optimality_score\": 0.0}\n            all_visited.add(facility_id)\n    \n    expected_facilities = set(range(1, len(facilities) + 1))\n    if all_visited != expected_facilities:\n        return {\"is_valid\": False, \"validation_errors\": [\"Not all facilities visited\"], \"optimality_score\": 0.0}\n    \n    for k, route in enumerate(routes):\n        total_load = sum(facilities[f-1][2] for f in route if f > 0)\n        if total_load > truck_capacity:\n            return {\"is_valid\": False, \"validation_errors\": [f\"Truck {k} capacity exceeded\"], \"optimality_score\": 0.0}\n    \n    all_points = [[dist_center[0], dist_center[1]]] + [[f[0], f[1]] for f in facilities]\n    distance_matrix = np.zeros((len(all_points), len(all_points)))\n    for i in range(len(all_points)):\n        for j in range(len(all_points)):\n            if i != j:\n                dx = all_points[i][0] - all_points[j][0]\n                dy = all_points[i][1] - all_points[j][1]\n                distance_matrix[i][j] = np.sqrt(dx*dx + dy*dy)\n    \n    time_matrix = distance_matrix * 60 / truck_speed\n    \n    for k, route in enumerate(routes):\n        if not route:\n            continue\n            \n        current_time = 0\n        current_loc = 0\n        \n        for facility_id in route:\n            travel_time = time_matrix[current_loc][facility_id]\n            current_time += travel_time\n            \n            if facility_id > 0:\n                earliest = facilities[facility_id-1][3]\n                latest = facilities[facility_id-1][4]\n                service_time = facilities[facility_id-1][5]\n                \n                adjusted_arrival = max(current_time, earliest)\n                \n                if adjusted_arrival > latest:\n                    return {\"is_valid\": False, \"validation_errors\": [f\"Time window violation at facility {facility_id}\"], \"optimality_score\": 0.0}\n                \n                current_time = adjusted_arrival + service_time\n            current_loc = facility_id\n        \n        if current_loc != 0:\n            travel_time = time_matrix[current_loc][0]\n            current_time += travel_time\n        \n        if current_time > dist_center[2]:\n            return {\"is_valid\": False, \"validation_errors\": [f\"Total time constraint violated for truck {k}\"], \"optimality_score\": 0.0}\n    \n    optimal_distance = reference_solution[\"total_distance\"]\n    \n    if optimal_distance > 0:\n        optimality_score = max(0, 1 - abs(total_distance - optimal_distance) / optimal_distance)\n    else:\n        optimality_score = 1.0 if total_distance == 0 else 0.0\n    \n    return {\n        \"is_valid\": True,\n        \"validation_errors\": [],\n        \"optimality_score\": optimality_score\n    }"
}