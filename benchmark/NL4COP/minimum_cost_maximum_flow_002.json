{
  "problem_id": "minimum_cost_maximum_flow_002",
  "metadata": {
    "problem_type": "Minimum Cost Maximum Flow Problem",
    "difficulty": "medium"
  },
  "problem_description": "A global airline operates a flight network with 20 airports connected by 30 flight routes, each with specific passenger capacity limits and operating costs. The airline operations manager needs to determine how to optimize passenger transportation from the main hub airport to the final destination airport by carrying as many passengers as possible while keeping total operating costs as low as possible. The flight network system consists of multiple layers: the hub layer connects to primary regional airports, the middle layer provides inter-regional connections through transfer airports, and the final layer delivers passengers to the destination airport. Each flight route has a maximum passenger capacity and an operating cost per passenger. At each intermediate airport, the total incoming passengers must equal the total outgoing passengers. No flight route can carry more passengers than its capacity limit, and all passenger flows follow the specified directions. The complete flight network details are as follows: From Hub Airport: to Airport A with capacity 15 passengers and cost $2 per passenger; to Airport B with capacity 12 passengers and cost $3 per passenger. From Airport A: to Airport C with capacity 8 passengers and cost $1 per passenger; to Airport G with capacity 10 passengers and cost $2 per passenger. From Airport B: to Airport D with capacity 9 passengers and cost $4 per passenger; to Airport H with capacity 11 passengers and cost $2 per passenger. From Airport C: to Airport E with capacity 7 passengers and cost $3 per passenger; to Airport I with capacity 13 passengers and cost $1 per passenger. From Airport D: to Airport F with capacity 6 passengers and cost $5 per passenger; to Airport J with capacity 14 passengers and cost $2 per passenger. From Airport E: to Airport K with capacity 16 passengers and cost $2 per passenger. From Airport F: to Airport J with capacity 8 passengers and cost $3 per passenger. From Airport G: to Airport L with capacity 9 passengers and cost $2 per passenger; to Airport M with capacity 12 passengers and cost $1 per passenger. From Airport H: to Airport L with capacity 7 passengers and cost $4 per passenger; to Airport N with capacity 10 passengers and cost $2 per passenger. From Airport I: to Airport M with capacity 11 passengers and cost $3 per passenger; to Airport O with capacity 8 passengers and cost $2 per passenger. From Airport J: to Airport N with capacity 13 passengers and cost $1 per passenger; to Airport P with capacity 9 passengers and cost $4 per passenger. From Airport K: to Airport O with capacity 14 passengers and cost $2 per passenger; to Airport Q with capacity 10 passengers and cost $3 per passenger. From Airport L: to Airport R with capacity 15 passengers and cost $2 per passenger. From Airport M: to Airport R with capacity 12 passengers and cost $4 per passenger. From Airport N: to Airport R with capacity 8 passengers and cost $3 per passenger. From Airport O: to Airport Q with capacity 11 passengers and cost $2 per passenger. From Airport P: to Airport R with capacity 13 passengers and cost $1 per passenger. From Airport Q: to Destination Airport with capacity 18 passengers and cost $2 per passenger. From Airport R: to Destination Airport with capacity 20 passengers and cost $3 per passenger. From Airport E: to Airport Q with capacity 9 passengers and cost $4 per passenger.",
  "solution_format_description": "Print the following fields: - max_passengers: maximum passenger flow from hub to destination. - total_cost: total operating cost. - passenger_distribution: for each flight route, list passenger amount with from airport, to airport, passenger amount.",  
  "structured_data": {
    "num_airports": 20,
    "flight_routes": [
      [0, 1, 15, 2],
      [0, 2, 12, 3],
      [1, 3, 8, 1],
      [1, 7, 10, 2],
      [2, 4, 9, 4],
      [2, 8, 11, 2],
      [3, 5, 7, 3],
      [3, 9, 13, 1],
      [4, 6, 6, 5],
      [4, 10, 14, 2],
      [5, 11, 16, 2],
      [5, 17, 9, 4],
      [6, 10, 8, 3],
      [7, 12, 9, 2],
      [7, 13, 12, 1],
      [8, 12, 7, 4],
      [8, 14, 10, 2],
      [9, 13, 11, 3],
      [9, 15, 8, 2],
      [10, 14, 13, 1],
      [10, 16, 9, 4],
      [11, 15, 14, 2],
      [11, 17, 10, 3],
      [12, 18, 15, 2],
      [13, 18, 12, 4],
      [14, 18, 8, 3],
      [15, 17, 11, 2],
      [16, 18, 13, 1],
      [17, 19, 18, 2],
      [18, 19, 20, 3]
    ]
  },
  "reference_solution": {
    "max_passengers": 27,
    "total_cost": 320,
    "passenger_distribution": [[0, 1, 15], [0, 2, 12], [1, 3, 8], [1, 7, 7], [2, 4, 1], [2, 8, 11], [3, 9, 8], [4, 10, 1], [7, 12, 7], [8, 12, 3], [8, 14, 8], [9, 15, 8], [10, 16, 1], [12, 18, 10], [14, 18, 8], [15, 17, 8], [16, 18, 1], [17, 19, 8], [18, 19, 19]]
  },
  "solver_code": "",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"max_passengers\", \"total_cost\", \"passenger_distribution\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        max_passengers = solution[\"max_passengers\"]\n        total_cost = solution[\"total_cost\"]\n        passenger_distribution = solution[\"passenger_distribution\"]\n        flight_routes = structured_data[\"flight_routes\"]\n        num_airports = structured_data[\"num_airports\"]\n        source = 0\n        sink = 19\n        \n        errors = []\n        \n        capacity = [[0] * num_airports for _ in range(num_airports)]\n        cost = [[0] * num_airports for _ in range(num_airports)]\n        for from_node, to_node, cap, c in flight_routes:\n            capacity[from_node][to_node] = cap\n            cost[from_node][to_node] = c\n        \n        inflow = [0] * num_airports\n        outflow = [0] * num_airports\n        actual_cost = 0\n        \n        for passenger_item in passenger_distribution:\n            from_node, to_node, passenger_amount = passenger_item\n            \n            if passenger_amount > capacity[from_node][to_node]:\n                errors.append(f\"Passengers {passenger_amount} exceeds capacity {capacity[from_node][to_node]} on route {from_node}->{to_node}\")\n            \n            if passenger_amount < 0:\n                errors.append(f\"Negative passengers {passenger_amount} on route {from_node}->{to_node}\")\n            \n            outflow[from_node] += passenger_amount\n            inflow[to_node] += passenger_amount\n            actual_cost += passenger_amount * cost[from_node][to_node]\n        \n        if outflow[source] != max_passengers:\n            errors.append(f\"Hub airport outflow {outflow[source]} != max_passengers {max_passengers}\")\n        \n        if inflow[sink] != max_passengers:\n            errors.append(f\"Destination airport inflow {inflow[sink]} != max_passengers {max_passengers}\")\n        \n        for i in range(num_airports):\n            if i != source and i != sink:\n                if abs(inflow[i] - outflow[i]) > 1e-6:\n                    errors.append(f\"Passenger conservation violation at airport {i}: inflow {inflow[i]} != outflow {outflow[i]}\")\n        \n        if abs(actual_cost - total_cost) > 1e-6:\n            errors.append(f\"Cost calculation error: actual {actual_cost} != declared {total_cost}\")\n        \n        is_valid = len(errors) == 0\n        \n        if not is_valid:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        optimal_passengers = reference_solution[\"max_passengers\"]\n        optimal_cost = reference_solution[\"total_cost\"]\n        \n        if max_passengers != optimal_passengers:\n            gap = abs(optimal_passengers - max_passengers) / abs(optimal_passengers)\n            flow_score = max(0, 1 - gap)\n        else:\n            flow_score = 1.0\n        \n        if optimal_cost == 0:\n            cost_score = 1.0 if total_cost == 0 else 0.0\n        else:\n            gap = abs(optimal_cost - total_cost) / abs(optimal_cost)\n            cost_score = max(0, 1 - gap)\n        \n        optimality_score = 0.7 * flow_score + 0.3 * cost_score\n        \n        return {\n            \"is_valid\": is_valid,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}