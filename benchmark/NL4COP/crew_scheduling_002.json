{
  "problem_id": "crew_scheduling_002",
  "metadata": {
    "problem_type": "Crew Scheduling Problem",
    "difficulty": "medium"
  },
  "problem_description": "Within the sophisticated operational framework of a multinational cinematic production enterprise, a complex temporal coordination optimization challenge emerges requiring the strategic scheduling of 23 distinct cinematographic sequences across diverse geographical locations. The organization maintains four specialized technical execution teams available for deployment, each operating under continuous duty cycles constrained by regulatory limitations to 500 minutes maximum service duration to ensure operational efficiency and personnel welfare. Inter-location transitions incur quantifiable temporal expenditure encompassing equipment relocation logistics and human capital temporal costs. The optimization paradigm requires determining an optimal sequence allocation strategy that minimizes cumulative temporal expenditure associated with team repositioning between cinematographic sequences, while maintaining compliance with operational protocols: all cinematographic sequences must be exclusively assigned to technical execution teams, sequences allocated to identical teams must be temporally segregated without temporal overlap, aggregate service duration for any team shall not exceed the 500-minute regulatory threshold, and valid transition pathways must exist between consecutive sequences assigned to the same team. The temporal parameters for cinematographic sequences are systematically indexed from 0 through 22, with execution windows defined as follows: Sequence 0 executes within the temporal interval commencing at minute 0 and concluding at minute 50; Sequence 1 operates between minute 60 and minute 110; Sequence 2 spans the interval from minute 120 through minute 170; Sequence 3 is scheduled between minutes 180 and 230; Sequence 4 occupies the timeframe from minute 240 to minute 290; Sequence 5 extends from minute 300 through minute 350; Sequence 6 begins at minute 360 and terminates at minute 410; Sequence 7 encompasses the period from minute 420 to minute 470; Sequence 8 is allocated to the interval from minute 80 to minute 130; Sequence 9 runs from minute 140 through minute 190; Sequence 10 executes within the temporal interval commencing at minute 200 and concluding at minute 250; Sequence 11 operates between minute 260 and minute 310; Sequence 12 spans the interval from minute 320 through minute 370; Sequence 13 is scheduled between minutes 380 and 430; Sequence 14 occupies the timeframe from minute 440 to minute 490; Sequence 15 extends from minute 100 through minute 150; Sequence 16 begins at minute 160 and terminates at minute 210; Sequence 17 encompasses the period from minute 220 to minute 270; Sequence 18 is allocated to the interval from minute 280 to minute 330; Sequence 19 runs from minute 340 through minute 390; Sequence 20 executes within the temporal interval commencing at minute 400 and concluding at minute 450; Sequence 21 operates between minute 460 and minute 510; and Sequence 22 spans the interval from minute 500 through minute 555. Technical execution teams moving between cinematographic sequences incur specific transition times. From Sequence 0, the transition times are: 10 minutes to Sequence 1; 20 minutes to Sequence 8; 30 minutes to Sequence 15; 40 minutes to Sequence 2; 50 minutes to Sequences 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 16, 17, 18, 19, 20, 21, 22. From Sequence 1, transition times are: 10 minutes to Sequence 2; 20 minutes to Sequences 9 ; 30 minutes to Sequences 16 ; 40 minutes to Sequence 3; 50 minutes to Sequences 4, 5, 6, 7, 10, 11, 12, 13, 14, 17, 18, 19, 20, 21, and 22. From Sequence 2, transition times are: 10 minutes to Sequence 3; 40 minutes to Sequence 4; 20 minutes to Sequences 10; 30 minutes to Sequence 17; and 50 minutes to Sequences 5, 6, 7, 11, 12, 13, 14, 18, 19, 20, 21, 22. From Sequence 3, transition times are: 10 minutes to Sequence 4; 40 minutes to Sequence 5; 20 minutes to Sequences 11; 30 minutes to Sequences 18; 50 minutes to Sequences 6, 7, 12, 13, 14, 19, 20, 21, 22. From Sequence 4, transition times are: 10 minutes to Sequence 5; 40 minutes to Sequence 6; 20 minutes to Sequences 12; 30 minutes to Sequences 19; and 50 minutes to Sequences 7, 13, 14, 20, 21, 22. From Sequence 5, transition times are: 10 minutes to Sequence 6, 40 minutes to Sequence 7, 20 minutes to Sequences 13; 30 minutes to Sequences 20; and 50 minutes to Sequences 14, 21, 22. From Sequence 6, transition times are: 10 minutes to Sequence 7, 20 minutes to Sequences 14; 30 minutes to Sequences 21; 50 minutes to Sequence 22. From Sequence 7, the transition time is 20 minutes to Sequence 22. From Sequence 8, transition times are: 10 minutes to Sequence 9; 20 minutes to Sequences 16; 30 minutes to Sequence 3; 40 minutes to Sequence 10; 50 minutes to Sequences 4, 5, 6, 7, 11, 12, 13, 14, 17, 18, 19, 20, 21, 22. From Sequence 9, transition times are: 10 minutes to Sequence 10; 20 minutes to Sequences 17; 30 minutes to Sequence 4; 40 minutes to Sequence 11; and 50 minutes to Sequences 5, 6, 7, 12, 13, 14, 18, 19, 20, 21, 22. From Sequence 10, transition times are: 10 minutes to Sequence 11; 20 minutes to Sequences 18; 30 minutes to Sequence 5; 40 minutes to Sequence 12; and 50 minutes to Sequences 6, 7, 13, 14, 19, 20, 21, 22. From Sequence 11, transition times are: 10 minutes to Sequence 12; 20 minutes to Sequences 19; 30 minutes to Sequence 6; 40 minutes to Sequence 13; 50 minutes to Sequences 7, 14, 20, 21, 22. From Sequence 12, transition times are: 10 minutes to Sequence 13; 20 minutes to Sequences 20; 30 minutes to Sequence 7; 40 minutes to Sequence 14; 50 minutes to Sequences 21, 22. From Sequence 13, transition times are: 10 minutes to Sequence 14; 20 minutes to Sequence 21, and 40 minutes to Sequence 22. From Sequence 14, the transition time is 10 minutes to Sequence 22. From Sequence 15, transition times are: 10 minutes to Sequence 16; 20 minutes to Sequences 3; 30 minutes to Sequence 10; 40 minutes to Sequences 17; 50 minutes to Sequences 4, 5, 6, 7, 11, 12, 13, 14, 18, 19, 20, 21, 22. From Sequence 16, transition times are: 10 minutes to Sequence 17; 20 minutes to Sequences 4; 30 minutes to Sequence 11; 40 minutes to Sequence 18; and 50 minutes to Sequences 5, 6, 7, 12, 13, 14, 19, 20, 21, 22. From Sequence 17, transition times are: 10 minutes to Sequence 18; 20 minutes to Sequences 5; 30 minutes to Sequence 12; 40 minutes to Sequence 19; 50 minutes to Sequences 6, 7, 13, 14, 20, 21, and 22. From Sequence 18, transition times are: 10 minutes to Sequence 19; 20 minutes to Sequences 6; 30 minutes to Sequence 13; 40 minutes to Sequence 20; 50 minutes to Sequences 7, 14, 21, 22. From Sequence 19, transition times are: 10 minutes to Sequence 20; 20 minutes to Sequences 7; 30 minutes to Sequence 14; 40 minutes to Sequence 21; and 50 minutes to Sequence 22. From Sequence 20, transition times are: 10 minutes to Sequence 21; 30 minutes to Sequence 22. These transition times are essential for calculating the total travel time when crews work on multiple sequences.",  
  "solution_format_description": "Print the following fields: - crews: scene assignments for each crew. - total_travel_time: total travel time between scenes.",
  "structured_data": {
    "num_crews": 4,
    "shift_duration_limit": 500,
    "scenes": [
      [0, 50],    [60, 110],  [120, 170], [180, 230], [240, 290],
      [300, 350], [360, 410], [420, 470], [80, 130],   [140, 190],
      [200, 250], [260, 310], [320, 370], [380, 430], [440, 490],
      [100, 150], [160, 210], [220, 270], [280, 330], [340, 390],
      [400, 450], [460, 510], [500, 555]
    ],
    "transition_costs": [
    [0, 1, 10], [0, 2, 40], [0, 3, 50], [0, 4, 50], [0, 5, 50], [0, 6, 50], [0, 7, 50], [0, 8, 20], [0, 9, 50], [0, 10, 50], [0, 11, 50], [0, 12, 50], [0, 13, 50], [0, 14, 50], [0, 15, 30], [0, 16, 50], [0, 17, 50], [0, 18, 50], [0, 19, 50], [0, 20, 50], [0, 21, 50], [0, 22, 50], 
    [1, 2, 10], [1, 3, 40], [1, 4, 50], [1, 5, 50], [1, 6, 50], [1, 7, 50], [1, 9, 20], [1, 10, 50], [1, 11, 50], [1, 12, 50], [1, 13, 50], [1, 14, 50], [1, 16, 30], [1, 17, 50], [1, 18, 50], [1, 19, 50], [1, 20, 50], [1, 21, 50], [1, 22, 50], 
    [2, 3, 10], [2, 4, 40], [2, 5, 50], [2, 6, 50], [2, 7, 50], [2, 10, 20], [2, 11, 50], [2, 12, 50], [2, 13, 50], [2, 14, 50], [2, 17, 30], [2, 18, 50], [2, 19, 50], [2, 20, 50], [2, 21, 50], [2, 22, 50], 
    [3, 4, 10], [3, 5, 40], [3, 6, 50], [3, 7, 50], [3, 11, 20], [3, 12, 50], [3, 13, 50], [3, 14, 50], [3, 18, 30], [3, 19, 50], [3, 20, 50], [3, 21, 50], [3, 22, 50], 
    [4, 5, 10], [4, 6, 40], [4, 7, 50], [4, 12, 20], [4, 13, 50], [4, 14, 50], [4, 19, 30], [4, 20, 50], [4, 21, 50], [4, 22, 50], 
    [5, 6, 10], [5, 7, 40], [5, 13, 20], [5, 14, 50], [5, 20, 30], [5, 21, 50], [5, 22, 50], 
    [6, 7, 10], [6, 14, 20], [6, 21, 30], [6, 22, 50], 
    [7, 22, 20], 
    [8, 3, 30], [8, 4, 50], [8, 5, 50], [8, 6, 50], [8, 7, 50], [8, 9, 10], [8, 10, 40], [8, 11, 50], [8, 12, 50], [8, 13, 50], [8, 14, 50], [8, 16, 20], [8, 17, 50], [8, 18, 50], [8, 19, 50], [8, 20, 50], [8, 21, 50], [8, 22, 50], 
    [9, 4, 30], [9, 5, 50], [9, 6, 50], [9, 7, 50], [9, 10, 10], [9, 11, 40], [9, 12, 50], [9, 13, 50], [9, 14, 50], [9, 17, 20], [9, 18, 50], [9, 19, 50], [9, 20, 50], [9, 21, 50], [9, 22, 50], 
    [10, 5, 30], [10, 6, 50], [10, 7, 50], [10, 11, 10], [10, 12, 40], [10, 13, 50], [10, 14, 50], [10, 18, 20], [10, 19, 50], [10, 20, 50], [10, 21, 50], [10, 22, 50], 
    [11, 6, 30], [11, 7, 50], [11, 12, 10], [11, 13, 40], [11, 14, 50], [11, 19, 20], [11, 20, 50], [11, 21, 50], [11, 22, 50], 
    [12, 7, 30], [12, 13, 10], [12, 14, 40], [12, 20, 20], [12, 21, 50], [12, 22, 50], 
    [13, 14, 10], [13, 21, 20], [13, 22, 40], 
    [14, 22, 10], 
    [15, 3, 20], [15, 4, 50], [15, 5, 50], [15, 6, 50], [15, 7, 50], [15, 10, 30], [15, 11, 50], [15, 12, 50], [15, 13, 50], [15, 14, 50], [15, 16, 10], [15, 17, 40], [15, 18, 50], [15, 19, 50], [15, 20, 50], [15, 21, 50], [15, 22, 50], 
    [16, 4, 20], [16, 5, 50], [16, 6, 50], [16, 7, 50], [16, 11, 30], [16, 12, 50], [16, 13, 50], [16, 14, 50], [16, 17, 10], [16, 18, 40], [16, 19, 50], [16, 20, 50], [16, 21, 50], [16, 22, 50], 
    [17, 5, 20], [17, 6, 50], [17, 7, 50], [17, 12, 30], [17, 13, 50], [17, 14, 50], [17, 18, 10], [17, 19, 40], [17, 20, 50], [17, 21, 50], [17, 22, 50], 
    [18, 6, 20], [18, 7, 50], [18, 13, 30], [18, 14, 50], [18, 19, 10], [18, 20, 40], [18, 21, 50], [18, 22, 50], 
    [19, 7, 20], [19, 14, 30], [19, 20, 10], [19, 21, 40], [19, 22, 50], 
    [20, 21, 10], [20, 22, 30]
]
  },
  "reference_solution": {
    "crews": [[15, 16, 17, 18, 19], [20, 21], [0, 1, 2, 3, 4, 5, 6, 7], [8, 9, 10, 11, 12, 13, 14, 22]],
    "total_travel_time": 190
  },
  "solver_code": "from cpmpy import *\nimport json\n\nn = 23\nm = 4\n\nstart = [0, 60, 160, 180, 240, 300, 360, 420, 80, 140, 200, 260, 320, 380, 440, 100, 160, 220, 280, 340, 400, 460, 500]\nend = [50, 110, 170, 230, 290, 350, 410, 470, 130, 190, 250, 310, 370, 430, 490, 150, 210, 270, 330, 390, 450, 510, 555]\n\ntransition_cost = [[0] * n for _ in range(n)]\ntransition_pairs = [\n    [0, 1, 10], [0, 2, 40], [0, 3, 50], [0, 4, 50], [0, 5, 50], [0, 6, 50], [0, 7, 50], [0, 8, 20], [0, 9, 50], [0, 10, 50], [0, 11, 50], [0, 12, 50], [0, 13, 50], [0, 14, 50], [0, 15, 30], [0, 16, 50], [0, 17, 50], [0, 18, 50], [0, 19, 50], [0, 20, 50], [0, 21, 50], [0, 22, 50], \n    [1, 2, 10], [1, 3, 40], [1, 4, 50], [1, 5, 50], [1, 6, 50], [1, 7, 50], [1, 9, 20], [1, 10, 50], [1, 11, 50], [1, 12, 50], [1, 13, 50], [1, 14, 50], [1, 16, 30], [1, 17, 50], [1, 18, 50], [1, 19, 50], [1, 20, 50], [1, 21, 50], [1, 22, 50], \n    [2, 3, 10], [2, 4, 40], [2, 5, 50], [2, 6, 50], [2, 7, 50], [2, 10, 20], [2, 11, 50], [2, 12, 50], [2, 13, 50], [2, 14, 50], [2, 17, 30], [2, 18, 50], [2, 19, 50], [2, 20, 50], [2, 21, 50], [2, 22, 50], \n    [3, 4, 10], [3, 5, 40], [3, 6, 50], [3, 7, 50], [3, 11, 20], [3, 12, 50], [3, 13, 50], [3, 14, 50], [3, 18, 30], [3, 19, 50], [3, 20, 50], [3, 21, 50], [3, 22, 50], \n    [4, 5, 10], [4, 6, 40], [4, 7, 50], [4, 12, 20], [4, 13, 50], [4, 14, 50], [4, 19, 30], [4, 20, 50], [4, 21, 50], [4, 22, 50], \n    [5, 6, 10], [5, 7, 40], [5, 13, 20], [5, 14, 50], [5, 20, 30], [5, 21, 50], [5, 22, 50], \n    [6, 7, 10], [6, 14, 20], [6, 21, 30], [6, 22, 50], \n    [7, 22, 20], \n    [8, 3, 30], [8, 4, 50], [8, 5, 50], [8, 6, 50], [8, 7, 50], [8, 9, 10], [8, 10, 40], [8, 11, 50], [8, 12, 50], [8, 13, 50], [8, 14, 50], [8, 16, 20], [8, 17, 50], [8, 18, 50], [8, 19, 50], [8, 20, 50], [8, 21, 50], [8, 22, 50], \n    [9, 4, 30], [9, 5, 50], [9, 6, 50], [9, 7, 50], [9, 10, 10], [9, 11, 40], [9, 12, 50], [9, 13, 50], [9, 14, 50], [9, 17, 20], [9, 18, 50], [9, 19, 50], [9, 20, 50], [9, 21, 50], [9, 22, 50], \n    [10, 5, 30], [10, 6, 50], [10, 7, 50], [10, 11, 10], [10, 12, 40], [10, 13, 50], [10, 14, 50], [10, 18, 20], [10, 19, 50], [10, 20, 50], [10, 21, 50], [10, 22, 50], \n    [11, 6, 30], [11, 7, 50], [11, 12, 10], [11, 13, 40], [11, 14, 50], [11, 19, 20], [11, 20, 50], [11, 21, 50], [11, 22, 50], \n    [12, 7, 30], [12, 13, 10], [12, 14, 40], [12, 20, 20], [12, 21, 50], [12, 22, 50], \n    [13, 14, 10], [13, 21, 20], [13, 22, 40], \n    [14, 22, 10], \n    [15, 3, 20], [15, 4, 50], [15, 5, 50], [15, 6, 50], [15, 7, 50], [15, 10, 30], [15, 11, 50], [15, 12, 50], [15, 13, 50], [15, 14, 50], [15, 16, 10], [15, 17, 40], [15, 18, 50], [15, 19, 50], [15, 20, 50], [15, 21, 50], [15, 22, 50], \n    [16, 4, 20], [16, 5, 50], [16, 6, 50], [16, 7, 50], [16, 11, 30], [16, 12, 50], [16, 13, 50], [16, 14, 50], [16, 17, 10], [16, 18, 40], [16, 19, 50], [16, 20, 50], [16, 21, 50], [16, 22, 50], \n    [17, 5, 20], [17, 6, 50], [17, 7, 50], [17, 12, 30], [17, 13, 50], [17, 14, 50], [17, 18, 10], [17, 19, 40], [17, 20, 50], [17, 21, 50], [17, 22, 50], \n    [18, 6, 20], [18, 7, 50], [18, 13, 30], [18, 14, 50], [18, 19, 10], [18, 20, 40], [18, 21, 50], [18, 22, 50], \n    [19, 7, 20], [19, 14, 30], [19, 20, 10], [19, 21, 40], [19, 22, 50], \n    [20, 21, 10], [20, 22, 30]\n]\n\nfor i, j, cost in transition_pairs:\n    transition_cost[i][j] = cost\n\noverlap_pairs = []\nfor i in range(n):\n    for j in range(i+1, n):\n        if max(start[i], start[j]) < min(end[i], end[j]):\n            overlap_pairs.append((i, j))\n\nmax_span = 500\n\nassign = boolvar(shape=(n, m), name=\"assign\")\nsucc = boolvar(shape=(n, n), name=\"succ\")\nfirst = boolvar(shape=n, name=\"first\")\nlast = boolvar(shape=n, name=\"last\")\n\nmodel = Model()\n\nfor i in range(n):\n    model += sum(assign[i, :]) == 1\n\nfor (i, j) in overlap_pairs:\n    for k in range(m):\n        model += (assign[i, k] + assign[j, k]) <= 1\n\nfor i in range(n):\n    for j in range(n):\n        if i != j:\n            model += succ[i, j] <= sum(assign[i, :] * assign[j, :])\n\nfor i in range(n):\n    model += succ[i, i] == 0\n\nfor i in range(n):\n    model += first[i] + sum(succ[:, i]) == 1\n\nfor i in range(n):\n    model += last[i] + sum(succ[i, :]) == 1\n\nfor k in range(m):\n    model += sum(first * assign[:, k]) == 1\n\nfor k in range(m):\n    model += sum(last * assign[:, k]) == 1\n\nfor i in range(n):\n    for j in range(n):\n        if i != j:\n            model += (succ[i, j] == 1).implies(end[i] <= start[j])\n\nfor i in range(n):\n    for j in range(n):\n        if transition_cost[i][j] == 0 and i != j:\n            model += succ[i, j] == 0\n\nfor k in range(m):\n    unit_start = intvar(0, max(start), name=f\"unit_start_{k}\")\n    unit_end = intvar(0, max(end), name=f\"unit_end_{k}\")\n    \n    for i in range(n):\n        model += (first[i] & assign[i, k]).implies(unit_start == start[i])\n    \n    for i in range(n):\n        model += (last[i] & assign[i, k]).implies(unit_end == end[i])\n    \n    model += unit_end - unit_start <= max_span\n\nobjective = sum(transition_cost[i][j] * succ[i, j] for i in range(n) for j in range(n))\nmodel.minimize(objective)\n\nif model.solve():\n    crews = [[] for _ in range(m)]\n    \n    for k in range(m):\n        for i in range(n):\n            if assign[i, k].value():\n                crews[k].append(i)\n    \n    for k in range(m):\n        crews[k].sort(key=lambda scene_id: start[scene_id])\n    \n    calculated_travel_time = 0\n    for i in range(n):\n        for j in range(n):\n            if succ[i, j].value() and transition_cost[i][j] > 0:\n                calculated_travel_time += transition_cost[i][j]\n    \n    result = {\n        \"crews\": crews, \n        \"total_travel_time\": calculated_travel_time\n    }\n    print(json.dumps(result))\nelse:\n    print(json.dumps({\"crews\": [], \"total_travel_time\": 0}))",  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"crews\", \"total_travel_time\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        crews = solution[\"crews\"]\n        total_travel_time = solution[\"total_travel_time\"]\n        num_crews = structured_data[\"num_crews\"]\n        shift_duration_limit = structured_data[\"shift_duration_limit\"]\n        scenes = structured_data[\"scenes\"]\n        transition_costs = structured_data[\"transition_costs\"]\n        \n        errors = []\n        \n        if len(crews) != num_crews:\n            errors.append(f\"Invalid number of crews: expected {num_crews}, got {len(crews)}\")\n        \n        all_tasks = []\n        for crew in crews:\n            all_tasks.extend(crew)\n        \n        expected_tasks = set(range(len(scenes)))\n        actual_tasks = set(all_tasks)\n        \n        if len(all_tasks) != len(scenes):\n            errors.append(f\"Wrong number of tasks: expected {len(scenes)}, got {len(all_tasks)}\")\n        \n        if actual_tasks != expected_tasks:\n            missing_tasks = expected_tasks - actual_tasks\n            extra_tasks = actual_tasks - expected_tasks\n            if missing_tasks:\n                errors.append(f\"Missing tasks: {sorted(missing_tasks)}\")\n            if extra_tasks:\n                errors.append(f\"Extra tasks: {sorted(extra_tasks)}\")\n        \n        cost_matrix = {}\n        for i, j, cost in transition_costs:\n            cost_matrix[(i, j)] = cost\n        \n        calculated_travel_time = 0\n        for crew_idx, crew in enumerate(crews):\n            if not crew:\n                continue\n            \n            crew_sorted_by_time = sorted(crew, key=lambda scene_id: scenes[scene_id][0])\n            \n            for i in range(len(crew_sorted_by_time) - 1):\n                current_scene_id = crew_sorted_by_time[i]\n                next_scene_id = crew_sorted_by_time[i + 1]\n                \n                current_end = scenes[current_scene_id][1]\n                next_start = scenes[next_scene_id][0]\n                \n                if current_end > next_start:\n                    errors.append(f\"Time overlap in crew {crew_idx}: scene {current_scene_id} ends at {current_end} but scene {next_scene_id} starts at {next_start}\")\n\n            for i in range(len(crew_sorted_by_time) - 1):\n                from_scene_id = crew_sorted_by_time[i]\n                to_scene_id = crew_sorted_by_time[i + 1]\n                \n                if (from_scene_id, to_scene_id) not in cost_matrix:\n                    errors.append(f\"Invalid transition in crew {crew_idx + 1}: no travel time from scene {from_scene_id} to scene {to_scene_id}\")\n                else:\n                    calculated_travel_time += cost_matrix[(from_scene_id, to_scene_id)]\n\n            if crew_sorted_by_time:\n                first_scene_idx = crew_sorted_by_time[0]\n                last_scene_idx = crew_sorted_by_time[-1]\n                duty_time = scenes[last_scene_idx][1] - scenes[first_scene_idx][0]\n                if duty_time > shift_duration_limit:\n                    errors.append(f\"Duty time exceeded in crew {crew_idx}: {duty_time} > {shift_duration_limit}\")\n        \n        if abs(calculated_travel_time - total_travel_time) > 1e-6:\n            errors.append(f\"Travel time inconsistency: calculated {calculated_travel_time}, declared {total_travel_time}\")\n        \n        if len(errors) > 0:\n            optimality_score = 0.0\n        else:\n            reference_travel_time = 0\n            reference_crews = reference_solution[\"crews\"]\n            for ref_crew in reference_crews:\n                if len(ref_crew) > 1:\n                    ref_crew_sorted = sorted(ref_crew, key=lambda scene_id: scenes[scene_id][0])\n                    for i in range(len(ref_crew_sorted) - 1):\n                        from_scene_id = ref_crew_sorted[i]\n                        to_scene_id = ref_crew_sorted[i + 1]\n                        if (from_scene_id, to_scene_id) in cost_matrix:\n                            reference_travel_time += cost_matrix[(from_scene_id, to_scene_id)]\n            \n            if reference_travel_time == 0:\n                optimality_score = 1.0 if total_travel_time == 0 else 0.0\n            else:\n                gap = (total_travel_time - reference_travel_time) / abs(reference_travel_time)\n                optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Format error in solution data: {e}\"], \"optimality_score\": 0.0}"
}