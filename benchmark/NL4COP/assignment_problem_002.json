{
  "problem_id": "assignment_problem_002",
  "metadata": {
    "problem_type": "Assignment Problem",
    "difficulty": "medium"
  },
  "problem_description": "St. Mary's Regional Hospital is implementing a new monthly scheduling system for its nursing staff. The hospital has 20 experienced nurses and operates 20 specialized departments that require dedicated nursing coverage during the day shift. Each nurse has different levels of experience and training across various medical specialties, resulting in different adaptation scores when assigned to specific departments.\n\nThe hospital administration has calculated adaptation scores for each nurse-department combination based on factors such as specialty training, previous experience, patient satisfaction ratings, and efficiency metrics. Lower scores indicate better suitability and reduced training time needed. The goal is to assign each nurse to exactly one department, ensuring that every department has dedicated nursing coverage, while minimizing the total adaptation score across all assignments.\n\nThe table below shows the adaptation scores for assigning each nurse (N1 to N20) to each department (D1 to D20).\n\n| | D1 | D2 | D3 | D4 | D5 | D6 | D7 | D8 | D9 | D10 | D11 | D12 | D13 | D14 | D15 | D16 | D17 | D18 | D19 | D20 |\n|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|\n| **N1** | 4 | 18 | 9 | 99 | 85 | 50 | 47 | 2 | 15 | 18 | 65 | 34 | 2 | 65 | 21 | 91 | 69 | 59 | 93 | 97 |\n| **N2** | 11 | 22 | 45 | 89 | 8 | 51 | 72 | 34 | 69 | 18 | 29 | 65 | 91 | 93 | 6 | 23 | 25 | 92 | 10 | 40 |\n| **N3** | 86 | 33 | 58 | 21 | 20 | 69 | 59 | 82 | 91 | 93 | 73 | 19 | 80 | 27 | 31 | 4 | 47 | 15 | 92 | 73 |\n| **N4** | 5 | 10 | 18 | 49 | 68 | 94 | 38 | 23 | 78 | 16 | 33 | 58 | 64 | 60 | 15 | 95 | 54 | 78 | 43 | 58 |\n| **N5** | 21 | 60 | 17 | 64 | 63 | 16 | 42 | 99 | 21 | 35 | 69 | 47 | 74 | 18 | 32 | 72 | 90 | 26 | 47 | 33 |\n| **N6** | 19 | 77 | 64 | 31 | 61 | 46 | 58 | 36 | 100 | 64 | 75 | 42 | 36 | 55 | 40 | 93 | 11 | 89 | 97 | 10 |\n| **N7** | 21 | 18 | 85 | 21 | 9 | 58 | 79 | 53 | 28 | 74 | 85 | 85 | 4 | 43 | 13 | 97 | 77 | 64 | 49 | 93 |\n| **N8** | 90 | 99 | 44 | 92 | 79 | 21 | 65 | 57 | 93 | 12 | 19 | 72 | 81 | 45 | 26 | 21 | 57 | 94 | 36 | 29 |\n| **N9** | 67 | 95 | 94 | 94 | 23 | 78 | 28 | 71 | 18 | 51 | 32 | 97 | 68 | 26 | 49 | 74 | 13 | 20 | 67 | 86 |\n| **N10** | 12 | 72 | 79 | 75 | 75 | 20 | 63 | 36 | 34 | 15 | 53 | 58 | 24 | 74 | 24 | 67 | 78 | 45 | 89 | 80 |\n| **N11** | 88 | 10 | 78 | 75 | 63 | 3 | 29 | 77 | 6 | 2 | 92 | 49 | 82 | 52 | 40 | 61 | 23 | 13 | 68 | 82 |\n| **N12** | 16 | 37 | 78 | 88 | 6 | 55 | 44 | 58 | 94 | 69 | 46 | 33 | 3 | 79 | 53 | 85 | 47 | 10 | 66 | 29 |\n| **N13** | 35 | 15 | 28 | 68 | 65 | 85 | 87 | 27 | 28 | 71 | 75 | 42 | 35 | 75 | 22 | 63 | 35 | 8 | 30 | 15 |\n| **N14** | 99 | 86 | 23 | 29 | 90 | 65 | 72 | 7 | 96 | 13 | 54 | 79 | 86 | 59 | 44 | 16 | 66 | 70 | 87 | 26 |\n| **N15** | 80 | 93 | 77 | 93 | 13 | 96 | 20 | 26 | 39 | 67 | 20 | 46 | 46 | 17 | 46 | 68 | 21 | 61 | 48 | 11 |\n| **N16** | 26 | 52 | 53 | 53 | 3 | 11 | 91 | 19 | 79 | 72 | 77 | 55 | 74 | 16 | 81 | 10 | 50 | 38 | 27 | 26 |\n| **N17** | 18 | 67 | 41 | 42 | 58 | 87 | 60 | 84 | 29 | 78 | 34 | 79 | 59 | 19 | 47 | 29 | 18 | 51 | 36 | 65 |\n| **N18** | 48 | 48 | 48 | 29 | 77 | 58 | 64 | 24 | 3 | 36 | 54 | 97 | 25 | 10 | 69 | 50 | 33 | 2 | 36 | 76 |\n| **N19** | 15 | 38 | 63 | 2 | 58 | 3 | 99 | 94 | 56 | 96 | 55 | 58 | 69 | 61 | 22 | 92 | 77 | 74 | 10 | 100 |\n| **N20** | 46 | 34 | 55 | 20 | 51 | 97 | 71 | 8 | 38 | 79 | 72 | 90 | 39 | 52 | 60 | 11 | 58 | 77 | 81 | 63 |\n\nHow should the hospital administration assign the nurses to the departments to achieve the minimum possible total adaptation score?",
  "solution_format_description": "Print the following fields: - total_adaptation_score: total adaptation score. - nurse_department_assignment: department assignment for each nurse.",
  "structured_data": {
    "num_nurses": 20,
    "adaptation_matrix": [
      [
        4,
        18,
        9,
        99,
        85,
        50,
        47,
        2,
        15,
        18,
        65,
        34,
        2,
        65,
        21,
        91,
        69,
        59,
        93,
        97
      ],
      [
        11,
        22,
        45,
        89,
        8,
        51,
        72,
        34,
        69,
        18,
        29,
        65,
        91,
        93,
        6,
        23,
        25,
        92,
        10,
        40
      ],
      [
        86,
        33,
        58,
        21,
        20,
        69,
        59,
        82,
        91,
        93,
        73,
        19,
        80,
        27,
        31,
        4,
        47,
        15,
        92,
        73
      ],
      [
        5,
        10,
        18,
        49,
        68,
        94,
        38,
        23,
        78,
        16,
        33,
        58,
        64,
        60,
        15,
        95,
        54,
        78,
        43,
        58
      ],
      [
        21,
        60,
        17,
        64,
        63,
        16,
        42,
        99,
        21,
        35,
        69,
        47,
        74,
        18,
        32,
        72,
        90,
        26,
        47,
        33
      ],
      [
        19,
        77,
        64,
        31,
        61,
        46,
        58,
        36,
        100,
        64,
        75,
        42,
        36,
        55,
        40,
        93,
        11,
        89,
        97,
        10
      ],
      [
        21,
        18,
        85,
        21,
        9,
        58,
        79,
        53,
        28,
        74,
        85,
        85,
        4,
        43,
        13,
        97,
        77,
        64,
        49,
        93
      ],
      [
        90,
        99,
        44,
        92,
        79,
        21,
        65,
        57,
        93,
        12,
        19,
        72,
        81,
        45,
        26,
        21,
        57,
        94,
        36,
        29
      ],
      [
        67,
        95,
        94,
        94,
        23,
        78,
        28,
        71,
        18,
        51,
        32,
        97,
        68,
        26,
        49,
        74,
        13,
        20,
        67,
        86
      ],
      [
        12,
        72,
        79,
        75,
        75,
        20,
        63,
        36,
        34,
        15,
        53,
        58,
        24,
        74,
        24,
        67,
        78,
        45,
        89,
        80
      ],
      [
        88,
        10,
        78,
        75,
        63,
        3,
        29,
        77,
        6,
        2,
        92,
        49,
        82,
        52,
        40,
        61,
        23,
        13,
        68,
        82
      ],
      [
        16,
        37,
        78,
        88,
        6,
        55,
        44,
        58,
        94,
        69,
        46,
        33,
        3,
        79,
        53,
        85,
        47,
        10,
        66,
        29
      ],
      [
        35,
        15,
        28,
        68,
        65,
        85,
        87,
        27,
        28,
        71,
        75,
        42,
        35,
        75,
        22,
        63,
        35,
        8,
        30,
        15
      ],
      [
        99,
        86,
        23,
        29,
        90,
        65,
        72,
        7,
        96,
        13,
        54,
        79,
        86,
        59,
        44,
        16,
        66,
        70,
        87,
        26
      ],
      [
        80,
        93,
        77,
        93,
        13,
        96,
        20,
        26,
        39,
        67,
        20,
        46,
        46,
        17,
        46,
        68,
        21,
        61,
        48,
        11
      ],
      [
        26,
        52,
        53,
        53,
        3,
        11,
        91,
        19,
        79,
        72,
        77,
        55,
        74,
        16,
        81,
        10,
        50,
        38,
        27,
        26
      ],
      [
        18,
        67,
        41,
        42,
        58,
        87,
        60,
        84,
        29,
        78,
        34,
        79,
        59,
        19,
        47,
        29,
        18,
        51,
        36,
        65
      ],
      [
        48,
        48,
        48,
        29,
        77,
        58,
        64,
        24,
        3,
        36,
        54,
        97,
        25,
        10,
        69,
        50,
        33,
        2,
        36,
        76
      ],
      [
        15,
        38,
        63,
        2,
        58,
        3,
        99,
        94,
        56,
        96,
        55,
        58,
        69,
        61,
        22,
        92,
        77,
        74,
        10,
        100
      ],
      [
        46,
        34,
        55,
        20,
        51,
        97,
        71,
        8,
        38,
        79,
        72,
        90,
        39,
        52,
        60,
        11,
        58,
        77,
        81,
        63
      ]
    ]
  },
  "reference_solution": {
    "total_adaptation_score": 209,
    "nurse_department_assignment": [
      0,
      18,
      11,
      1,
      2,
      19,
      14,
      10,
      16,
      9,
      5,
      12,
      17,
      7,
      6,
      4,
      13,
      8,
      3,
      15
    ]
  },
  "solver_code": "\nimport json\nimport numpy as np\nfrom cpmpy import Model, boolvar, sum\n\n\nnum_nurses = 20\nadaptation_matrix = np.array([\n    [4, 18, 9, 99, 85, 50, 47, 2, 15, 18, 65, 34, 2, 65, 21, 91, 69, 59, 93, 97],\n    [11, 22, 45, 89, 8, 51, 72, 34, 69, 18, 29, 65, 91, 93, 6, 23, 25, 92, 10, 40],\n    [86, 33, 58, 21, 20, 69, 59, 82, 91, 93, 73, 19, 80, 27, 31, 4, 47, 15, 92, 73],\n    [5, 10, 18, 49, 68, 94, 38, 23, 78, 16, 33, 58, 64, 60, 15, 95, 54, 78, 43, 58],\n    [21, 60, 17, 64, 63, 16, 42, 99, 21, 35, 69, 47, 74, 18, 32, 72, 90, 26, 47, 33],\n    [19, 77, 64, 31, 61, 46, 58, 36, 100, 64, 75, 42, 36, 55, 40, 93, 11, 89, 97, 10],\n    [21, 18, 85, 21, 9, 58, 79, 53, 28, 74, 85, 85, 4, 43, 13, 97, 77, 64, 49, 93],\n    [90, 99, 44, 92, 79, 21, 65, 57, 93, 12, 19, 72, 81, 45, 26, 21, 57, 94, 36, 29],\n    [67, 95, 94, 94, 23, 78, 28, 71, 18, 51, 32, 97, 68, 26, 49, 74, 13, 20, 67, 86],\n    [12, 72, 79, 75, 75, 20, 63, 36, 34, 15, 53, 58, 24, 74, 24, 67, 78, 45, 89, 80],\n    [88, 10, 78, 75, 63, 3, 29, 77, 6, 2, 92, 49, 82, 52, 40, 61, 23, 13, 68, 82],\n    [16, 37, 78, 88, 6, 55, 44, 58, 94, 69, 46, 33, 3, 79, 53, 85, 47, 10, 66, 29],\n    [35, 15, 28, 68, 65, 85, 87, 27, 28, 71, 75, 42, 35, 75, 22, 63, 35, 8, 30, 15],\n    [99, 86, 23, 29, 90, 65, 72, 7, 96, 13, 54, 79, 86, 59, 44, 16, 66, 70, 87, 26],\n    [80, 93, 77, 93, 13, 96, 20, 26, 39, 67, 20, 46, 46, 17, 46, 68, 21, 61, 48, 11],\n    [26, 52, 53, 53, 3, 11, 91, 19, 79, 72, 77, 55, 74, 16, 81, 10, 50, 38, 27, 26],\n    [18, 67, 41, 42, 58, 87, 60, 84, 29, 78, 34, 79, 59, 19, 47, 29, 18, 51, 36, 65],\n    [48, 48, 48, 29, 77, 58, 64, 24, 3, 36, 54, 97, 25, 10, 69, 50, 33, 2, 36, 76],\n    [15, 38, 63, 2, 58, 3, 99, 94, 56, 96, 55, 58, 69, 61, 22, 92, 77, 74, 10, 100],\n    [46, 34, 55, 20, 51, 97, 71, 8, 38, 79, 72, 90, 39, 52, 60, 11, 58, 77, 81, 63]\n])\n\n\n\nx = boolvar(shape=(num_nurses, num_nurses))\n\n\nmodel = Model()\n\nmodel += [sum(x[i, :]) == 1 for i in range(num_nurses)]\n\nmodel += [sum(x[:, j]) == 1 for j in range(num_nurses)]\n\n\nmodel.minimize(sum(adaptation_matrix * x))\n\n\nif model.solve():\n    total_adaptation_score = int(model.objective_value())\n    assignment_matrix = x.value()\n    \n\n\n    nurse_department_assignment = np.where(assignment_matrix == 1)[1].tolist()\n    \n    result = {\n        \"total_adaptation_score\": total_adaptation_score,\n        \"nurse_department_assignment\": nurse_department_assignment\n    }\n    print(json.dumps(result, indent=2))\nelse:\n    print(\"No solution found.\")\n",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n\n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n\n    required_fields = [\"total_adaptation_score\", \"nurse_department_assignment\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n\n    try:\n        assignment = solution[\"nurse_department_assignment\"]\n        total_adaptation_score = solution[\"total_adaptation_score\"]\n        \n        num_nurses = structured_data[\"num_nurses\"]\n        adaptation_matrix = structured_data[\"adaptation_matrix\"]\n        errors = []\n        \n\n        if not isinstance(assignment, list) or len(assignment) != num_nurses:\n            errors.append(\"Invalid assignment structure\")\n        elif sorted(assignment) != list(range(num_nurses)):\n            errors.append(\"Assignment is not a valid permutation\")\n        \n\n        if len(errors) > 0:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n\n        calculated_adaptation_score = 0\n        for nurse, department in enumerate(assignment):\n            calculated_adaptation_score += adaptation_matrix[nurse][department]\n        \n\n        if abs(total_adaptation_score - calculated_adaptation_score) > 1e-6:\n            errors.append(\"Adaptation score calculation inconsistency\")\n        \n\n        optimal_adaptation_score = reference_solution[\"total_adaptation_score\"]\n        if optimal_adaptation_score == 0:\n            optimality_score = 1.0 if total_adaptation_score == 0 else 0.0\n        else:\n            gap = abs(optimal_adaptation_score - calculated_adaptation_score) / abs(optimal_adaptation_score)\n            optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}