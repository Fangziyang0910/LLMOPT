{
  "problem_id": "pmedcap_003",
  "metadata": {
    "problem_type": "Capacitated P-Median Problem",
    "difficulty": "hard"
  },
  "problem_description": "An advanced bioremediation logistics optimization framework requires strategic deployment of five molecular waste processing facilities across a complex metropolitan ecosystem to establish optimal environmental remediation networks that minimize cumulative carbon footprint while adhering to stringent biochemical processing constraints and ecological sustainability protocols. The coordinate system employs a sophisticated geospatial reference matrix with all positional measurements expressed in kilometers relative to established environmental monitoring stations. Each molecular processing facility can metabolize a maximum of fifty metric tons of complex organic compounds per diurnal cycle through advanced enzymatic decomposition processes. Every ecological zone exhibits unique biodegradation flux patterns requiring specialized biochemical treatment ranging from one to three metric tons per diurnal cycle, necessitating precise allocation optimization to ensure balanced metabolic efficiency and ecosystem homeostasis. Geospatial distribution characteristics and biodegradation flux profiles include: Ecological Sector Alpha positioned thirty-seven kilometers east and eighty-seven kilometers north from monitoring origin and requires two metric tons daily; Sector Beta located seventy-three kilometers east and eighteen kilometers north from monitoring origin and requires one metric ton; Sector Gamma situated seventy-four kilometers east and forty kilometers north from monitoring origin and requires two metric tons; Sector Delta positioned one kilometer east and eleven kilometers north from monitoring origin and requires three metric tons; Sector Epsilon located thirty kilometers east and thirty-two kilometers north from monitoring origin and requires one metric ton; Sector Zeta situated nine kilometers east and ninety-one kilometers north from monitoring origin and requires one metric ton; Sector Eta positioned twenty-four kilometers east and thirteen kilometers north from monitoring origin and requires two metric tons; Sector Theta located ninety-eight kilometers east and forty-three kilometers north from monitoring origin and requires two metric tons; Sector Iota situated thirty kilometers east and forty-two kilometers north from monitoring origin and requires two metric tons; Sector Kappa positioned seventy-eight kilometers east and twenty kilometers north from monitoring origin and requires one metric ton; Sector Lambda located fifty-eight kilometers east and fifty-seven kilometers north from monitoring origin and requires one metric ton; Sector Mu situated twenty-five kilometers east and five kilometers north from monitoring origin and requires two metric tons; Sector Nu positioned twenty kilometers east and three kilometers north from monitoring origin and requires three metric tons; Sector Xi located thirteen kilometers east and sixty-one kilometers north from monitoring origin and requires one metric ton; Sector Omicron situated twelve kilometers east and seventy-four kilometers north from monitoring origin and requires one metric ton; Sector Pi positioned ten kilometers east and ninety-one kilometers north from monitoring origin and requires two metric tons; Sector Rho located fifty-one kilometers east and seventeen kilometers north from monitoring origin and requires one metric ton; Sector Sigma situated eighty-four kilometers east and seventy-seven kilometers north from monitoring origin and requires three metric tons; Sector Tau positioned ninety-two kilometers east and five kilometers north from monitoring origin and requires three metric tons; Sector Upsilon located ninety-five kilometers east and fifty-four kilometers north from monitoring origin and requires one metric ton; Sector Phi situated forty-two kilometers east and sixty-nine kilometers north from monitoring origin and requires one metric ton; Sector Chi positioned twenty-five kilometers east and twenty-one kilometers north from monitoring origin and requires one metric ton; Sector Psi located twenty-seven kilometers east and thirty-one kilometers north from monitoring origin and requires one metric ton; Sector Omega situated ninety-five kilometers east and twenty-seven kilometers north from monitoring origin and requires one metric ton; Sector Alpha Prime positioned twenty-eight kilometers east and ninety kilometers north from monitoring origin and requires one metric ton; Sector Beta Prime located twenty-seven kilometers east and fifty-six kilometers north from monitoring origin and requires one metric ton; Sector Gamma Prime situated ten kilometers east and six kilometers north from monitoring origin and requires two metric tons; Sector Delta Prime positioned thirty-nine kilometers east and thirty-three kilometers north from monitoring origin and requires two metric tons; Sector Epsilon Prime located fifty-eight kilometers east and eighty-two kilometers north from monitoring origin and requires two metric tons; Sector Zeta Prime situated twelve kilometers east and eleven kilometers north from monitoring origin and requires three metric tons; Sector Eta Prime positioned three kilometers east and fifty-two kilometers north from monitoring origin and requires three metric tons; Sector Theta Prime positioned thirty-one kilometers east and twelve kilometers north from monitoring origin and requires three metric tons; Sector Iota Prime situated seventy-four kilometers east and fifty-nine kilometers north from monitoring origin and requires three metric tons; Sector Kappa Prime positioned fifty-two kilometers east and fifty kilometers north from monitoring origin and requires two metric tons; Sector Lambda Prime located thirty-three kilometers east and ninety-seven kilometers north from monitoring origin and requires three metric tons; Sector Mu Prime situated nine kilometers east and thirty-one kilometers north from monitoring origin and requires two metric tons; Sector Nu Prime positioned ten kilometers east and one kilometer north from monitoring origin and requires two metric tons; Sector Xi Prime located twenty-two kilometers east and eighty-four kilometers north from monitoring origin and requires two metric tons; Sector Omicron Prime situated two kilometers east and three kilometers north from monitoring origin and requires one metric ton; Sector Pi Prime located ninety kilometers east and seven kilometers north from monitoring origin and requires one metric ton; Sector Rho Prime situated thirty-two kilometers east and ninety-six kilometers north from monitoring origin and requires one metric ton; Sector Sigma Prime positioned ninety-three kilometers east and thirty-eight kilometers north from monitoring origin and requires one metric ton; Sector Tau Prime located fifty-one kilometers east and thirty-eight kilometers north from monitoring origin and requires two metric tons; Sector Upsilon Prime situated eight kilometers east and forty-four kilometers north from monitoring origin and requires two metric tons; Sector Phi Prime positioned fifteen kilometers east and sixty-six kilometers north from monitoring origin and requires two metric tons; Sector Chi Prime located sixty-nine kilometers east and one kilometer north from monitoring origin and requires one metric ton; Sector Psi Prime situated fifty-seven kilometers east and twenty-five kilometers north from monitoring origin and requires two metric tons; Sector Omega Prime positioned four kilometers east and fifty-two kilometers north from monitoring origin and requires two metric tons; Sector Alpha Second positioned fifty-one kilometers east and ninety-three kilometers north from monitoring origin and requires three metric tons; Sector Beta Second situated fifty-three kilometers east and twenty-nine kilometers north from monitoring origin and requires three metric tons. Each molecular waste processing facility must be co-located with an existing ecological zone and can serve multiple zones as long as the aggregate biodegradation flux does not exceed fifty metric tons per diurnal cycle through advanced enzymatic decomposition and metabolic processing protocols.",
  "solution_format_description": "Print the following fields: - environmental_impact_score: total transportation distance, computed as the sum over all ecological sectors of (daily biodegradation demand Ã— Euclidean distance to the assigned facility); - molecular_facility_coordinates: selected facility locations, represented as 1-based indices of the ecological sectors in the order given in the problem description; - ecological_service_matrix: assigned facility for each sector, represented as a list of 1-based facility indices corresponding to the selected facility locations.",
  "structured_data": {
    "molecular_processing_facility_count": 5,
    "enzymatic_decomposition_capacity": 50,
    "bioremediation_ecological_sectors": [
      [37, 87, 2],
      [73, 18, 1],
      [74, 40, 2],
      [1, 11, 3],
      [30, 32, 1],
      [9, 91, 1],
      [24, 13, 2],
      [98, 43, 2],
      [30, 42, 2],
      [78, 20, 1],
      [58, 57, 1],
      [25, 5, 2],
      [20, 3, 3],
      [13, 61, 1],
      [12, 74, 1],
      [10, 91, 2],
      [51, 17, 1],
      [84, 77, 3],
      [92, 5, 3],
      [95, 54, 1],
      [42, 69, 1],
      [25, 21, 1],
      [27, 31, 1],
      [95, 27, 1],
      [28, 90, 1],
      [27, 56, 1],
      [10, 6, 2],
      [39, 33, 2],
      [58, 82, 2],
      [12, 11, 3],
      [3, 52, 3],
      [31, 12, 3],
      [74, 59, 3],
      [52, 50, 2],
      [33, 97, 3],
      [9, 31, 2],
      [10, 1, 2],
      [22, 84, 2],
      [2, 3, 1],
      [90, 7, 1],
      [32, 96, 1],
      [93, 38, 1],
      [51, 38, 2],
      [8, 44, 2],
      [15, 66, 2],
      [69, 1, 1],
      [57, 25, 2],
      [4, 52, 2],
      [51, 93, 3],
      [53, 29, 3]
    ]
  },
  "reference_solution": {
    "environmental_impact_score": 1402.853,
    "molecular_facility_coordinates": [1, 30, 42, 48, 50],
    "ecological_service_matrix": [1, 50, 42, 30, 50, 1, 30, 42, 50, 42, 50, 30, 30, 48, 48, 1, 50, 42, 42, 42, 1, 30, 30, 42, 1, 48, 30, 50, 1, 30, 48, 30, 42, 50, 1, 30, 30, 1, 30, 42, 1, 42, 50, 48, 48, 50, 50, 48, 1, 50]
  },
  "solver_code": "from cpmpy import *\nimport json\nimport math\n\nmolecular_processing_facility_count = 5\nenzymatic_decomposition_capacity = 50\nbioremediation_ecological_sectors = [\n    [37, 87, 2],\n    [73, 18, 1],\n    [74, 40, 2],\n    [1, 11, 3],\n    [30, 32, 1],\n    [9, 91, 1],\n    [24, 13, 2],\n    [98, 43, 2],\n    [30, 42, 2],\n    [78, 20, 1],\n    [58, 57, 1],\n    [25, 5, 2],\n    [20, 3, 3],\n    [13, 61, 1],\n    [12, 74, 1],\n    [10, 91, 2],\n    [51, 17, 1],\n    [84, 77, 3],\n    [92, 5, 3],\n    [95, 54, 1],\n    [42, 69, 1],\n    [25, 21, 1],\n    [27, 31, 1],\n    [95, 27, 1],\n    [28, 90, 1],\n    [27, 56, 1],\n    [10, 6, 2],\n    [39, 33, 2],\n    [58, 82, 2],\n    [12, 11, 3],\n    [3, 52, 3],\n    [31, 12, 3],\n    [74, 59, 3],\n    [52, 50, 2],\n    [33, 97, 3],\n    [9, 31, 2],\n    [10, 1, 2],\n    [22, 84, 2],\n    [2, 3, 1],\n    [90, 7, 1],\n    [32, 96, 1],\n    [93, 38, 1],\n    [51, 38, 2],\n    [8, 44, 2],\n    [15, 66, 2],\n    [69, 1, 1],\n    [57, 25, 2],\n    [4, 52, 2],\n    [51, 93, 3],\n    [53, 29, 3]\n]\n\nn_sectors = len(bioremediation_ecological_sectors)\nbiodegradation_flux = [bioremediation_ecological_sectors[i][2] for i in range(n_sectors)]\ncoordinates = [(bioremediation_ecological_sectors[i][0], bioremediation_ecological_sectors[i][1]) for i in range(n_sectors)]\n\nmodel = Model()\n\nis_molecular_facility = boolvar(shape=n_sectors)\n\nassign = boolvar(shape=(n_sectors, n_sectors))\n\nmodel += sum(is_molecular_facility) == molecular_processing_facility_count\n\nfor i in range(n_sectors):\n    model += sum(assign[i, j] for j in range(n_sectors)) == 1\n\nfor i in range(n_sectors):\n    for j in range(n_sectors):\n        model += assign[i, j] <= is_molecular_facility[j]\n\nfor j in range(n_sectors):\n    total_flux_to_j = sum(biodegradation_flux[i] * assign[i, j] for i in range(n_sectors))\n    model += total_flux_to_j <= enzymatic_decomposition_capacity * is_molecular_facility[j]\n\ndistance_matrix = {}\nfor i in range(n_sectors):\n    for j in range(n_sectors):\n        xi, yi = coordinates[i]\n        xj, yj = coordinates[j]\n        dist = math.sqrt((xi - xj)**2 + (yi - yj)**2)\n        distance_matrix[(i, j)] = dist\n\ntotal_environmental_impact = sum(distance_matrix[(i, j)] * assign[i, j] for i in range(n_sectors) for j in range(n_sectors))\nmodel.minimize(total_environmental_impact)\n\nif model.solve():\n    molecular_facility_coordinates = [j+1 for j in range(n_sectors) if is_molecular_facility[j].value()]\n    \n    ecological_service_matrix = [0] * n_sectors\n    for i in range(n_sectors):\n        for j in range(n_sectors):\n            if assign[i, j].value() == 1:\n                ecological_service_matrix[i] = j+1\n                break\n\n    result = {\n        \"environmental_impact_score\": round(model.objective_value(), 4),\n        \"molecular_facility_coordinates\": molecular_facility_coordinates,\n        \"ecological_service_matrix\": ecological_service_matrix\n    }\n    print(json.dumps(result))\nelse:\n    print(\"No solution found.\")",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    import math\n\n    try:\n        if isinstance(candidate_solution, str):\n            solution = json.loads(candidate_solution)\n        else:\n            solution = candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n\n    required_fields = [\"environmental_impact_score\", \"molecular_facility_coordinates\", \"ecological_service_matrix\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n\n    try:\n        environmental_impact_score = solution[\"environmental_impact_score\"]\n        molecular_facility_coordinates = solution[\"molecular_facility_coordinates\"]\n        ecological_service_matrix = solution[\"ecological_service_matrix\"]\n        \n        molecular_processing_facility_count = structured_data[\"molecular_processing_facility_count\"]\n        enzymatic_decomposition_capacity = structured_data[\"enzymatic_decomposition_capacity\"]\n        bioremediation_ecological_sectors = structured_data[\"bioremediation_ecological_sectors\"]\n        n_sectors = len(bioremediation_ecological_sectors)\n        \n        errors = []\n\n        if len(molecular_facility_coordinates) != molecular_processing_facility_count:\n            errors.append(f\"Molecular facility count mismatch: expected {molecular_processing_facility_count}, got {len(molecular_facility_coordinates)}\")\n\n        if len(ecological_service_matrix) != n_sectors:\n            errors.append(f\"Ecological service matrix count mismatch: expected {n_sectors}, got {len(ecological_service_matrix)}\")\n        \n        for facility in molecular_facility_coordinates:\n            if facility < 0 or facility >= n_sectors:\n                errors.append(f\"Invalid molecular facility coordinate {facility}, must be between 0 and {n_sectors-1}\")\n        \n        for allocation in ecological_service_matrix:\n            if allocation not in molecular_facility_coordinates:\n                errors.append(f\"Sector assigned to {allocation} which is not in the list of selected molecular facilities.\")\n\n        capacity_usage = {}\n        for i, allocation in enumerate(ecological_service_matrix):\n            biodegradation_flux = bioremediation_ecological_sectors[i][2]\n            if allocation not in capacity_usage:\n                capacity_usage[allocation] = 0.0\n            capacity_usage[allocation] += biodegradation_flux\n            \n        for facility, used in capacity_usage.items():\n            if used > enzymatic_decomposition_capacity + 1e-6:\n                errors.append(\n                    f\"Enzymatic decomposition capacity exceeded for facility {facility}: used capacity {used:.4f} exceeds allowed threshold {enzymatic_decomposition_capacity:.4f}.\")\n\n        recomputed_environmental_impact = 0\n        if not errors:\n            coordinates = [(bioremediation_ecological_sectors[i][0], bioremediation_ecological_sectors[i][1]) for i in range(n_sectors)]\n            for i, allocation in enumerate(ecological_service_matrix):\n                try:\n                    sx, sy = coordinates[i]\n                except Exception as e:\n                    errors.append(f\"Error accessing data for ecological sector index {i}: {e}\")\n                    break\n                \n                if allocation < 0 or allocation >= n_sectors:\n                    errors.append(f\"Assigned molecular facility {allocation} for ecological sector {i} not found.\")\n                    break\n\n                fx, fy = coordinates[allocation]\n                d = math.sqrt((sx - fx) ** 2 + (sy - fy) ** 2)\n                recomputed_environmental_impact += math.floor(d)\n\n            if abs(recomputed_environmental_impact - environmental_impact_score) > 1e-6:\n                errors.append(f\"Environmental impact score inconsistency: reported {environmental_impact_score}, calculated {recomputed_environmental_impact}\")\n\n        if errors:\n            return {\n                \"is_valid\": False,\n                \"validation_errors\": errors,\n                \"optimality_score\": 0.0\n            }\n\n        optimal_value = reference_solution[\"environmental_impact_score\"]\n        if optimal_value == 0:\n            optimality_score = 1.0 if environmental_impact_score == 0 else 0.0\n        else:\n            gap = abs(optimal_value - environmental_impact_score) / abs(optimal_value)\n            optimality_score = max(0, 1 - gap)\n\n        return {\n            \"is_valid\": True,\n            \"validation_errors\": [],\n            \"optimality_score\": optimality_score\n        }\n\n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Format error in solution data or evaluation logic: {str(e)}\"], \"optimality_score\": 0.0}"
}