{
  "problem_id": "uncapacitated_warehouse_location_003",
  "metadata": {
    "problem_type": "Uncapacitated Warehouse Location Problem",
    "difficulty": "hard"
  },
  "problem_description": "A global e-commerce platform is optimizing its fulfillment network to serve 20 major retail partners across different continents. The company is evaluating 8 strategic locations for establishing regional fulfillment centers. Each fulfillment center requires significant capital investment for construction, automation systems, and infrastructure setup. The retail partners have varying annual order volumes based on their market presence and growth projections. Transportation costs vary between each potential fulfillment center and retail partner due to distance, customs procedures, and logistics infrastructure differences. The company needs to determine which fulfillment centers to establish and how to assign each retail partner to minimize total annual operational costs. This includes both fixed facility costs and variable transportation expenses. Each retail partner must be served completely by exactly one fulfillment center.\n\nThe fulfillment center setup costs are $7500 for Centers 1, 2, 3, 5, 6, 7, and 8, while Center 4 is an existing facility with no setup cost required.\n\nFor Partner 1, shipping from Center 1 costs $6429.48 per order, Center 2 costs $5396.52, Center 3 costs $5219.50, Center 4 costs $4182.90, Center 5 costs $7391.25, Center 6 costs $5038.82, Center 7 costs $10349.58, and Center 8 costs $6051.70. Partner 2 enjoys lower costs with Center 8 at $1838.96, Center 5 at $2396.85, Center 6 at $2628.49, Center 2 at $3204.86, Center 7 at $3220.09, Center 4 at $3845.40, Center 3 at $5457.07, and Center 1 at $8663.27. Partner 3 finds Center 5 most economical at $2035.80, followed by Center 4 at $3507.19, Center 1 at $2838.38, Center 6 at $2890.57, Center 3 at $4642.54, Center 2 at $4940.51, Center 7 at $3943.28, and Center 8 at $5984.51.\n\nPartner 4, despite high volume, gets the best rate from Center 5 at $23096.67, with other options being Center 3 at $25921.09, Center 8 at $40527.81, Center 6 at $48700.22, Center 4 at $69206.46, Center 1 at $64292.99, Center 2 at $80186.57, and Center 7 at $135170.70. Partner 5 has excellent options with Center 8 at $1577.90, Center 6 at $1715.46, Center 7 at $2152.18, Center 5 at $16203.60, Center 1 at $23856.00, Center 2 at $48568.80, Center 4 at $66973.20, and Center 3 at $66066.00. Partner 6 has the lowest cost from center 2, at $36305.10, followed by center 3 at $45918.60, center 8 at $69254.90, center 4 at $72233.20, center 1 at $75663.90, center 5 at $198000.40, and the costs of center 7 and 6 are respectively as high as $269592.70 and $282712.30.\n\nThe cost of partner 7 has remained consistently high. Among the reasonable options, center 2 is at $40000.00, while center 3 costs $50000.00, center 1, 4, and 8 cost $70000.00 each, and centers 5, 6, and 7 are significantly higher, at $200000.00, $280000.00, and $270000.00 respectively. The optimal cost choice for partner 8 comes from center 3, at $4123.90, followed by center 4 at $5635.58, center 1 at $5638.74, center 6 at $8073.86, center 2 at $12438.11, center 8 at $11726.55, center 7 at $1,239.44, and center 5 at $21789.63. Partner 9 found that center 8 is the most economical, at $5467.31, followed by center 5 at $7254.00, center 6 at $7875.56, center 2 at $8597.06, center 7 at $9152.81, center 1 at $9863.84, center 4 at $10500.75, and center 3 at $1,113.13.\n\nPartner 10 has an extremely low cost, with center 6 at $505.40, center 5 at $ 889.20, center 4 at $1227.88, center 3 at $1722.83, center 1 at $1846.80, center 2 at $1853.93, center 7 at $2041.55, and center 8 at $3108.88. Partner 11's most economical choice is center 2, at $11166.86, followed by center 8 at $15978.60, center 6 at $17380.76, center 4 at $20982.00, center 3 at $22333.73, center 1 at $30655.91, center 7 at $40178.51, and center 5 at $56025.98. Partner 12's most economical choice is center 6, at $2252.21, followed by center 5 at $3801.9, center 7 at $5847.49, center 4 at $9670.05, center 2 at $12087.56, center 8 at $19650.04, center 3 at $19877.33, and center 1 at $36405.79.\n\nPartner 13 considers center 3 to be the most economical option, at $4959.00, followed by center 2 at $7665.79, center 1 at $14856.34, center 8 at $13492.61, and center 4 at $11984.25, while centers 5, 6, and 7 have much higher prices, at $34713.00, $50189.21, and $48040.31 respectively. The best choice for Partner 14 is Center 3 ($7106.0), followed by Center 6 ($7117.4), Center 7 ($7725.4), Center 8 ($7911.6), Center 1 ($9496.2), Center 4 ($10898.4), Center 2 ($11616.6), and Center 5 ($28226.4). For Partner 15, the best choices are Center 2 ($8099.30), followed by Center 3 ($15669.50), Center 1 ($21866.08), Center 8 ($24063.88), Center 7 ($30250.28), Center 4 ($41636.1), Center 6 ($63420.78), and Center 5 ($64804.58).\n\nFor Partner 16, the lowest cost is Center 3 ($3268.90), followed by Center 6 ($5623.69), Center 1 ($5918.56), Center 8 ($8745.15), Center 4 ($9073.73), Center 2 ($12852.34), Center 7 ($13172.49), and Center 5 ($29479.08). Partner 17, although having a higher overall cost, considers Center 1 to be the most reasonable, with a price of $7022.24. The prices of other centers range from $281463.0 to $406770.0, $325852.8 to $253234.8, $264755.4 to $211356.6. Partner 18's most economical choice is Center 2 ($8,049.94), followed by Center 1 ($16118.44), Center 7 ($17362.13), Center 3 ($17411.63), Center 6 ($19843.32), Center 5 ($19991.82), Center 4 ($21687.19), and Center 8 ($26420.63).\n\nPartner 19 only needs to pay $1601.18 at Center 3 to enjoy its services, while the costs at Center 1 are $7551.49, Center 6 is $9022.84, Center 4 is $11698.68, Center 8 is $16963.80, Center 2 is $22351.54, Center 7 is $26549.21, and Center 5 is $49650.85. Partner 20 considers Center 1 to be the most economical choice, with a cost of $3727.76, while Center 5 is $4628.66, Center 4 is $5826.98, Center 7's cost is $6476.67, Center 6's cost is $6632.59, Center 3 is $8229.38, Center 2 is $11116.88, and Center 8's cost is $11884.95.",  
  "solution_format_description": "Print the following fields: - total_cost: total construction and shipping cost. - centers_open: which fulfillment centers are opened. - partner_assignments: retail partner assignments to fulfillment centers.",
  "structured_data": {
    "fulfillment_costs": [
      7500.0,
      7500.0,
      7500.0,
      0.0,
      7500.0,
      7500.0,
      7500.0,
      7500.0
    ],
    "retail_partners": [
      [
        6429.48,
        5396.52,
        5219.5,
        4182.9,
        7391.25,
        5038.82,
        10349.58,
        6051.7
      ],
      [
        8663.27,
        3204.86,
        5457.07,
        3845.4,
        2396.85,
        2628.49,
        3220.09,
        1838.96
      ],
      [
        2838.38,
        4940.51,
        4642.54,
        3507.19,
        2035.8,
        2890.57,
        3943.28,
        5984.51
      ],
      [
        64292.99,
        80186.57,
        25921.09,
        69206.46,
        23096.67,
        48700.22,
        135170.7,
        40527.81
      ],
      [
        23856.0,
        48568.8,
        66066.0,
        66973.2,
        16203.6,
        1715.46,
        2152.18,
        1577.9
      ],
      [
        75663.9,
        36305.1,
        45918.6,
        72233.2,
        198000.4,
        282712.3,
        269592.7,
        69254.9
      ],
      [
        70000.0,
        40000.0,
        50000.0,
        70000.0,
        200000.0,
        280000.0,
        270000.0,
        70000.0
      ],
      [
        5638.74,
        12438.11,
        4123.9,
        5635.58,
        21789.63,
        8073.86,
        16239.44,
        11726.55
      ],
      [
        9863.84,
        8597.06,
        14113.13,
        10500.75,
        7254.0,
        7875.56,
        9152.81,
        5467.31
      ],
      [
        1846.8,
        1853.93,
        1722.83,
        1227.88,
        889.2,
        505.4,
        2041.55,
        3108.88
      ],
      [
        30655.91,
        11166.86,
        22333.73,
        20982.0,
        56025.98,
        17380.76,
        40178.51,
        15978.6
      ],
      [
        36405.79,
        12087.56,
        19877.33,
        9670.05,
        3801.9,
        2252.21,
        5847.49,
        19650.04
      ],
      [
        14856.34,
        7665.79,
        4959.0,
        11984.25,
        34713.0,
        50189.21,
        48040.31,
        13492.61
      ],
      [
        9496.2,
        11616.6,
        7106.0,
        10898.4,
        28226.4,
        7117.4,
        7725.4,
        7911.6
      ],
      [
        21866.08,
        8099.3,
        15669.5,
        41636.1,
        64804.58,
        63420.78,
        30250.28,
        24063.88
      ],
      [
        5918.56,
        12852.34,
        3268.9,
        9073.73,
        29479.08,
        5623.69,
        13172.49,
        8745.15
      ],
      [
        7022.2375,
        281463.0,
        406770.0,
        325852.8,
        253234.8,
        264755.4,
        294457.8,
        211356.6
      ],
      [
        16118.44,
        8049.94,
        17411.63,
        21687.19,
        19991.82,
        19843.32,
        17362.13,
        26420.63
      ],
      [
        7551.49,
        22351.54,
        1601.18,
        11698.68,
        49650.85,
        9022.84,
        26549.21,
        16963.8
      ],
      [
        3727.76,
        11116.88,
        8229.38,
        5826.98,
        4628.66,
        6632.59,
        6476.67,
        11884.95
      ]
    ]
  },
  "reference_solution": {
    "total_cost": 213349.6675,
    "centers_open": [1, 1, 1, 1, 0, 1, 0, 0],
    "partner_assignments": [[0, 0, 0, 1, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [1, 0, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0], [0, 0, 0, 0, 0, 1, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0, 0, 0], [0, 1, 0, 0, 0, 0, 0, 0], [0, 0, 1, 0, 0, 0, 0, 0], [1, 0, 0, 0, 0, 0, 0, 0]]
  },
  "solver_code": "from cpmpy import *\nimport json\n\nfulfillment_costs = [7500.0, 7500.0, 7500.0, 0.0, 7500.0, 7500.0, 7500.0, 7500.0]\nretail_partners = [\n    [6429.48, 5396.52, 5219.5, 4182.9, 7391.25, 5038.82, 10349.58, 6051.7],\n    [8663.27, 3204.86, 5457.07, 3845.4, 2396.85, 2628.49, 3220.09, 1838.96],\n    [2838.38, 4940.51, 4642.54, 3507.19, 2035.8, 2890.57, 3943.28, 5984.51],\n    [64292.99, 80186.57, 25921.09, 69206.46, 23096.67, 48700.22, 135170.7, 40527.81],\n    [23856.0, 48568.8, 66066.0, 66973.2, 16203.6, 1715.46, 2152.18, 1577.9],\n    [75663.9, 36305.1, 45918.6, 72233.2, 198000.4, 282712.3, 269592.7, 69254.9],\n    [70000.0, 40000.0, 50000.0, 70000.0, 200000.0, 280000.0, 270000.0, 70000.0],\n    [5638.74, 12438.11, 4123.9, 5635.58, 21789.63, 8073.86, 16239.44, 11726.55],\n    [9863.84, 8597.06, 14113.13, 10500.75, 7254.0, 7875.56, 9152.81, 5467.31],\n    [1846.8, 1853.93, 1722.83, 1227.88, 889.2, 505.4, 2041.55, 3108.88],\n    [30655.91, 11166.86, 22333.73, 20982.0, 56025.98, 17380.76, 40178.51, 15978.6],\n    [36405.79, 12087.56, 19877.33, 9670.05, 3801.9, 2252.21, 5847.49, 19650.04],\n    [14856.34, 7665.79, 4959.0, 11984.25, 34713.0, 50189.21, 48040.31, 13492.61],\n    [9496.2, 11616.6, 7106.0, 10898.4, 28226.4, 7117.4, 7725.4, 7911.6],\n    [21866.08, 8099.3, 15669.5, 41636.1, 64804.58, 63420.78, 30250.28, 24063.88],\n    [5918.56, 12852.34, 3268.9, 9073.73, 29479.08, 5623.69, 13172.49, 8745.15],\n    [7022.2375, 281463.0, 406770.0, 325852.8, 253234.8, 264755.4, 294457.8, 211356.6],\n    [16118.44, 8049.94, 17411.63, 21687.19, 19991.82, 19843.32, 17362.13, 26420.63],\n    [7551.49, 22351.54, 1601.18, 11698.68, 49650.85, 9022.84, 26549.21, 16963.8],\n    [3727.76, 11116.875, 8229.375, 5826.975, 4628.6625, 6632.5875, 6476.6625, 11884.95]\n]\n\nm = len(fulfillment_costs)\nn = len(retail_partners)\n\nmodel = Model()\n\ncenter_open = boolvar(shape=m)\nassign_partner_to_center = boolvar(shape=(n, m))\n\nfor j in range(n):\n    model += sum(assign_partner_to_center[j]) == 1\n\nfor j in range(n):\n    for i in range(m):\n        model += assign_partner_to_center[j, i] <= center_open[i]\n\ntotal_cost = sum(fulfillment_costs[i] * center_open[i] for i in range(m))\ntotal_cost += sum(retail_partners[j][i] * assign_partner_to_center[j, i] for j in range(n) for i in range(m))\n\nmodel.minimize(total_cost)\n\nif model.solve():\n    result = {\n        \"total_cost\": total_cost.value(),\n        \"centers_open\": [int(center_open[i].value()) for i in range(m)],\n        \"partner_assignments\": [[int(assign_partner_to_center[j, i].value()) for i in range(m)] for j in range(n)]\n    }\n    print(json.dumps(result))\nelse:\n    raise ValueError(\"No solution found\")",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"centers_open\", \"partner_assignments\", \"total_cost\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        centers_open = solution[\"centers_open\"]\n        partner_assignments = solution[\"partner_assignments\"]\n        total_cost = solution[\"total_cost\"]\n        \n        center_costs = structured_data[\"fulfillment_costs\"]\n        partners = structured_data[\"retail_partners\"]\n        \n        m = len(center_costs)\n        n = len(partners)\n        \n        errors = []\n        \n        # Hard constraint 1: Each partner must be assigned to exactly one center\n        for j in range(n):\n            assigned_sum = sum(partner_assignments[j])\n            if abs(assigned_sum - 1.0) > 1e-6:\n                errors.append(f\"Partner {j} must be assigned to exactly one center (assigned to {assigned_sum} centers)\")\n        \n        # Hard constraint 2: A partner can only be assigned to an open center\n        for j in range(n):\n            for i in range(m):\n                if partner_assignments[j][i] == 1 and centers_open[i] != 1:\n                    errors.append(f\"Partner {j} assigned to closed center {i}\")\n        \n        # Hard constraint 3: Center decisions must be binary\n        for i in range(m):\n            if centers_open[i] not in [0, 1]:\n                errors.append(f\"Center {i} decision must be 0 or 1 (got {centers_open[i]})\")\n        \n        # Hard constraint 4: Assignment decisions must be binary\n        for j in range(n):\n            for i in range(m):\n                if partner_assignments[j][i] not in [0, 1]:\n                    errors.append(f\"Assignment[{j}][{i}] must be 0 or 1 (got {partner_assignments[j][i]})\")\n        \n        # Hard constraint 5: Array dimensions must match\n        if len(centers_open) != m:\n            errors.append(f\"centers_open must have length {m} (got {len(centers_open)})\")\n            \n        if len(partner_assignments) != n:\n            errors.append(f\"partner_assignments must have {n} rows (got {len(partner_assignments)})\")\n            \n        for j in range(n):\n            if len(partner_assignments[j]) != m:\n                errors.append(f\"partner_assignments[{j}] must have {m} columns (got {len(partner_assignments[j])})\")\n        \n        if len(errors) > 0:\n            return {\n                \"is_valid\": False,\n                \"validation_errors\": errors,\n                \"optimality_score\": 0.0\n            }\n        \n        # Calculate optimality score (only if hard constraints are satisfied)\n        optimal_value = reference_solution[\"total_cost\"]\n        if optimal_value == 0:\n            optimality_score = 1.0 if total_cost == 0 else 0.0\n        else:\n            gap = abs(optimal_value - total_cost) / abs(optimal_value)\n            optimality_score = max(0, 1 - gap)\n            \n        return {\n            \"is_valid\": True,\n            \"validation_errors\": [],\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}