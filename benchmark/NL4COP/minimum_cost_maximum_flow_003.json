{
  "problem_id": "minimum_cost_maximum_flow_003",
  "metadata": {
    "problem_type": "Minimum Cost Maximum Flow Problem",
    "difficulty": "hard"
  },
  "problem_description": "A municipal water utility operates a water supply network with 1 main water source, 28 intermediate water stations, and 1 final distribution point, all connected by pipelines with different flow capacities and pumping costs. The water utility manager needs to determine how to optimize water delivery from the main water source to the final distribution point by sending as much water as possible while keeping pumping costs as low as possible. The water distribution system consists of multiple layers: the source layer connects the main water source to primary distribution stations, the middle layer provides regional routing through intermediate stations, and the final layer delivers water to the distribution point. Each pipeline has a maximum flow capacity and a pumping cost per unit of water pumped. Water flow must be conserved at each intermediate station, meaning the total incoming water equals the total outgoing water. No pipeline can carry more water than its capacity limit, and all water flows are unidirectional as specified. The complete water supply system details are as follows: From Water Source: to Station A with capacity 20 gallons per minute and cost $3 per 100 gallons; to Station B with capacity 18 gallons per minute and cost $4 per 100 gallons. From Station A: to Station C with capacity 15 gallons per minute and cost $2 per 100 gallons; to Station G with capacity 12 gallons per minute and cost $3 per 100 gallons. From Station B: to Station D with capacity 14 gallons per minute and cost $5 per 100 gallons; to Station H with capacity 16 gallons per minute and cost $3 per 100 gallons. From Station C: to Station E with capacity 13 gallons per minute and cost $2 per 100 gallons; to Station I with capacity 11 gallons per minute and cost $4 per 100 gallons. From Station D: to Station F with capacity 10 gallons per minute and cost $6 per 100 gallons; to Station J with capacity 17 gallons per minute and cost $3 per 100 gallons. From Station E: to Station K with capacity 19 gallons per minute and cost $2 per 100 gallons. From Station F: to Station L with capacity 8 gallons per minute and cost $7 per 100 gallons. From Station G: to Station M with capacity 14 gallons per minute and cost $3 per 100 gallons; to Station N with capacity 16 gallons per minute and cost $2 per 100 gallons. From Station H: to Station M with capacity 12 gallons per minute and cost $4 per 100 gallons; to Station O with capacity 15 gallons per minute and cost $3 per 100 gallons. From Station I: to Station N with capacity 13 gallons per minute and cost $3 per 100 gallons; to Station P with capacity 18 gallons per minute and cost $2 per 100 gallons. From Station J: to Station O with capacity 11 gallons per minute and cost $5 per 100 gallons; to Station Q with capacity 14 gallons per minute and cost $4 per 100 gallons. From Station K: to Station P with capacity 17 gallons per minute and cost $3 per 100 gallons. From Station L: to Station Q with capacity 9 gallons per minute and cost $6 per 100 gallons. From Station M: to Station R with capacity 20 gallons per minute and cost $2 per 100 gallons; to Station S with capacity 18 gallons per minute and cost $3 per 100 gallons. From Station N: to Station T with capacity 15 gallons per minute and cost $3 per 100 gallons; to Station W with capacity 12 gallons per minute and cost $4 per 100 gallons. From Station O: to Station S with capacity 13 gallons per minute and cost $4 per 100 gallons; to Station X with capacity 16 gallons per minute and cost $3 per 100 gallons. From Station P: to Station T with capacity 14 gallons per minute and cost $4 per 100 gallons; to Station Y with capacity 19 gallons per minute and cost $2 per 100 gallons. From Station Q: to Station U with capacity 11 gallons per minute and cost $5 per 100 gallons; to Station Z with capacity 13 gallons per minute and cost $4 per 100 gallons. From Station R: to Station V with capacity 16 gallons per minute and cost $3 per 100 gallons; to Station AA with capacity 14 gallons per minute and cost $4 per 100 gallons. From Station S: to Station V with capacity 15 gallons per minute and cost $4 per 100 gallons; to Station BB with capacity 17 gallons per minute and cost $3 per 100 gallons. From Station T: to Station W with capacity 13 gallons per minute and cost $5 per 100 gallons; to Station Y with capacity 11 gallons per minute and cost $6 per 100 gallons. From Station U: to Station X with capacity 12 gallons per minute and cost $6 per 100 gallons. ; to Station Z with capacity 14 gallons per minute and cost $5 per 100 gallons. From Station V: to Station AA with capacity 18 gallons per minute and cost $3 per 100 gallons. ; to Station BB with capacity 16 gallons per minute and cost $4 per 100 gallons. From Station W: to Station CC with capacity 20 gallons per minute and cost $2 per 100 gallons. From Station X: to Station CC with capacity 18 gallons per minute and cost $3 per 100 gallons. From Station Y: to Station CC with capacity 22 gallons per minute and cost $2 per 100 gallons. From Station Z: to Station CC with capacity 15 gallons per minute and cost $4 per 100 gallons. From Station AA: to Station CC with capacity 17 gallons per minute and cost $3 per 100 gallons. From Station BB: to Station CC with capacity 19 gallons per minute and cost $3 per 100 gallons.",  
  "solution_format_description": "Print the following fields: - max_water_flow: maximum water flow from source to distribution point. - total_pumping_cost: total pumping cost. - water_flow_distribution: for each pipeline, list water amount with from station, to station, water amount.",  
  "structured_data": {
    "num_stations": 30,
    "water_pipelines": [
      [0, 1, 20, 3],
      [0, 2, 18, 4],
      [1, 3, 15, 2],
      [1, 7, 12, 3],
      [2, 4, 14, 5],
      [2, 8, 16, 3],
      [3, 5, 13, 2],
      [3, 9, 11, 4],
      [4, 6, 10, 6],
      [4, 10, 17, 3],
      [5, 11, 19, 2],
      [6, 12, 8, 7],
      [7, 13, 14, 3],
      [7, 14, 16, 2],
      [8, 13, 12, 4],
      [8, 15, 15, 3],
      [9, 14, 13, 3],
      [9, 16, 18, 2],
      [10, 15, 11, 5],
      [10, 17, 14, 4],
      [11, 16, 17, 3],
      [12, 17, 9, 6],
      [13, 18, 20, 2],
      [13, 19, 18, 3],
      [14, 20, 15, 3],
      [14, 23, 12, 4],
      [15, 19, 13, 4],
      [15, 24, 16, 3],
      [16, 20, 14, 4],
      [16, 25, 19, 2],
      [17, 21, 11, 5],
      [17, 26, 13, 4],
      [18, 22, 16, 3],
      [18, 27, 14, 4],
      [19, 22, 15, 4],
      [19, 28, 17, 3],
      [20, 23, 13, 5],
      [20, 25, 11, 6],
      [21, 24, 12, 6],
      [21, 26, 14, 5],
      [22, 27, 18, 3],
      [22, 28, 16, 4],
      [23, 29, 20, 2],
      [24, 29, 18, 3],
      [25, 29, 22, 2],
      [26, 29, 15, 4],
      [27, 29, 17, 3],
      [28, 29, 19, 3]
    ]
  },
  "reference_solution": {
    "max_water_flow": 38,
    "total_pumping_cost": 595,
    "water_flow_distribution": [[0, 1, 20], [0, 2, 18], [1, 3, 8], [1, 7, 12], [2, 4, 2], [2, 8, 16], [3, 9, 8], [4, 10, 2], [7, 14, 12], [8, 13, 1], [8, 15, 15], [9, 16, 8], [10, 15, 1], [10, 17, 1], [13, 18, 1], [14, 23, 12], [15, 24, 16], [16, 25, 8], [17, 26, 1], [18, 27, 1], [23, 29, 12], [24, 29, 16], [25, 29, 8], [26, 29, 1], [27, 29, 1]]
  },
  "solver_code": "",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"max_water_flow\", \"total_pumping_cost\", \"water_flow_distribution\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        max_water_flow = solution[\"max_water_flow\"]\n        total_pumping_cost = solution[\"total_pumping_cost\"]\n        water_flow_distribution = solution[\"water_flow_distribution\"]\n        water_pipelines = structured_data[\"water_pipelines\"]\n        num_stations = structured_data[\"num_stations\"]\n        source = 0\n        sink = 29\n        \n        errors = []\n        \n        capacity = [[0] * num_stations for _ in range(num_stations)]\n        cost = [[0] * num_stations for _ in range(num_stations)]\n        for from_node, to_node, cap, c in water_pipelines:\n            capacity[from_node][to_node] = cap\n            cost[from_node][to_node] = c\n        \n        inflow = [0] * num_stations\n        outflow = [0] * num_stations\n        actual_cost = 0\n        \n        for flow_item in water_flow_distribution:\n            from_node, to_node, water_amount = flow_item\n            \n            if water_amount > capacity[from_node][to_node]:\n                errors.append(f\"Water flow {water_amount} exceeds capacity {capacity[from_node][to_node]} on pipeline {from_node}->{to_node}\")\n            \n            if water_amount < 0:\n                errors.append(f\"Negative water flow {water_amount} on pipeline {from_node}->{to_node}\")\n            \n            outflow[from_node] += water_amount\n            inflow[to_node] += water_amount\n            actual_cost += water_amount * cost[from_node][to_node]\n        \n        if outflow[source] != max_water_flow:\n            errors.append(f\"Water source outflow {outflow[source]} != max_water_flow {max_water_flow}\")\n        \n        if inflow[sink] != max_water_flow:\n            errors.append(f\"Distribution point inflow {inflow[sink]} != max_water_flow {max_water_flow}\")\n        \n        for i in range(num_stations):\n            if i != source and i != sink:\n                if abs(inflow[i] - outflow[i]) > 1e-6:\n                    errors.append(f\"Flow conservation violation at station {i}: inflow {inflow[i]} != outflow {outflow[i]}\")\n        \n        if abs(actual_cost - total_pumping_cost) > 1e-6:\n            errors.append(f\"Cost calculation error: actual {actual_cost} != declared {total_pumping_cost}\")\n        \n        is_valid = len(errors) == 0\n        \n        if not is_valid:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        optimal_flow = reference_solution[\"max_water_flow\"]\n        optimal_cost = reference_solution[\"total_pumping_cost\"]\n        \n        if max_water_flow != optimal_flow:\n            gap = abs(optimal_flow - max_water_flow) / abs(optimal_flow)\n            flow_score = max(0, 1 - gap)\n        else:\n            flow_score = 1.0\n        \n        if optimal_cost == 0:\n            cost_score = 1.0 if total_pumping_cost == 0 else 0.0\n        else:\n            gap = abs(optimal_cost - total_pumping_cost) / abs(optimal_cost)\n            cost_score = max(0, 1 - gap)\n        \n        optimality_score = 0.7 * flow_score + 0.3 * cost_score\n        \n        return {\n            \"is_valid\": is_valid,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}