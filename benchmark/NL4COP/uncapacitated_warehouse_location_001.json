{
    "problem_id": "uncapacitated_warehouse_location_001",
    "metadata": {
        "problem_type": "Uncapacitated Warehouse Location Problem",
        "difficulty": "simple"
    },
    "problem_description": "A fast-growing e-commerce company needs to establish fulfillment centers to serve its customers efficiently. The company has identified 2 potential locations for building warehouses, each requiring a significant upfront investment. The company currently serves 5 major customer clusters across different regions, with each cluster having specific demand volumes based on historical sales data. Shipping costs vary between each potential warehouse location and customer cluster due to differences in distance, transportation infrastructure, and regional logistics challenges. The company must decide which warehouses to build and how to assign each customer cluster to the selected warehouses to minimize total operational costs, considering both the fixed construction costs and ongoing shipping expenses. Each warehouse can either be built or not, and each customer cluster must be served by exactly one warehouse.\n\nThe construction costs for each potential warehouse location are:\n- Warehouse Location 1: $1500\n- Warehouse Location 2: $2000\n\nThe customer clusters have the following annual demand (in thousands of orders) and per-order shipping costs from each warehouse: Customer Cluster 1 requires 80 thousand orders annually, with shipping costs of $50 per order from Warehouse Location 1 and $70 per order from Warehouse Location 2; Customer Cluster 2 requires 120 thousand orders annually, with shipping costs of $60 per order from Warehouse Location 1 and $40 per order from Warehouse Location 2; Customer Cluster 3 requires 90 thousand orders annually, with shipping costs of $80 per order from Warehouse Location 1 and $90 per order from Warehouse Location 2; Customer Cluster 4 requires 110 thousand orders annually, with shipping costs of $70 per order from Warehouse Location 1 and $50 per order from Warehouse Location 2; Customer Cluster 5 requires 100 thousand orders annually, with shipping costs of $90 per order from Warehouse Location 1 and $60 per order from Warehouse Location 2.",
    "solution_format_description": "Print the following fields: - total_cost: total construction and shipping cost. - centers_open: which warehouses are opened. - assignments: customer cluster assignments to warehouses.",
    "structured_data": {
        "fulfillment_costs": [1500, 2000],
        "customer_clusters": [
            [80000, 50, 70],
            [120000, 60, 40],
            [90000, 80, 90],
            [110000, 70, 50],
            [100000, 90, 60]
        ]
    },
    "reference_solution": {
        "total_cost": 27503500,
        "centers_open": [1, 1],
        "assignments": [[1, 0], [0, 1], [1, 0], [0, 1], [0, 1]]
    },
    "solver_code": "from cpmpy import *\nimport json\n\nfulfillment_costs = [1500, 2000]\ncustomer_clusters = [\n    [80000, 50, 70],\n    [120000, 60, 40],\n    [90000, 80, 90],\n    [110000, 70, 50],\n    [100000, 90, 60]\n]\n\nm = len(fulfillment_costs)\nn = len(customer_clusters)\n\ndemands = [customer_clusters[j][0] for j in range(n)]\nshipping_costs = [[customer_clusters[j][i+1] for i in range(m)] for j in range(n)]\n\nmodel = Model()\n\nwarehouse_open = boolvar(shape=m)\nassign_customer_to_warehouse = boolvar(shape=(n, m))\n\nfor j in range(n):\n    model += sum(assign_customer_to_warehouse[j]) == 1\n\nfor j in range(n):\n    for i in range(m):\n        model += assign_customer_to_warehouse[j, i] <= warehouse_open[i]\n\ntotal_cost = sum(fulfillment_costs[i] * warehouse_open[i] for i in range(m))\ntotal_cost += sum(demands[j] * shipping_costs[j][i] * assign_customer_to_warehouse[j, i] for j in range(n) for i in range(m))\n\nmodel.minimize(total_cost)\n\nif model.solve():\n    result = {\n        \"total_cost\": total_cost.value(),\n        \"centers_open\": [int(warehouse_open[i].value()) for i in range(m)],\n        \"assignments\": [[int(assign_customer_to_warehouse[j, i].value()) for i in range(m)] for j in range(n)]\n    }\n    print(json.dumps(result))\nelse:\n    print(\"No solution found\")",
    "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"total_cost\", \"centers_open\", \"assignments\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        total_cost = solution[\"total_cost\"]\n        centers_open = solution[\"centers_open\"]\n        assignments = solution[\"assignments\"]\n        fulfillment_costs = structured_data[\"fulfillment_costs\"]\n        customer_clusters = structured_data[\"customer_clusters\"]\n        errors = []\n        \n        m = len(fulfillment_costs)\n        n = len(customer_clusters)\n        \n        if len(centers_open) != m:\n            errors.append(f\"centers_open length mismatch: expected {m}, got {len(centers_open)}\")\n        \n        if len(assignments) != n:\n            errors.append(f\"assignments length mismatch: expected {n}, got {len(assignments)}\")\n        \n        for j in range(n):\n            if len(assignments[j]) != m:\n                errors.append(f\"assignments[{j}] length mismatch: expected {m}, got {len(assignments[j])}\")\n        \n        for i in range(m):\n            if centers_open[i] not in [0, 1]:\n                errors.append(f\"centers_open[{i}] must be 0 or 1, got {centers_open[i]}\")\n        \n        calculated_total_cost = 0\n        \n        for i in range(m):\n            if centers_open[i] == 1:\n                calculated_total_cost += fulfillment_costs[i]\n        \n        for j in range(n):\n            customer_demand = customer_clusters[j][0]\n            assigned_sum = sum(assignments[j])\n            \n            if assigned_sum != 1:\n                errors.append(f\"Customer {j} assignment violation: total assigned value {assigned_sum} does not equal 1.\")\n            \n            for i in range(m):\n                assignment = assignments[j][i]\n                \n                if assignment not in [0, 1]:\n                    errors.append(f\"Customer {j} has a non-binary assignment value {assignment} for warehouse {i}.\")\n                \n                if assignment == 1:\n                    if centers_open[i] != 1:\n                        errors.append(f\"Customer {j} is assigned to warehouse {i}, which is closed.\")\n                    else:\n                        calculated_total_cost += customer_demand * customer_clusters[j][i+1]\n        \n        if abs(calculated_total_cost - total_cost) > 1e-6:\n            errors.append(f\"Cost inconsistency: calculated {calculated_total_cost}, declared {total_cost}\")\n        \n        if len(errors) > 0:\n            optimality_score = 0.0\n        else:\n            optimal_cost = reference_solution[\"total_cost\"]\n            if optimal_cost == 0:\n                optimality_score = 1.0 if total_cost == 0 else 0.0\n            else:\n                gap = abs(optimal_cost - total_cost) / abs(optimal_cost)\n                optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}