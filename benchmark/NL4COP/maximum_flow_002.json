{
  "problem_id": "maximum_flow_002",
  "metadata": {
    "problem_type": "Maximum Flow Problem",
    "difficulty": "medium"
  },
  "problem_description": "A telecommunications company operates a network with 20 switching centers arranged in a hierarchical structure, connected by 29 directional data transmission lines with different bandwidth capacities. The network engineer needs to determine the maximum data throughput from the main server to the end-user terminal. The network topology consists of three main layers: the source layer connects the main server to primary distribution centers, the middle layer provides routing between regional centers, and the final layer connects aggregation centers to the terminal. The complete network connections and their bandwidth capacities are as follows: From the main server: to center 1 with 15 Gbps, to center 2 with 12 Gbps. From center 1: to center 3 with 8 Gbps, to center 7 with 10 Gbps. From center 2: to center 4 with 9 Gbps, to center 8 with 11 Gbps. From center 3: to center 5 with 7 Gbps, to center 9 with 13 Gbps. From center 4: to center 6 with 6 Gbps, to center 10 with 14 Gbps. From center 5: to center 11 with 16 Gbps. From center 6: to center 10 with 8 Gbps. From center 7: to center 12 with 9 Gbps, to center 13 with 12 Gbps. From center 8: to center 12 with 7 Gbps, to center 14 with 10 Gbps. From center 9: to center 13 with 11 Gbps, to center 15 with 8 Gbps. From center 10: to center 14 with 13 Gbps, to center 16 with 9 Gbps. From center 11: to center 15 with 14 Gbps, to center 17 with 10 Gbps. From center 12: to center 18 with 15 Gbps. From center 13: to center 18 with 12 Gbps. From center 14: to center 18 with 8 Gbps. From center 15: to center 17 with 11 Gbps. From center 16: to center 18 with 13 Gbps. From center 17: to center 19 with 18 Gbps. From center 18: to center 19 with 20 Gbps. Each transmission line can only handle data flow in the specified direction and cannot exceed its bandwidth capacity. Data flow must be conserved at each intermediate switching center, meaning the total incoming data must equal the total outgoing data. The engineer wants to find the optimal routing configuration that maximizes the total data transmission from the main server to the terminal while respecting all bandwidth constraints and flow conservation requirements.",
  "solution_format_description": "Print the following fields: - max_flow: maximum data throughput from server to terminal. - flow_distribution: data flow amount for each transmission line.",  
  "structured_data": {
    "num_centers": 20,
    "transmission_lines": [
      [0, 1, 15], [0, 2, 12], [1, 3, 8], [1, 7, 10], [2, 4, 9],
      [2, 8, 11], [3, 5, 7], [3, 9, 13], [4, 6, 6], [4, 10, 14],
      [5, 11, 16], [6, 10, 8], [7, 12, 9], [7, 13, 12], [8, 12, 7],
      [8, 14, 10], [9, 13, 11], [9, 15, 8], [10, 14, 13], [10, 16, 9],
      [11, 15, 14], [11, 17, 10], [12, 18, 15], [13, 18, 12], [14, 18, 8],
      [15, 17, 11], [16, 18, 13], [17, 19, 18], [18, 19, 20]
    ]
  },
  "reference_solution": {
    "max_flow": 27,
    "flow_distribution": [[0, 1, 15], [0, 2, 12], [1, 3, 7], [1, 7, 8], [2, 4, 1], [2, 8, 11], [3, 5, 7], [4, 10, 1], [5, 11, 7], [7, 12, 7], [7, 13, 1], [8, 12, 7], [8, 14, 4], [10, 14, 1], [11, 17, 7], [12, 18, 14], [13, 18, 1], [14, 18, 5], [17, 19, 7], [18, 19, 20]]
    },
  "solver_code": "",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"max_flow\", \"flow_distribution\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        max_flow = solution[\"max_flow\"]\n        flow_distribution = solution[\"flow_distribution\"]\n        transmission_lines = structured_data[\"transmission_lines\"]\n        num_centers = structured_data[\"num_centers\"]\n        source = 0\n        sink = 19\n        \n        errors = []\n        \n        capacity = [[0] * num_centers for _ in range(num_centers)]\n        for line in transmission_lines:\n            from_center, to_center, line_capacity = line\n            capacity[from_center][to_center] = line_capacity\n        \n        inflow = [0] * num_centers\n        outflow = [0] * num_centers\n        \n        for flow_item in flow_distribution:\n            from_center, to_center, data_amount = flow_item\n            \n            if data_amount > capacity[from_center][to_center]:\n                errors.append(f\"Data {data_amount} exceeds bandwidth {capacity[from_center][to_center]} on line {from_center}->{to_center}\")\n            \n            if data_amount < 0:\n                errors.append(f\"Negative data {data_amount} on line {from_center}->{to_center}\")\n            \n            outflow[from_center] += data_amount\n            inflow[to_center] += data_amount\n        \n        if outflow[source] != max_flow:\n            errors.append(f\"Server outflow {outflow[source]} != max_flow {max_flow}\")\n        \n        if inflow[sink] != max_flow:\n            errors.append(f\"Terminal inflow {inflow[sink]} != max_flow {max_flow}\")\n        \n        for i in range(num_centers):\n            if i != source and i != sink:\n                if abs(inflow[i] - outflow[i]) > 1e-6:\n                    errors.append(f\"Flow conservation violation at center {i}: inflow {inflow[i]} != outflow {outflow[i]}\")\n        \n        is_valid = len(errors) == 0\n        \n        if not is_valid:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        optimal_flow = reference_solution[\"max_flow\"]\n        if optimal_flow == 0:\n            optimality_score = 1.0 if max_flow == 0 else 0.0\n        else:\n            gap = abs(optimal_flow - max_flow) / abs(optimal_flow)\n            optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": is_valid,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}