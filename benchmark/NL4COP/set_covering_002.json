{
  "problem_id": "set_covering_002",
  "metadata": {
    "problem_type": "Set Covering Problem",
    "difficulty": "medium"
  },
  "problem_description": "An advanced metropolitan emergency infrastructure system requires strategic deployment of response facilities across 16 designated num_districts. Municipal authorities have evaluated 32 potential num_locations, each characterized by distinct construction_costs and unique location_coverage matrices defining their service capabilities. Deployment specifications are as follows: Site 1 requires construction_costs of 800 thousand yuan with location_coverage for num_districts 10, 15; Site 2 requires construction_costs of 630 thousand yuan with location_coverage for num_districts 1, 13, 15; Site 3 requires construction_costs of 600 thousand yuan with location_coverage for num_districts 6, 14; Site 4 requires construction_costs of 830 thousand yuan with location_coverage for num_districts 4, 5, 13; Site 5 requires construction_costs of 680 thousand yuan with location_coverage for num_districts 2, 4, 7; Site 6 requires construction_costs of 670 thousand yuan with location_coverage for num_districts 12, 14; Site 7 requires construction_costs of 670 thousand yuan with location_coverage for num_districts 1, 9, 13; Site 8 requires construction_costs of 640 thousand yuan with location_coverage for num_districts 4, 7, 15; Site 9 requires construction_costs of 830 thousand yuan with location_coverage for num_districts 10, 14; Site 10 requires construction_costs of 630 thousand yuan with location_coverage for num_districts 2, 7, 12; Site 11 requires construction_costs of 1430 thousand yuan with location_coverage for num_districts 2, 5, 8, 13; Site 12 requires construction_costs of 1470 thousand yuan with location_coverage for num_districts 4, 5, 7, 8; Site 13 requires construction_costs of 1570 thousand yuan with location_coverage for num_districts 3, 4, 6, 11, 12, 14; Site 14 requires construction_costs of 1340 thousand yuan with location_coverage for num_districts 3, 9, 10, 11, 16; Site 15 requires construction_costs of 1050 thousand yuan with location_coverage for num_districts 3, 5, 7, 8, 11, 16; Site 16 requires construction_costs of 1370 thousand yuan with location_coverage for num_districts 1, 4, 6, 8, 11, 13; Site 17 requires construction_costs of 1270 thousand yuan with location_coverage for num_districts 2, 5, 7, 11; Site 18 requires construction_costs of 1020 thousand yuan with location_coverage for num_districts 4, 8, 11, 16; Site 19 requires construction_costs of 1010 thousand yuan with location_coverage for num_districts 3, 4, 5, 15, 16; Site 20 requires construction_costs of 1050 thousand yuan with location_coverage for num_districts 7, 9, 10, 12, 13, 14; Site 21 requires construction_costs of 1130 thousand yuan with location_coverage for num_districts 2, 3, 8, 9, 16; Site 22 requires construction_costs of 1140 thousand yuan with location_coverage for num_districts 3, 4, 11, 15; Site 23 requires construction_costs of 1320 thousand yuan with location_coverage for num_districts 2, 7, 10, 13, 14, 15; Site 24 requires construction_costs of 1380 thousand yuan with location_coverage for num_districts 1, 9, 11, 14, 16; Site 25 requires construction_costs of 1010 thousand yuan with location_coverage for num_districts 4, 5, 9, 11, 13, 15; Site 26 requires construction_costs of 2350 thousand yuan with location_coverage for num_districts 1, 3, 4, 5, 7, 8, 9, 15; Site 27 requires construction_costs of 2120 thousand yuan with location_coverage for num_districts 4, 5, 9, 10, 11, 14, 15; Site 28 requires construction_costs of 2450 thousand yuan with location_coverage for num_districts 1, 3, 5, 6, 9, 12, 13; Site 29 requires construction_costs of 2410 thousand yuan with location_coverage for num_districts 1, 2, 4, 5, 6, 8, 10, 11, 14; Site 30 requires construction_costs of 2440 thousand yuan with location_coverage for num_districts 2, 3, 8, 9, 10, 12, 13, 15, 16; Site 31 requires construction_costs of 2340 thousand yuan with location_coverage for num_districts 4, 5, 6, 7, 9, 10, 11, 14, 15; Site 32 requires construction_costs of 2260 thousand yuan with location_coverage for num_districts 2, 4, 8, 9, 11, 12, 15, 16. Each num_districts must be covered by the location_coverage of at least one selected site. Each num_locations can either be developed or remain undeveloped, with partial development prohibited. Authorities must determine optimal site selection to achieve complete coverage while minimizing total_construction_cost.",
  "solution_format_description": "Print the following fields: - selected_locations: chosen construction sites. - total_construction_cost: total cost of selected sites.",
  "structured_data": {
    "num_districts": 16,
    "num_locations": 32,
    "construction_costs": [800, 630, 600, 830, 680, 670, 670, 640, 830, 630, 1430, 1470, 1570, 1340, 1050, 1370, 1270, 1020, 1010, 1050, 1130, 1140, 1320, 1380, 1010, 2350, 2120, 2450, 2410, 2440, 2340, 2260],
    "location_coverage": [[10, 15], [1, 13, 15], [6, 14], [4, 5, 13], [2, 4, 7], [12, 14], [1, 9, 13], [4, 7, 15], [10, 14], [2, 7, 12], [2, 5, 8, 13], [4, 5, 7, 8], [3, 4, 6, 11, 12, 14], [3, 9, 10, 11, 16], [3, 5, 7, 8, 11, 16], [1, 4, 6, 8, 11, 13], [2, 5, 7, 11], [4, 8, 11, 16], [3, 4, 5, 15, 16], [7, 9, 10, 12, 13, 14], [2, 3, 8, 9, 16], [3, 4, 11, 15], [2, 7, 10, 13, 14, 15], [1, 9, 11, 14, 16], [4, 5, 9, 11, 13, 15], [1, 3, 4, 5, 7, 8, 9, 15], [4, 5, 9, 10, 11, 14, 15], [1, 3, 5, 6, 9, 12, 13], [1, 2, 4, 5, 6, 8, 10, 11, 14], [2, 3, 8, 9, 10, 12, 13, 15, 16], [4, 5, 6, 7, 9, 10, 11, 14, 15], [2, 4, 8, 9, 11, 12, 15, 16]]
  },
  "reference_solution": {
    "selected_locations": [2, 3, 5, 15, 20],
    "total_construction_cost": 4010
  },
  "solver_code": "from cpmpy import *\nimport json\n\n\nnum_districts = 16\nnum_locations = 32\nconstruction_costs = [800, 630, 600, 830, 680, 670, 670, 640, 830, 630, 1430, 1470, 1570, 1340, 1050, 1370, 1270, 1020, 1010, 1050, 1130, 1140, 1320, 1380, 1010, 2350, 2120, 2450, 2410, 2440, 2340, 2260]\nlocation_coverage = [\n    [10, 15], [1, 13, 15], [6, 14], [4, 5, 13], [2, 4, 7], [12, 14], [1, 9, 13], [4, 7, 15], [10, 14], [2, 7, 12],\n    [2, 5, 8, 13], [4, 5, 7, 8], [3, 4, 6, 11, 12, 14], [3, 9, 10, 11, 16], [3, 5, 7, 8, 11, 16], [1, 4, 6, 8, 11, 13],\n    [2, 5, 7, 11], [4, 8, 11, 16], [3, 4, 5, 15, 16], [7, 9, 10, 12, 13, 14], [2, 3, 8, 9, 16], [3, 4, 11, 15],\n    [2, 7, 10, 13, 14, 15], [1, 9, 11, 14, 16], [4, 5, 9, 11, 13, 15], [1, 3, 4, 5, 7, 8, 9, 15], [4, 5, 9, 10, 11, 14, 15],\n    [1, 3, 5, 6, 9, 12, 13], [1, 2, 4, 5, 6, 8, 10, 11, 14], [2, 3, 8, 9, 10, 12, 13, 15, 16], [4, 5, 6, 7, 9, 10, 11, 14, 15],\n    [2, 4, 8, 9, 11, 12, 15, 16]\n]\n\n\nmodel = Model()\n\n\nx = boolvar(shape=num_locations)\n\n\nfor district in range(1, num_districts + 1):\n    covering_locations = [j for j in range(num_locations) if district in location_coverage[j]]\n    model += sum(x[j] for j in covering_locations) >= 1\n\n\nmodel.minimize(sum(construction_costs[j] * x[j] for j in range(num_locations)))\n\n\nif model.solve():\n    selected_locations = [j+1 for j in range(num_locations) if x[j].value()]\n    total_construction_cost = sum(construction_costs[j] for j in range(num_locations) if x[j].value())\n    \n    result = {\n        \"selected_locations\": selected_locations,\n        \"total_construction_cost\": total_construction_cost\n    }\n    print(json.dumps(result))\nelse:\n    print(\"No solution found\")",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n\n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n\n    required_fields = [\"selected_locations\", \"total_construction_cost\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n\n    try:\n        selected_locations = solution[\"selected_locations\"]\n        total_construction_cost = solution[\"total_construction_cost\"]\n        \n        num_districts = structured_data[\"num_districts\"]\n        num_locations = structured_data[\"num_locations\"]\n        construction_costs = structured_data[\"construction_costs\"]\n        location_coverage = structured_data[\"location_coverage\"]\n        \n        errors = []\n        \n\n        if not isinstance(selected_locations, list):\n            errors.append(\"selected_locations must be a list\")\n        else:\n            for loc in selected_locations:\n                if not isinstance(loc, int) or loc < 1 or loc > num_locations:\n                    errors.append(f\"Location {loc} is out of bounds (should be between 1 and {num_locations})\")\n        \n\n        if isinstance(selected_locations, list) and len(selected_locations) != len(set(selected_locations)):\n            errors.append(\"Duplicate locations in selected_locations\")\n        \n\n        if not isinstance(total_construction_cost, (int, float)) or total_construction_cost < 0:\n            errors.append(\"total_construction_cost must be a non-negative number\")\n        \n\n        if isinstance(selected_locations, list):\n            try:\n                valid_locations = [loc for loc in selected_locations if isinstance(loc, int) and 1 <= loc <= num_locations]\n                calc_cost = sum(construction_costs[loc - 1] for loc in valid_locations)\n                if abs(calc_cost - total_construction_cost) > 1e-6:\n                    errors.append(f\"Cost inconsistency: calculated {calc_cost}, declared {total_construction_cost}\")\n            except (IndexError, TypeError):\n                errors.append(\"Error calculating construction cost\")\n        \n\n        if isinstance(selected_locations, list):\n            try:\n                uncovered_districts = []\n                for district in range(1, num_districts + 1):\n\n                    covering_locations = [j+1 for j in range(num_locations) if district in location_coverage[j]]\n\n                    if not set(covering_locations).intersection(set(selected_locations)):\n                        uncovered_districts.append(district)\n                \n                if uncovered_districts:\n                    errors.append(f\"Coverage constraint violated: districts {uncovered_districts[:10]} are not covered\")\n            except (IndexError, TypeError):\n                errors.append(\"Error verifying coverage constraint\")\n        \n\n        optimal_cost = reference_solution[\"total_construction_cost\"]\n        if optimal_cost == 0:\n            optimality_score = 1.0 if total_construction_cost == 0 else 0.0\n        else:\n            gap = abs(optimal_cost - total_construction_cost) / abs(optimal_cost)\n            optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}