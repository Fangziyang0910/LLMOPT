{
  "problem_id": "travelling_salesman_problem_003",
  "metadata": {
    "problem_type": "Traveling Salesman Problem",
    "difficulty": "hard"
  },
  "problem_description": "An advanced urban mobility management system is tasked with optimizing a comprehensive service network traversal across a metropolitan area characterized by complex spatial distribution patterns. The autonomous service unit operates within a 100km by 100km coordinate grid system where each spatial unit corresponds to one kilometer of actual urban territory. The operational protocol requires the unit to establish service connectivity with fifty distinct points of interest distributed throughout the metropolitan landscape, executing a complete circuit that originates from the primary logistics hub positioned at coordinates (12, 45). The service points exhibit heterogeneous spatial clustering patterns reflecting realistic urban development: Point Alpha-1 occupies (36, 78) in the northeastern district, Point Alpha-2 is situated at (52, 19) in the eastern corridor, Point Alpha-3 resides at (8, 63) in the northwestern sector, Point Alpha-4 is positioned at (91, 24) in the far eastern region, Point Alpha-5 maintains location (47, 58) in the central-northern area, Point Alpha-6 is established at (23, 89) near the northern boundary, Point Alpha-7 functions at (65, 32) in the east-central zone, Point Alpha-8 operates from (15, 10) in the southeastern quadrant, Point Alpha-9 can be reached at (77, 61) in the northeast, Point Alpha-10 sits at (31, 40) in the central region, Point Alpha-11 is located at (59, 93) along the northern edge, Point Alpha-12 occupies (84, 7) in the eastern extremity, Point Alpha-13 is positioned at (29, 55) in the west-central area, Point Alpha-14 maintains (68, 28) in the southeast, Point Alpha-15 is situated at (18, 73) in the northwestern corridor, Point Alpha-16 resides at (42, 14) in the southern sector, Point Alpha-17 is found at (71, 85) near the northern boundary, Point Alpha-18 operates from (3, 37) in the western zone, Point Alpha-19 is positioned at (54, 98) in the northern extremity, Point Alpha-20 occupies (25, 66) in the central-western region, Point Alpha-21 is situated at (60, 21) in the southeast, Point Alpha-22 maintains (88, 50) in the eastern district, Point Alpha-23 is located at (11, 79) in the northwestern area, Point Alpha-24 sits at (49, 16) in the southern corridor, Point Alpha-25 is positioned at (75, 33) in the east-central sector, Point Alpha-26 can be found at (38, 82) in the northern quadrant, Point Alpha-27 resides at (5, 59) in the western region, Point Alpha-28 operates from (94, 41) near the eastern boundary, Point Alpha-29 is established at (22, 7) in the southeastern extremity, Point Alpha-30 functions at (63, 52) in the central area, Point Alpha-31 maintains (19, 87) along the northern edge, Point Alpha-32 is located at (57, 26) in the south-central zone, Point Alpha-33 occupies (81, 64) in the eastern sector, Point Alpha-34 is positioned at (34, 95) near the northern boundary, Point Alpha-35 sits at (70, 13) in the southeastern quadrant, Point Alpha-36 can be reached at (2, 48) in the western corridor, Point Alpha-37 resides at (51, 76) in the northwestern area, Point Alpha-38 is situated at (86, 30) in the central-northern region, Point Alpha-39 maintains (17, 69) in the west-central zone, Point Alpha-40 is positioned at (44, 20) in the southern district, Point Alpha-41 occupies (67, 83) near the northern boundary, Point Alpha-42 is located at (30, 5) in the eastern extremity, Point Alpha-43 sits at (79, 46) in the east-central sector, Point Alpha-44 can be found at (27, 92) along the northern edge, Point Alpha-45 resides at (55, 39) in the central area, Point Alpha-46 operates from (83, 11) in the southeastern quadrant, Point Alpha-47 is positioned at (14, 72) in the western region, Point Alpha-48 maintains (62, 53) in the northwest, and Point Alpha-49 is established at (35, 80) in the central-western corridor. The navigation system employs optimal trajectory calculation using Euclidean distance metrics between coordinate pairs. The fundamental optimization challenge is to determine the most efficient permutation of service point visitations that yields the minimal cumulative traversal distance while satisfying the constraint that each service point receives exactly one visitation and the route forms a complete closed circuit originating and terminating at the primary logistics hub.",
  "solution_format_description": "Print the following fields: - service_route: complete route visiting all service points. - total_distance: total travel distance.",
  "structured_data": {
  "num_service_points": 50,
  "service_point_coordinates": [
    [12, 45], [36, 78], [52, 19], [8, 63], [91, 24],
    [47, 58], [23, 89], [65, 32], [15, 10], [77, 61],
    [31, 40], [59, 93], [84, 7], [29, 55], [68, 28],
    [18, 73], [42, 14], [71, 85], [3, 37], [54, 98],
    [25, 66], [60, 21], [88, 50], [11, 79], [49, 16],
    [75, 33], [38, 82], [5, 59], [94, 41], [22, 7],
    [63, 52], [19, 87], [57, 26], [81, 64], [34, 95],
    [70, 13], [2, 48], [51, 76], [86, 30], [17, 69],
    [44, 20], [67, 83], [30, 5], [79, 46], [27, 92],
    [55, 39], [83, 11], [14, 72], [62, 53], [35, 80]
  ]
},
  "reference_solution": {
  "total_distance": 524.13,
  "service_route": [0, 36, 27, 3, 39, 15, 47, 23, 31, 6, 44, 34, 19, 11, 17, 41, 37, 26, 49, 1, 20, 13, 10, 5, 48, 30, 45, 7, 14, 25, 43, 9, 33, 22, 28, 38, 4, 46, 12, 35, 21, 32, 2, 24, 40, 16, 42, 29, 8, 18, 0]
},
  "solver_code": "from cpmpy import *\nimport json\nimport math\n\nnum_service_points = 50\nservice_point_coordinates = [\n    [12, 45], [36, 78], [52, 19], [8, 63], [91, 24],\n    [47, 58], [23, 89], [65, 32], [15, 10], [77, 61],\n    [31, 40], [59, 93], [84, 7], [29, 55], [68, 28],\n    [18, 73], [42, 14], [71, 85], [3, 37], [54, 98],\n    [25, 66], [60, 21], [88, 50], [11, 79], [49, 16],\n    [75, 33], [38, 82], [5, 59], [94, 41], [22, 7],\n    [63, 52], [19, 87], [57, 26], [81, 64], [34, 95],\n    [70, 13], [2, 48], [51, 76], [86, 30], [17, 69],\n    [44, 20], [67, 83], [30, 5], [79, 46], [27, 92],\n    [55, 39], [83, 11], [14, 72], [62, 53], [35, 80]\n]\n\ndef calculate_distance_matrix(coordinates):\n    n = len(coordinates)\n    dist_matrix = [[0.0 for _ in range(n)] for _ in range(n)]\n    for i in range(n):\n        for j in range(n):\n            if i != j:\n                xi, yi = coordinates[i]\n                xj, yj = coordinates[j]\n                dist_matrix[i][j] = math.sqrt((xi - xj)**2 + (yi - yj)**2)\n    return dist_matrix\n\ndist_matrix = calculate_distance_matrix(service_point_coordinates)\n\nmodel = Model()\nx = boolvar(shape=(num_service_points, num_service_points))\n\nfor i in range(num_service_points):\n    model += sum(x[i, j] for j in range(num_service_points) if i != j) == 1\n\nfor j in range(num_service_points):\n    model += sum(x[i, j] for i in range(num_service_points) if i != j) == 1\n\nu = intvar(0, num_service_points - 1, shape=num_service_points)\nfor i in range(1, num_service_points):\n    for j in range(1, num_service_points):\n        if i != j:\n            model += u[i] - u[j] + num_service_points * x[i, j] <= num_service_points - 1\n\nscale_factor = 10000\nscaled_flat_distances = [int(dist_matrix[r][c] * scale_factor) for r in range(num_service_points) for c in range(num_service_points)]\nobjective_expr = sum(x[i, j] * scaled_flat_distances[i * num_service_points + j] for i in range(num_service_points) for j in range(num_service_points) if i != j)\nmodel.minimize(objective_expr)\n\nif model.solve():\n    service_route = [0]\n    current_point = 0\n    visited = {0}\n    \n    while len(service_route) < num_service_points:\n        for j in range(num_service_points):\n            if j not in visited and x[current_point, j].value():\n                service_route.append(j)\n                visited.add(j)\n                current_point = j\n                break\n    \n    service_route.append(0)\n    \n    solution = {\n        \"service_route\": service_route,\n        \"total_distance\": round(float(objective_expr.value()) / scale_factor, 2)\n    }\n    print(json.dumps(solution))\nelse:\n    print(json.dumps({\"service_route\": [], \"total_distance\": -1}))",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    import math\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Invalid JSON format: {e}\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"service_route\", \"total_distance\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        service_route = solution[\"service_route\"]\n        total_distance = solution[\"total_distance\"]\n        service_point_coordinates = structured_data[\"service_point_coordinates\"]\n        num_service_points = structured_data[\"num_service_points\"]\n        errors = []\n        \n        if not isinstance(service_route, list):\n             errors.append(\"Service route must be a list.\")\n        elif len(service_route) != num_service_points + 1:\n            errors.append(f\"Service route length mismatch: expected {num_service_points + 1}, got {len(service_route)}\")\n        elif not all(isinstance(node, int) for node in service_route):\n             errors.append(\"All service route elements must be integers.\")\n        \n        if not isinstance(total_distance, (int, float)):\n             errors.append(\"Total distance must be a number.\")\n        \n        if errors:\n             return {\n                \"is_valid\": False,\n                \"validation_errors\": errors,\n                \"optimality_score\": 0.0\n            }\n        \n        if service_route[0] != 0 or service_route[-1] != 0:\n            errors.append(\"Service route must start and end at primary logistics hub (node 0).\")\n        elif set(service_route[:-1]) != set(range(num_service_points)):\n            errors.append(\"Service route must visit each service point exactly once (excluding final return to hub).\")\n            \n        optimal_value = reference_solution[\"total_distance\"]\n        if optimal_value == 0:\n            optimality_score = 1.0 if total_distance == 0 else 0.0\n        else:\n            gap = abs(optimal_value - total_distance) / abs(optimal_value)\n            optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Unexpected error during evaluation: {str(e)}\"], \"optimality_score\": 0.0}"
}