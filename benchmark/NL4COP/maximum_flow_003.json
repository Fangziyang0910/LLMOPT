{
  "problem_id": "maximum_flow_003",
  "metadata": {
    "problem_type": "Maximum Flow Problem",
    "difficulty": "hard"
  },
  "problem_description": "A global shipping company manages a complex cargo distribution network with 32 ports arranged in a multi-layered structure, connected by 50 directional shipping routes with different cargo capacities. The logistics director needs to determine the maximum cargo throughput from the main hub port to the final destination port through this intricate network. The network architecture consists of five distinct layers: the hub layer connects the main port to primary distribution centers, the expansion layer provides regional routing, the consolidation layer gathers cargo from multiple sources, the distribution layer directs cargo to final routes, and the terminal layer connects to the destination. The complete network connections and their cargo capacities are organized as follows: From the main hub port: to port 1 with capacity 20 containers per day, to port 2 with capacity 18 containers per day. From port 1: to port 3 with capacity 12, to port 9 with capacity 15. From port 2: to port 4 with capacity 14, to port 10 with capacity 16. From port 3: to port 5 with capacity 10, to port 11 with capacity 13. From port 4: to port 6 with capacity 8, to port 12 with capacity 17. From port 5: to port 7 with capacity 11, to port 13 with capacity 19. From port 6: to port 8 with capacity 9, to port 14 with capacity 12. From port 7: to port 15 with capacity 15. From port 8: to port 16 with capacity 13. From port 9: to port 17 with capacity 14. From port 10: to port 17 with capacity 11. From port 11: to port 18 with capacity 16, to port 20 with capacity 10. From port 12: to port 19 with capacity 12, to port 21 with capacity 15. From port 13: to port 20 with capacity 18, to port 22 with capacity 14. From port 14: to port 21 with capacity 9, to port 23 with capacity 13. From port 15: to port 22 with capacity 17, to port 24 with capacity 12. From port 16: to port 23 with capacity 11, to port 25 with capacity 16. From port 17: to port 26 with capacity 20. From port 18: to port 26 with capacity 15, to port 27 with capacity 12. From port 19: to port 26 with capacity 13, to port 28 with capacity 14. From port 20: to port 27 with capacity 16, to port 29 with capacity 11. From port 21: to port 28 with capacity 18, to port 30 with capacity 10. From port 22: to port 29 with capacity 15. From port 23: to port 30 with capacity 12. From port 24: to port 29 with capacity 14. From port 25: to port 30 with capacity 17. From port 26: to port 31 with capacity 25. From port 27: to port 31 with capacity 22. From port 28: to port 31 with capacity 20. From port 29: to port 31 with capacity 18. From port 30: to port 31 with capacity 16. Each shipping route can only transport cargo in the specified direction and cannot exceed its maximum capacity. Cargo flow must be conserved at each intermediate port, meaning the total incoming cargo must equal the total outgoing cargo. The director wants to find the optimal routing strategy that maximizes the total cargo transportation from the hub port to the destination port while respecting all capacity constraints and flow conservation requirements.",
  "solution_format_description": "Print the following fields: - max_flow: maximum cargo flow from hub to destination. - cargo_distribution: cargo amount for each shipping route.",  
  "structured_data": {
    "num_ports": 32,
    "shipping_routes": [
      [0, 1, 20], [0, 2, 18], [1, 3, 12], [1, 9, 15], [2, 4, 14],
      [2, 10, 16], [3, 5, 10], [3, 11, 13], [4, 6, 8], [4, 12, 17],
      [5, 7, 11], [5, 13, 19], [6, 8, 9], [6, 14, 12], [7, 15, 15],
      [8, 16, 13], [9, 17, 14], [10, 17, 11], [11, 18, 16], [11, 20, 10],
      [12, 19, 12], [12, 21, 15], [13, 20, 18], [13, 22, 14], [14, 21, 9],
      [14, 23, 13], [15, 22, 17], [15, 24, 12], [16, 23, 11], [16, 25, 16],
      [17, 26, 20], [18, 26, 15], [18, 27, 12], [19, 26, 13], [19, 28, 14],
      [20, 27, 16], [20, 29, 11], [21, 28, 18], [21, 30, 10], [22, 29, 15],
      [23, 30, 12], [24, 29, 14], [25, 30, 17], [26, 31, 25], [27, 31, 22],
      [28, 31, 20], [29, 31, 18], [30, 31, 16]
    ]
  },
  "reference_solution": {
    "max_flow": 38,
    "cargo_distribution": [[0, 1, 20], [0, 2, 18], [1, 3, 6], [1, 9, 14], [2, 4, 12], [2, 10, 6], [3, 11, 6], [4, 12, 12], [9, 17, 14], [10, 17, 6], [11, 18, 6], [12, 19, 12], [17, 26, 20], [18, 26, 5], [18, 27, 1], [19, 28, 12], [26, 31, 25], [27, 31, 1], [28, 31, 12]]
  },
  "solver_code": "",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"max_flow\", \"cargo_distribution\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        max_flow = solution[\"max_flow\"]\n        cargo_distribution = solution[\"cargo_distribution\"]\n        shipping_routes = structured_data[\"shipping_routes\"]\n        num_ports = structured_data[\"num_ports\"]\n        source = 0\n        sink = 31\n        \n        errors = []\n        \n        capacity = [[0] * num_ports for _ in range(num_ports)]\n        for route in shipping_routes:\n            from_port, to_port, route_capacity = route\n            capacity[from_port][to_port] = route_capacity\n        \n        inflow = [0] * num_ports\n        outflow = [0] * num_ports\n        \n        for cargo_item in cargo_distribution:\n            from_port, to_port, cargo_amount = cargo_item\n            \n            if cargo_amount > capacity[from_port][to_port]:\n                errors.append(f\"Cargo {cargo_amount} exceeds capacity {capacity[from_port][to_port]} on route {from_port}->{to_port}\")\n            \n            if cargo_amount < 0:\n                errors.append(f\"Negative cargo {cargo_amount} on route {from_port}->{to_port}\")\n            \n            outflow[from_port] += cargo_amount\n            inflow[to_port] += cargo_amount\n        \n        if outflow[source] != max_flow:\n            errors.append(f\"Hub port outflow {outflow[source]} != max_flow {max_flow}\")\n        \n        if inflow[sink] != max_flow:\n            errors.append(f\"Destination port inflow {inflow[sink]} != max_flow {max_flow}\")\n        \n        for i in range(num_ports):\n            if i != source and i != sink:\n                if abs(inflow[i] - outflow[i]) > 1e-6:\n                    errors.append(f\"Cargo conservation violation at port {i}: inflow {inflow[i]} != outflow {outflow[i]}\")\n        \n        is_valid = len(errors) == 0\n        \n        if not is_valid:\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n        \n        optimal_flow = reference_solution[\"max_flow\"]\n        if optimal_flow == 0:\n            optimality_score = 1.0 if max_flow == 0 else 0.0\n        else:\n            gap = abs(optimal_flow - max_flow) / abs(optimal_flow)\n            optimality_score = max(0, 1 - gap)\n        \n        return {\n            \"is_valid\": is_valid,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}