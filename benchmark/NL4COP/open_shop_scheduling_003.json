{
  "problem_id": "open_shop_scheduling_003",
  "metadata": {
    "problem_type": "Open Shop Scheduling Problem",
    "difficulty": "hard"
  },
  "problem_description": "In an advanced biomedical research facility, nine distinct clinical research subjects each require nine specialized diagnostic examinations that must be conducted in designated imaging suites with specific temporal allocations. The principal investigator seeks to optimize the overall study timeline by determining the optimal temporal scheduling matrix for each examination to minimize the total study completion horizon across all concurrent subject assessments. \n\nThe system must adhere to several operational constraints: first, within any given subject diagnostic examinations must maintain mutual exclusion in temporal domains which means simultaneous examination activation within the same subject is prohibited; second, each imaging suite can accommodate only one subject examination at any temporal instant so temporal overlap of examinations within identical imaging suites is forbidden; third, unlike conventional clinical imaging workflows subject examinations exhibit permutation flexibility allowing arbitrary sequencing arrangements.\n\nThe diagnostic workflow specifications are:\nSubject Alpha requires Suite-8 for 95 minutes, then Suite-5 for 97 minutes, followed by Suite-4 for 36 minutes, then Suite-9 for 18 minutes, then Suite-6 for 36 minutes, then Suite-1 for 77 minutes, then Suite-7 for 50 minutes, then Suite-2 for 30 minutes, and finally Suite-3 for 51 minutes\nSubject Beta requires Suite-7 for 98 minutes, then Suite-6 for 26 minutes, followed by Suite-5 for 45 minutes, then Suite-4 for 88 minutes, then Suite-1 for 81 minutes, then Suite-8 for 3 minutes, then Suite-3 for 12 minutes, then Suite-9 for 90 minutes, and finally Suite-2 for 6 minutes\nSubject Gamma requires Suite-7 for 73 minutes, then Suite-9 for 87 minutes, followed by Suite-6 for 31 minutes, then Suite-4 for 46 minutes, then Suite-1 for 43 minutes, then Suite-3 for 53 minutes, then Suite-5 for 49 minutes, then Suite-8 for 39 minutes, and finally Suite-2 for 51 minutes\nSubject Delta requires Suite-8 for 4 minutes, then Suite-9 for 57 minutes, followed by Suite-5 for 93 minutes, then Suite-3 for 66 minutes, then Suite-1 for 75 minutes, then Suite-6 for 71 minutes, then Suite-4 for 13 minutes, then Suite-7 for 21 minutes, and finally Suite-2 for 2 minutes\nSubject Epsilon requires Suite-7 for 91 minutes, then Suite-8 for 15 minutes, followed by Suite-6 for 88 minutes, then Suite-2 for 14 minutes, then Suite-3 for 22 minutes, then Suite-1 for 67 minutes, then Suite-9 for 29 minutes, then Suite-4 for 65 minutes, and finally Suite-5 for 55 minutes\nSubject Zeta requires Suite-8 for 38 minutes, then Suite-1 for 45 minutes, followed by Suite-7 for 36 minutes, then Suite-2 for 96 minutes, then Suite-9 for 46 minutes, then Suite-4 for 51 minutes, then Suite-6 for 4 minutes, then Suite-3 for 59 minutes, and finally Suite-5 for 32 minutes\nSubject Eta requires Suite-2 for 84 minutes, then Suite-8 for 76 minutes, followed by Suite-4 for 28 minutes, then Suite-5 for 89 minutes, then Suite-3 for 33 minutes, then Suite-7 for 10 minutes, then Suite-6 for 6 minutes, then Suite-1 for 51 minutes, and finally Suite-9 for 3 minutes\nSubject Theta requires Suite-6 for 86 minutes, then Suite-2 for 68 minutes, followed by Suite-3 for 33 minutes, then Suite-5 for 82 minutes, then Suite-7 for 91 minutes, then Suite-8 for 87 minutes, then Suite-9 for 23 minutes, then Suite-1 for 87 minutes, and finally Suite-4 for 14 minutes\nSubject Iota requires Suite-6 for 17 minutes, then Suite-2 for 50 minutes, followed by Suite-8 for 23 minutes, then Suite-3 for 2 minutes, then Suite-5 for 4 minutes, then Suite-4 for 54 minutes, then Suite-7 for 18 minutes, then Suite-9 for 83 minutes, and finally Suite-1 for 16 minutes",
  "solution_format_description": "Print the following fields: - start_times: start time for each subject's examination. - makespan: total study completion time.",
  "structured_data": {
    "n_subjects": 9,
    "n_suites": 9,
    "examination_durations": [
      [95, 97, 36, 18, 36, 77, 50, 30, 51], 
      [98, 26, 45, 88, 81, 3, 12, 90, 6], 
      [73, 87, 9, 31, 46, 43, 53, 49, 39], 
      [4, 57, 93, 66, 75, 95, 71, 13, 21], 
      [91, 15, 88, 14, 22, 58, 67, 29, 65], 
      [38, 45, 36, 96, 76, 46, 51, 4, 59], 
      [84, 76, 28, 89, 33, 10, 6, 51, 3], 
      [86, 68, 33, 82, 91, 87, 23, 87, 14], 
      [17, 50, 23, 2, 4, 54, 59, 18, 83]
    ],
    "suite_assignments": [
      [8, 5, 4, 9, 6, 1, 7, 2, 3], 
      [7, 6, 5, 4, 1, 8, 3, 9, 2], 
      [7, 9, 6, 4, 1, 3, 5, 8, 2], 
      [8, 9, 5, 3, 1, 6, 4, 7, 2], 
      [7, 8, 6, 2, 3, 1, 9, 4, 5], 
      [8, 1, 7, 2, 9, 4, 6, 3, 5], 
      [2, 8, 4, 5, 3, 7, 6, 1, 9], 
      [6, 2, 3, 5, 7, 8, 9, 1, 4], 
      [6, 2, 8, 3, 5, 4, 7, 9, 1]
    ]
  },
  "reference_solution": {
    "start_times": [
      [330, 232, 196, 178, 50, 475, 0, 86, 116], 
      [296, 394, 0, 510, 104, 274, 225, 420, 68], 
      [50, 221, 420, 351, 0, 308, 478, 429, 123], 
      [582, 0, 139, 475, 400, 296, 57, 283, 541], 
      [192, 518, 104, 326, 0, 46, 340, 476, 411], 
      [480, 185, 133, 230, 57, 0, 429, 590, 531], 
      [340, 179, 138, 49, 424, 169, 0, 552, 510], 
      [502, 0, 192, 329, 411, 68, 155, 230, 178], 
      [480, 162, 0, 564, 45, 422, 502, 133, 317]
    ],
    "makespan": 603
  },
  "solver_code": "from cpmpy import *\nimport json\n\nn_subjects = 9\nn_suites = 9\nexamination_durations = [\n    [95, 97, 36, 18, 36, 77, 50, 30, 51],\n    [98, 26, 45, 88, 81, 3, 12, 90, 6],\n    [73, 87, 9, 31, 46, 43, 53, 49, 39],\n    [4, 57, 93, 66, 75, 95, 71, 13, 21],\n    [91, 15, 88, 14, 22, 58, 67, 29, 65],\n    [38, 45, 36, 96, 76, 46, 51, 4, 59],\n    [84, 76, 28, 89, 33, 10, 6, 51, 3],\n    [86, 68, 33, 82, 91, 87, 23, 87, 14],\n    [17, 50, 23, 2, 4, 54, 59, 18, 83]\n]\nsuite_assignments = [\n    [8, 5, 4, 9, 6, 1, 7, 2, 3],\n    [7, 6, 5, 4, 1, 8, 3, 9, 2],\n    [7, 9, 6, 4, 1, 3, 5, 8, 2],\n    [8, 9, 5, 3, 1, 6, 4, 7, 2],\n    [7, 8, 6, 2, 3, 1, 9, 4, 5],\n    [8, 1, 7, 2, 9, 4, 6, 3, 5],\n    [2, 8, 4, 5, 3, 7, 6, 1, 9],\n    [6, 2, 3, 5, 7, 8, 9, 1, 4],\n    [6, 2, 8, 3, 5, 4, 7, 9, 1]\n]\n\nmodel = Model()\n\nstart = intvar(0, sum(sum(row) for row in examination_durations), shape=(n_subjects, n_suites))\n\nmakespan = intvar(0, sum(sum(row) for row in examination_durations))\n\nfor i in range(n_subjects):\n    for j1 in range(n_suites):\n        for j2 in range(j1 + 1, n_suites):\n            model += (\n                (start[i][j1] + examination_durations[i][j1] <= start[i][j2]) |\n                (start[i][j2] + examination_durations[i][j2] <= start[i][j1])\n            )\n\nsuite_tests = {}\nfor i in range(n_subjects):\n    for j in range(n_suites):\n        suite_id = suite_assignments[i][j]\n        if suite_id not in suite_tests:\n            suite_tests[suite_id] = []\n        suite_tests[suite_id].append((i, j))\n\nfor tasks in suite_tests.values():\n    if len(tasks) > 1:\n        for idx1 in range(len(tasks)):\n            for idx2 in range(idx1 + 1, len(tasks)):\n                i1, j1 = tasks[idx1]\n                i2, j2 = tasks[idx2]\n                model += (\n                    (start[i1][j1] + examination_durations[i1][j1] <= start[i2][j2]) |\n                    (start[i2][j2] + examination_durations[i2][j2] <= start[i1][j1])\n                )\n\nfor i in range(n_subjects):\n    for j in range(n_suites):\n        model += makespan >= start[i][j] + examination_durations[i][j]\n\nmodel.minimize(makespan)\n\nif model.solve():\n    start_times_solution = [[start[i][j].value() for j in range(n_suites)] for i in range(n_subjects)]\n    makespan_solution = makespan.value()\n    \n    result = {\n        \"start_times\": start_times_solution,\n        \"makespan\": int(makespan_solution)\n    }\n    \n    print(json.dumps(result))\nelse:\n    print(json.dumps({\"error\": \"No solution found\"}))",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"start_times\", \"makespan\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        start_times = solution[\"start_times\"]\n        makespan = solution[\"makespan\"]\n        n_subjects = structured_data[\"n_subjects\"]\n        n_suites = structured_data[\"n_suites\"]\n        examination_durations = structured_data[\"examination_durations\"]\n        suite_assignments = structured_data[\"suite_assignments\"]\n        errors = []\n        \n        if len(start_times) != n_subjects:\n            errors.append(f\"Subjects count mismatch: expected {n_subjects}, got {len(start_times)}\")\n            return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n            \n        for i in range(n_subjects):\n            if len(start_times[i]) != n_suites:\n                errors.append(f\"Examinations count mismatch for subject {i}: expected {n_suites}, got {len(start_times[i])}\")\n                return {\"is_valid\": False, \"validation_errors\": errors, \"optimality_score\": 0.0}\n                \n        for i in range(n_subjects):\n            for j in range(n_suites):\n                if not isinstance(start_times[i][j], int) or start_times[i][j] < 0:\n                    errors.append(f\"Invalid start time at subject {i}, examination {j}: {start_times[i][j]}\")\n\n        for i in range(n_subjects):\n            for j1 in range(n_suites):\n                for j2 in range(j1 + 1, n_suites):\n                    st1 = start_times[i][j1]\n                    st2 = start_times[i][j2]\n                    et1 = st1 + examination_durations[i][j1]\n                    et2 = st2 + examination_durations[i][j2]\n                    if not (et1 <= st2 or et2 <= st1):\n                        errors.append(f\"Overlapping examinations in subject {i}: examinations {j1} and {j2}\")\n\n        suite_schedules = {}\n        for i in range(n_subjects):\n            for j in range(n_suites):\n                suite_id = suite_assignments[i][j]\n                st = start_times[i][j]\n                et = st + examination_durations[i][j]\n                if suite_id not in suite_schedules:\n                    suite_schedules[suite_id] = []\n                suite_schedules[suite_id].append((st, et, i, j))\n        \n        for suite_id, tasks in suite_schedules.items():\n            tasks_sorted = sorted(tasks, key=lambda x: x[0])\n            for k in range(1, len(tasks_sorted)):\n                prev_st, prev_et, prev_i, prev_j = tasks_sorted[k - 1]\n                curr_st, curr_et, curr_i, curr_j = tasks_sorted[k]\n                if prev_et > curr_st:\n                    errors.append(f\"Suite {suite_id} conflict: subject {prev_i} examination {prev_j} overlaps with subject {curr_i} examination {curr_j}\")\n        \n        if len(errors) == 0:\n            optimal_makespan = reference_solution[\"makespan\"]\n            if optimal_makespan == 0:\n                optimality_score = 1.0 if makespan == 0 else 0.0\n            else:\n                gap = abs(optimal_makespan - makespan) / abs(optimal_makespan)\n                optimality_score = max(0, 1 - gap)\n        else:\n            optimality_score = 0.0\n        \n        return {\n            \"is_valid\": len(errors) == 0,\n            \"validation_errors\": errors,\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}