{
  "problem_id": "resource_constrained_shortest_path_002",
  "metadata": {
    "problem_type": "Resource Constrained Shortest Path Problem",
    "difficulty": "medium"
  },
  "problem_description": "An integrated ecological monitoring system requires optimizing autonomous drone deployment patterns across a protected wilderness corridor to establish optimal data collection trajectories that minimize comprehensive mission overhead while adhering to strict operational constraints. The system must select a path containing exactly six locations including the starting point and destination. Sophisticated resource management parameters govern energy expenditure capped at eighty kilowatt-hours and temporal allocation thresholds limited to forty-five hours through strategic trajectory planning that balances data collection efficacy against sustainable resource utilization patterns. Station-specific resource utilization profiles include: station 0 zero kilowatt-hours zero hours, station 1 three kilowatt-hours two hours, station 2 two kilowatt-hours three hours, station 3 four kilowatt-hours one hour, station 4 one kilowatt-hour two hours, station 5 three kilowatt-hours two hours, station 6 two kilowatt-hours four hours, station 7 five kilowatt-hours one hour, station 8 two kilowatt-hours three hours, station 9 one kilowatt-hour two hours, station 10 four kilowatt-hours two hours, station 11 three kilowatt-hours three hours, station 12 two kilowatt-hours one hour, station 13 three kilowatt-hours two hours, station 14 one kilowatt-hour three hours, station 15 four kilowatt-hours one hour, station 16 two kilowatt-hours two hours, station 17 three kilowatt-hours three hours, station 18 two kilowatt-hours one hour, and station 19 zero kilowatt-hours zero hours. Available transit corridors include: from station 0 to station 1 cost twelve dollars four kilowatt-hours three hours, to station 2 cost eighteen dollars three kilowatt-hours four hours, to station 3 cost twenty-five dollars five kilowatt-hours two hours, from station 1 to station 4 cost fifteen dollars three kilowatt-hours three hours, to station 5 cost twenty-two dollars four kilowatt-hours two hours, to station 6 cost twenty dollars three kilowatt-hours four hours, from station 2 to station 4 cost ten dollars two kilowatt-hours four hours, to station 7 cost sixteen dollars three kilowatt-hours three hours, to station 8 cost twenty-four dollars five kilowatt-hours two hours, from station 3 to station 5 cost fourteen dollars three kilowatt-hours two hours, to station 9 cost eighteen dollars four kilowatt-hours three hours, to station 10 cost twenty-six dollars six kilowatt-hours two hours, from station 4 to station 6 cost fourteen dollars four kilowatt-hours three hours, to station 9 cost eighteen dollars four kilowatt-hours three hours, from station 5 to station 11 cost eighteen dollars four kilowatt-hours three hours, to station 12 cost twenty-two dollars five kilowatt-hours two hours, from station 6 to station 11 cost sixteen dollars three kilowatt-hours four hours, to station 13 cost twenty dollars four kilowatt-hours three hours, from station 7 to station 12 cost fourteen dollars three kilowatt-hours three hours, to station 14 cost twenty dollars four kilowatt-hours three hours, from station 8 to station 13 cost fourteen dollars three kilowatt-hours three hours, to station 15 cost eighteen dollars four kilowatt-hours three hours, from station 9 to station 14 cost sixteen dollars three kilowatt-hours three hours, to station 16 cost twenty-two dollars five kilowatt-hours two hours, from station 10 to station 15 cost sixteen dollars three kilowatt-hours three hours, to station 17 cost twenty-two dollars five kilowatt-hours two hours, from station 11 to station 16 cost fourteen dollars three kilowatt-hours four hours, to station 17 cost eighteen dollars four kilowatt-hours three hours, to station 18 cost twenty-four dollars five kilowatt-hours two hours, from station 12 to station 17 cost twelve dollars two kilowatt-hours four hours, to station 19 cost twenty-eight dollars six kilowatt-hours three hours, from station 13 to station 18 cost sixteen dollars three kilowatt-hours three hours, to station 19 cost twenty-two dollars five kilowatt-hours two hours, from station 14 to station 17 cost ten dollars two kilowatt-hours three hours, to station 18 cost eighteen dollars four kilowatt-hours two hours, from station 15  to station 18 cost fourteen dollars three kilowatt-hours four hours, to station 19 cost twenty dollars four kilowatt-hours three hours, from station 16 to station 18 cost twelve dollars two kilowatt-hours three hours, to station 19 cost eighteen dollars four kilowatt-hours two hours, from station 17 to station 19 cost sixteen dollars three kilowatt-hours four hours, from station 18 to station 19 cost twelve dollars two kilowatt-hours three hours.",  
  "solution_format_description": "Print the following fields: - trajectory: sequence of stations visited from start to end. - total_cost: total transportation cost. - resource_consumption: total energy and time used.",  
  "structured_data": {
    "resource_constraints": [80, 45],
    "facility_resource_consumption": [
      [0, 0], [3, 2], [2, 3], [4, 1], [1, 2],
      [3, 2], [2, 4], [5, 1], [2, 3], [1, 2],
      [4, 2], [3, 3], [2, 1], [3, 2], [1, 3],
      [4, 1], [2, 2], [3, 3], [2, 1], [0, 0]
    ],
    "transportation_network": [
      [0, 1, 12, 4, 3], [0, 2, 18, 3, 4], [0, 3, 25, 5, 2],
      [1, 4, 15, 3, 3], [1, 5, 22, 4, 2], [1, 6, 20, 3, 4],
      [2, 4, 10, 2, 4], [2, 7, 16, 3, 3], [2, 8, 24, 5, 2],
      [3, 5, 14, 3, 2], [3, 9, 18, 4, 3], [3, 10, 26, 6, 2],
      [4, 6, 14, 3, 2], [4, 9, 18, 4, 3], [4, 10, 26, 6, 2],
      [5, 11, 18, 4, 3], [5, 12, 22, 5, 2],
      [6, 11, 16, 3, 4], [6, 13, 20, 4, 3],
      [7, 12, 14, 3, 3], [7, 14, 20, 4, 3],
      [8, 13, 14, 3, 3], [8, 15, 18, 4, 3],
      [9, 14, 16, 3, 3], [9, 16, 22, 5, 2],
      [10, 15, 16, 3, 3], [10, 17, 22, 5, 2],
      [11, 16, 14, 3, 4], [11, 17, 18, 4, 3], [11, 18, 24, 5, 2],
      [12, 17, 12, 2, 4], [12, 19, 28, 6, 3],
      [13, 18, 16, 3, 3], [13, 19, 22, 5, 2],
      [14, 17, 10, 2, 3], [14, 18, 18, 4, 2],
      [15, 18, 14, 3, 4], [15, 19, 20, 4, 3],
      [16, 18, 12, 2, 3], [16, 19, 18, 4, 2],
      [17, 19, 16, 3, 4],
      [18, 19, 12, 2, 3]
    ]
  },
  "reference_solution": {
    "trajectory": [0, 2, 7, 12, 17, 19],
    "total_cost": 76,
    "resource_consumption": [26, 26]
  },
  "solver_code": "from cpmpy import *\nimport json\n\nresource_constraints = [80, 45]\nfacility_resource_consumption = [\n    [0, 0], [3, 2], [2, 3], [4, 1], [1, 2],\n    [3, 2], [2, 4], [5, 1], [2, 3], [1, 2],\n    [4, 2], [3, 3], [2, 1], [3, 2], [1, 3],\n    [4, 1], [2, 2], [3, 3], [2, 1], [0, 0]\n]\ntransportation_network = [\n    [0, 1, 12, 4, 3], [0, 2, 18, 3, 4], [0, 3, 25, 5, 2],\n    [1, 4, 15, 3, 3], [1, 5, 22, 4, 2], [1, 6, 20, 3, 4],\n    [2, 4, 10, 2, 4], [2, 7, 16, 3, 3], [2, 8, 24, 5, 2],\n    [3, 5, 14, 3, 2], [3, 9, 18, 4, 3], [3, 10, 26, 6, 2],\n    [4, 6, 14, 3, 2], [4, 9, 18, 4, 3], [4, 10, 26, 6, 2],\n    [5, 11, 18, 4, 3], [5, 12, 22, 5, 2],\n    [6, 11, 16, 3, 4], [6, 13, 20, 4, 3],\n    [7, 12, 14, 3, 3], [7, 14, 20, 4, 3],\n    [8, 13, 14, 3, 3], [8, 15, 18, 4, 3],\n    [9, 14, 16, 3, 3], [9, 16, 22, 5, 2],\n    [10, 15, 16, 3, 3], [10, 17, 22, 5, 2],\n    [11, 16, 14, 3, 4], [11, 17, 18, 4, 3], [11, 18, 24, 5, 2],\n    [12, 17, 12, 2, 4], [12, 19, 28, 6, 3],\n    [13, 18, 16, 3, 3], [13, 19, 22, 5, 2],\n    [14, 17, 10, 2, 3], [14, 18, 18, 4, 2],\n    [15, 18, 14, 3, 4], [15, 19, 20, 4, 3],\n    [16, 18, 12, 2, 3], [16, 19, 18, 4, 2],\n    [17, 19, 16, 3, 4],\n    [18, 19, 12, 2, 3]\n]\n\nmodel = Model()\n\npath_length = 6\npath = intvar(0, 19, shape=path_length)\n\nmodel += path[0] == 0\nmodel += path[path_length-1] == 19\n\nfor i in range(path_length-1):\n    valid_edges = []\n    for route in transportation_network:\n        start, dest, cost, energy, temporal = route\n        valid_edges.append((path[i] == start) & (path[i+1] == dest))\n    model += any(valid_edges)\n\ntotal_energy = intvar(0, resource_constraints[0])\ntotal_temporal = intvar(0, resource_constraints[1])\n\nenergy_expr = 0\ntemporal_expr = 0\n\nfor i in range(path_length):\n    for loc in range(20):\n        energy_expr += (path[i] == loc) * facility_resource_consumption[loc][0]\n        temporal_expr += (path[i] == loc) * facility_resource_consumption[loc][1]\n\nfor i in range(path_length-1):\n    for route in transportation_network:\n        start, dest, cost, energy, temporal = route\n        energy_expr += ((path[i] == start) & (path[i+1] == dest)) * energy\n        temporal_expr += ((path[i] == start) & (path[i+1] == dest)) * temporal\n\nmodel += total_energy == energy_expr\nmodel += total_temporal == temporal_expr\n\nmodel += total_energy <= resource_constraints[0]\nmodel += total_temporal <= resource_constraints[1]\n\ntotal_cost = 0\nfor i in range(path_length-1):\n    for route in transportation_network:\n        start, dest, cost, energy, temporal = route\n        total_cost += ((path[i] == start) & (path[i+1] == dest)) * cost\n\nmodel.minimize(total_cost)\n\nif model.solve():\n    trajectory = [path[i].value() for i in range(path_length)]\n    \n    result = {\n        \"trajectory\": trajectory,\n        \"total_cost\": total_cost.value(),\n        \"resource_consumption\": [total_energy.value(), total_temporal.value()]\n    }\n    \n    print(json.dumps(result))\nelse:\n    print(json.dumps({\"trajectory\": [], \"total_cost\": -1, \"resource_consumption\": [0, 0]}))",
  "evaluation_function": "def evaluate(candidate_solution, structured_data, reference_solution):\n    import json\n    \n    try:\n        solution = json.loads(candidate_solution) if isinstance(candidate_solution, str) else candidate_solution\n    except:\n        return {\"is_valid\": False, \"validation_errors\": [\"Invalid JSON format\"], \"optimality_score\": 0.0}\n    \n    required_fields = [\"trajectory\", \"total_cost\", \"resource_consumption\"]\n    missing = [f for f in required_fields if solution is None or f not in solution]\n    if missing:\n        return {\"is_valid\": False, \"validation_errors\": [f\"Missing fields: {missing}\"], \"optimality_score\": 0.0}\n    \n    try:\n        trajectory = solution[\"trajectory\"]\n        total_cost = solution[\"total_cost\"]\n        resource_consumption = solution[\"resource_consumption\"]\n        \n        resource_constraints = structured_data[\"resource_constraints\"]\n        facility_resource_consumption = structured_data[\"facility_resource_consumption\"]\n        transportation_network = structured_data[\"transportation_network\"]\n        \n        errors = []\n        \n        if len(trajectory) != 6:\n            errors.append(f\"Trajectory must have exactly 6 facilities, got {len(trajectory)}\")\n        \n        if trajectory[0] != 0:\n            errors.append(\"Trajectory must start at facility 0 (hub)\")\n        \n        if trajectory[-1] != 19:\n            errors.append(\"Trajectory must end at facility 19 (center)\")\n        \n        num_facilities = len(facility_resource_consumption)\n        for facility in trajectory:\n            if facility < 0 or facility >= num_facilities:\n                errors.append(f\"Invalid facility {facility} in trajectory\")\n        \n        for i in range(len(trajectory) - 1):\n            current = trajectory[i]\n            next_facility = trajectory[i + 1]\n            \n            valid_transition = False\n            for route in transportation_network:\n                start, dest, cost, energy, temporal = route\n                if start == current and dest == next_facility:\n                    valid_transition = True\n                    break\n            \n            if not valid_transition:\n                errors.append(f\"No valid route from facility {current} to facility {next_facility}\")\n        \n        calculated_energy = 0\n        calculated_temporal = 0\n        \n        for facility in trajectory:\n            calculated_energy += facility_resource_consumption[facility][0]\n            calculated_temporal += facility_resource_consumption[facility][1]\n        \n        for i in range(len(trajectory) - 1):\n            current = trajectory[i]\n            next_facility = trajectory[i + 1]\n            \n            for route in transportation_network:\n                start, dest, cost, energy, temporal = route\n                if start == current and dest == next_facility:\n                    calculated_energy += energy\n                    calculated_temporal += temporal\n                    break\n        \n        max_energy, max_temporal = resource_constraints\n        \n        if calculated_energy > max_energy:\n            errors.append(f\"Energy consumption {calculated_energy} exceeds maximum {max_energy}\")\n        \n        if calculated_temporal > max_temporal:\n            errors.append(f\"Temporal allocation {calculated_temporal} exceeds maximum {max_temporal}\")\n        \n        if len(resource_consumption) != 2:\n            errors.append(\"Resource consumption must have exactly 2 values [energy, temporal]\")\n        else:\n            declared_energy = resource_consumption[0]\n            declared_temporal = resource_consumption[1]\n            \n            if abs(calculated_energy - declared_energy) > 1e-6:\n                errors.append(f\"Energy inconsistency: calculated {calculated_energy}, declared {declared_energy}\")\n            \n            if abs(calculated_temporal - declared_temporal) > 1e-6:\n                errors.append(f\"Temporal inconsistency: calculated {calculated_temporal}, declared {declared_temporal}\")\n        \n        if len(errors) > 0:\n            return {\n                \"is_valid\": False,\n                \"validation_errors\": errors,\n                \"optimality_score\": 0.0\n            }\n        \n        optimal_cost = reference_solution[\"total_cost\"]\n        if optimal_cost == 0:\n            optimality_score = 1.0 if total_cost == 0 else 0.0\n        else:\n            gap = abs(optimal_cost - total_cost) / abs(optimal_cost)\n            optimality_score = max(0, 1 - gap)\n            \n        return {\n            \"is_valid\": True,\n            \"validation_errors\": [],\n            \"optimality_score\": optimality_score\n        }\n        \n    except Exception as e:\n        return {\"is_valid\": False, \"validation_errors\": [\"Format error in solution data\"], \"optimality_score\": 0.0}"
}